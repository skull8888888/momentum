<!DOCTYPE html><html><head><script src="../../bower_components/webcomponentsjs/webcomponents-loader.js"></script><script src="../math-tex/mathjax-loader.js"></script><script src="../math-tex/math-tex.js"></script><script src="../../bower_components/moment/moment.js"></script><script src="../../bower_components/js-cookie/src/js.cookie.js"></script><script type="text/javascript" src="fabric.min.js"></script><script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script><script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-firestore.js"></script><script>var config={apiKey:"AIzaSyAjyvmMKHB5v1v25-JvJpxQuaLSpTsJGA4",authDomain:"momentum-2a71c.firebaseapp.com",databaseURL:"https://momentum-2a71c.firebaseio.com",projectId:"momentum-2a71c",storageBucket:"momentum-2a71c.appspot.com",messagingSenderId:"314824018866"};firebase.initializeApp(config);const db=firebase.firestore(),auth=firebase.auth();</script><link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../../bower_components/iron-icons/editor-icons.html"><link rel="import" href="../../bower_components/iron-icons/image-icons.html"><link rel="import" href="../../bower_components/iron-list/iron-list.html"><link rel="import" href="../../bower_components/iron-selector/iron-selector.html"><link rel="import" href="editor-formula-module.html"><link rel="import" href="editor-canvas-module.html"><link rel="import" href="editor-highlight-remove-module.html"><link rel="import" href="editor-bookmarks-module.html"><link rel="import" href="editor-tools-module.html"><link rel="import" href="../shared-styles.html"><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,800|Lato:400,900|Roboto+Slab:700" rel="stylesheet"><style>body{padding:0;margin:0;min-height:100vh;min-width:100vw;font-family:'Open Sans';--app-main-color:#e74c3c;--app-secondary-color:black;--paper-grey-50:#fafafa;--paper-grey-100:#f5f5f5;--paper-grey-200:#eeeeee;--paper-grey-300:#e0e0e0;--paper-grey-400:#bdbdbd;--paper-grey-500:#9e9e9e;--paper-grey-600:#757575;--paper-grey-700:#616161;--paper-grey-800:#424242;--paper-grey-900:#212121;}#editor:focus{outline:none;}#editor{margin-top:80px;min-height:100vh;padding-left:10%;color:#424242;font-weight:300;width:50vw;line-height:32px;font-size:20px;height:100vh;font-family:'Lato';padding-bottom:64px;}iron-icon{color:var(--paper-grey-600);cursor:pointer;}h2{font-weight:800;color:black;}#editor h2:first-of-type{font-size:36px;}h2:first-of-type:empty::before{color:lightgray;font-size:30px;}.separator{border-right:solid 2px var(--paper-grey-300);width:1px;margin-right:4px;}.footer{top:calc(100vh - 24px);height:24px;position:fixed;left:48px;width:calc(100vw - 48px);z-index:99;background-color:var(--paper-grey-200);display:flex;padding-left:10%;flex-direction:row;-ms-flex-align:center;-webkit-align-items:center;align-items:center;}.avatar{position:absolute;right:128px;}#header div{display:inline;line-height:24px;}img{width:100%;}figure{margin:0;}@media all and (max-width: 800px){#editor{padding:0px 25%;}}@media all and (max-width: 500px){#editor{padding:0px 16px;}}#status{width:100px;height:40px;}h3{margin-bottom:-20px;}#backIcon{width:28px;height:28px;margin-top:19px;margin-left:16px;position:absolute;}paper-progress{width:100vw;top:62px;position:absolute;--paper-progress-active-color:#e91e63;--paper-progress-height:2px;}.highlight{background-color:yellow;}#logo{font-weight:700;font-size:22px;font-family:'Roboto Slab';margin-left:10%;}#status{color:var(--paper-grey-600);font-size:12px;line-height:24px;height:24px;margin-left:16px;}.bottom{height:100px;}#tools{position:fixed;height:100vh;top:0;background-color:var(--paper-grey-300);text-align:center;width:48px;z-index:100;display:flex;flex-direction:column;-ms-flex-align:center;-webkit-align-items:center;align-items:center;}#tools div{margin:4px 0px;cursor:pointer;}.logo{font-weight:800;font-size:28px;padding-bottom:8px;border-bottom:1px solid var(--paper-grey-500);width:36px;color:transparent;margin-left:4px;}</style></head><body><div class="footer"><div id="status"></div><paper-progress id="progress"></paper-progress></div><div id="tools"><div class="logo" href="/">m</div><div onmousedown="event.preventDefault();" onclick="editAction('func')">f(x)</div><div icon="editor:functions" onmousedown="event.preventDefault();" onclick="editAction('canvas')">C</div><div icon="image:photo" onmousedown="event.preventDefault();" onclick="editAction('image')">I</div></div><editor-bookmarks-module id="bookmarks"></editor-bookmarks-module><div id="editor" contenteditable="true" onkeyup="editorTextChanged(this)"></div><script>var noteId,fullNoteRef,noteRef,initialName,currentHighlight,currentBatchId,formulas=[],sketchs=[];const editor=document.getElementById('editor');window.onload=reload();var abovetooltip=!1;function backToMain(){top.window.history.pushState({page:'another'},'another page','/')}function reload(a){if(document.getElementById('progress').indeterminate=!0,a)noteId=a;else{let a=document.referrer.split('/');noteId=a[a.length-1]}editor.innerHTML='',db.collection('fullNotes').doc(noteId).get().then((a)=>{if(document.getElementById('progress').indeterminate=!1,initialName=a.data().initialName,document.styleSheets[0].addRule('h2:first-of-type:empty::before','content: "'+initialName+'";'),editor.innerHTML=a.data().innerHTML,!editor.querySelector('canvas.bottom')){const a=document.createElement('canvas');a.setAttribute('class','bottom'),editor.appendChild(a)}const b=document.querySelectorAll('span');b.forEach(function(a){setHighlightListeners(a)},this),updateBookmarks(),document.querySelector('editor-tools-module')&&document.querySelector('editor-tools-module').parentNode.removeChild(document.querySelector('editor-tools-module')),document.querySelector('editor-highlight-module')&&document.querySelector('editor-highlight-module').parentNode.removeChild(document.querySelector('editor-highlight-module')),editor.addEventListener('keypress',function(a){setTimeout(()=>{'13'==a.keyCode&&document.execCommand('formatBlock',!1,'p')})},!1),this.addEventListener('formula-added',()=>{setTimeout(()=>{var a=this.range;const b=this.sel,c=this.lastNode;a=a.cloneRange(),a.setStartAfter(c),a.collapse(!0),b.removeAllRanges(),b.addRange(a)})}),this.addEventListener('delete-highlight',()=>{for(var a=currentHighlight.parentNode;currentHighlight.firstChild;)a.insertBefore(currentHighlight.firstChild,currentHighlight);a.removeChild(currentHighlight);const b=document.querySelectorAll('editor-highlight-module');b.forEach(function(a){a.parentNode.removeChild(a)},this),updateBookmarks(),updateFullNote()}),this.addEventListener('context-changed',()=>{updateFullNote()}),fullNoteRef=db.collection('fullNotes').doc(noteId),noteRef=db.collection('notes').doc(noteId),setTimeout(()=>{editor.focus()})}),editor.addEventListener('mouseup',function(){''!=document.getSelection().toString()&&showTools()},!1)}function showTools(){const a=document.querySelector('editor-tools-module');if(!a){const a=window.getSelection().getRangeAt(0),b=a.getBoundingClientRect(),c=document.createElement('editor-tools-module');c.style.position='absolute',c.style.top=b.top+window.scrollY-48+'px',c.style.left=b.left+window.scrollX+b.width/2-68+'px',editor.appendChild(c)}}function updateBookmarks(){formulas=[],sketchs=[];const a=[...document.querySelectorAll('span')].map((a)=>{var b={id:a.id,node:a};if('SPAN'==a.tagName){if('yellow'!=a.style.backgroundColor)return;b.type='highlight',b.text=a.innerText}else'EDITOR-FORMULA-MODULE'==a.tagName?(formulas.push(a),b.type='formula',b.text=`Formula(${formulas.length})`):'EDITOR-CANVAS-MODULE'==a.tagName&&(sketchs.push(a),b.type='sketch',b.text=`Sketch(${sketchs.length})`);return b});document.getElementById('bookmarks').bookmarks=a}function updateFullNote(){document.getElementById('status').innerText='Saving...',currentBatchId=generateId();const a=currentBatchId;setTimeout(()=>{const b=db.batch();b.update(fullNoteRef,{innerHTML:editor.innerHTML}),b.update(noteRef,{modified:Date.now(),name:''==document.getElementById('name').innerText?initialName:document.getElementById('name').innerText}),console.log(document.getElementById('name')?document.getElementById('name').innerText:initialName),currentBatchId==a&&b.commit().then(()=>{document.getElementById('status').innerText='Saved',console.log('changes saved')}).catch((a)=>{console.log(a)})},500)}function editorTextChanged(a){var b=document.querySelectorAll('#editor h2:first-of-type');b.forEach(function(a){'<br>'==a.innerHTML&&(a.innerHTML='')},this),''==a.innerHTML&&setTimeout(()=>{a.innerHTML=`
					<h2 id="name"></h2>
					`}),updateFullNote()}function editAction(a){switch(a){case'title':document.execCommand('formatBlock',!1,`h3`);break;case'image':_inputImageDialog();break;case'func':pasteHtmlAtCaret(`<editor-formula-module id="${generateId()}"></editor-formula-module>&nbsp`);break;case'canvas':pasteHtmlAtCaret(`<editor-canvas-module id="${generateId()}"></editor-canvas-module>`);break;case'highlight':document.execCommand('hiliteColor',!1,'yellow'),highlight();break;default:document.execCommand(a,!1);}updateBookmarks(),updateFullNote()}function highlight(){var a=window.getSelection().anchorNode.parentNode;a.id=generateId();const b=window.getSelection().toString()[0],c=window.getSelection().toString().substring(1);a.innerHTML=`<span class="anchor">${b}</span>${c}`,setHighlightListeners(a),updateBookmarks()}function generateId(){return db.collection('notes').doc().id}function scrollToId(a){window.scroll({behavior:'smooth',left:0,top:document.getElementById(a).offsetTop-70})}function setHighlightListeners(a){'yellow'==a.style.backgroundColor&&(a.onmouseover=(a)=>{setTimeout(()=>{},50),currentHighlight=a.target;const b=a.target.querySelector('span.anchor').getBoundingClientRect(),c=document.createElement('editor-highlight-remove-module');c.style.position='absolute',c.style.top=b.top+window.scrollY-38+'px',c.style.left=b.left+window.scrollX-38+'px',editor.appendChild(c),c.onmouseover=()=>{abovetooltip=!0},c.onmouseout=()=>{abovetooltip=!1;const a=document.querySelectorAll('editor-highlight-remove-module');a.forEach(function(a){a.parentNode.removeChild(a)},this)}},a.onmouseout=()=>{setTimeout(()=>{if(!1==abovetooltip){const a=document.querySelectorAll('editor-highlight-remove-module');a.forEach(function(a){a.parentNode.removeChild(a)},this)}},100)})}function _inputImageDialog(){const a=document.createElement('input');return a.setAttribute('type','file'),a.onchange=(a)=>{if(0<a.currentTarget.files.length){const b=a.currentTarget.files[0],c=new FileReader;c.onload=(a)=>{const b=a.target.result;pasteHtmlAtCaret(`
				<img src=${b}>
				`)},c.readAsDataURL(b)}},a.click(),!1}function pasteHtmlAtCaret(a,b){var c,d;if(!window.getSelection);else if(c=window.getSelection(),this.sel=c,c.getRangeAt&&c.rangeCount){d=c.getRangeAt(0),d.deleteContents(),this.range=d;var e=document.createElement('span');e.innerHTML=a,b&&e.appendChild(b);for(var f,g,h=document.createDocumentFragment();f=e.firstChild;)g=h.appendChild(f),this.lastNode=g;d.insertNode(h)}updateBookmarks()}</script></body></html>