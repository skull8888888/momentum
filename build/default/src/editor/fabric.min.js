var fabric=fabric||{version:"2.0.0-rc.3"};if("undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.window=fabric.document.defaultView,DOMParser=require("xmldom").DOMParser),fabric.isTouchSupported="ontouchstart"in fabric.window,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.canvasModule="canvas",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=fabric),"undefined"==typeof eventjs)var eventjs={};if(function(m){m.modifyEventListener=!1,m.modifySelectors=!1,m.configure=function(t){isFinite(t.modifyEventListener)&&(m.modifyEventListener=t.modifyEventListener),isFinite(t.modifySelectors)&&(m.modifySelectors=t.modifySelectors),!1===c&&m.modifyEventListener&&d(),!1===u&&m.modifySelectors&&g()},m.add=function(o,t,e,r){return x(o,t,e,r,"add")},m.remove=function(o,t,e,r){return x(o,t,e,r,"remove")},m.returnFalse=function(){return!1},m.stop=function(e){e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.cancelBubbleCount=0)},m.prevent=function(e){e&&(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)},m.cancel=function(t){m.stop(t),m.prevent(t)},m.blur=function(){var r=document.activeElement;if(r){var t=document.activeElement.nodeName;("INPUT"===t||"TEXTAREA"===t||"true"===r.contentEditable)&&r.blur&&r.blur()}},m.getEventSupport=function(r,o){if("string"==typeof r&&(o=r,r=window),o="on"+o,o in r)return!0;if(r.setAttribute||(r=document.createElement("div")),r.setAttribute&&r.removeAttribute){r.setAttribute(o,"");var e="function"==typeof r[o];return"undefined"!=typeof r[o]&&(r[o]=null),r.removeAttribute(o),e}};var y=function(e){if(!e||"object"!=typeof e)return e;var o=new e.constructor;for(var n in e)o[n]=e[n]&&"object"==typeof e[n]?y(e[n]):e[n];return o},x=function(c,u,f,I,d,g){if(I=I||{},"[object Object]"===c+""){var p=c;if(c=p.target,delete p.target,!p.type||!p.listener){for(var v in p){var b=p[v];"function"!=typeof b&&(I[v]=b)}var W={};for(var z in p){var v=z.split(","),_=p[z],U={};for(var C in I)U[C]=I[C];if("function"==typeof _)var f=_;else{if("function"!=typeof _.listener)continue;var f=_.listener;for(var C in _)"function"!=typeof _[C]&&(U[C]=_[C])}for(var H=0;H<v.length;H++)W[z]=eventjs.add(c,v[H],f,U,d)}return W}for(var z in u=p.type,delete p.type,f=p.listener,delete p.listener,p)I[z]=p[z]}if(c&&u&&f){if("string"==typeof c&&"ready"===u){if(!window.eventjs_stallOnReady){var j=new Date().getTime(),O=I.timeout,S=I.interval||1e3/60,k=window.setInterval(function(){new Date().getTime()-j>O&&window.clearInterval(k),document.querySelector(c)&&(window.clearInterval(k),setTimeout(f,1))},S);return}u="load",c=window}if("string"==typeof c){if(c=document.querySelectorAll(c),0===c.length)return t("Missing target on listener!",arguments);1===c.length&&(c=c[0])}var P,T={};if(0<c.length&&c!==window){for(var E=0,M=c.length;M>E;E++)P=x(c[E],u,f,y(I),d),P&&(T[E]=P);return e(T)}if("string"==typeof u&&(u=u.toLowerCase(),-1===u.indexOf(" ")?-1!==u.indexOf(",")&&(u=u.split(",")):u=u.split(" ")),"string"!=typeof u){if("number"==typeof u.length)for(var D=0,F=u.length;F>D;D++)P=x(c,u[D],f,y(I),d),P&&(T[u[D]]=P);else for(var z in u)P="function"==typeof u[z]?x(c,z,u[z],y(I),d):x(c,z,u[z].listener,y(u[z]),d),P&&(T[z]=P);return e(T)}if(0===u.indexOf("on")&&(u=u.substr(2)),"object"!=typeof c)return t("Target is not defined!",arguments);if("function"!=typeof f)return t("Listener is not a function!",arguments);var A=I.useCapture||!1,X=i(c)+"."+i(f)+"."+(A?1:0);if(m.Gesture&&m.Gesture._gestureHandlers[u]){if(X=u+X,"remove"===d){if(!n[X])return;n[X].remove(),delete n[X]}else if("add"===d){if(n[X])return n[X].add(),n[X];if(I.useCall&&!m.modifyEventListener){var R=f;f=function(r,t){for(var e in t)r[e]=t[e];return R.call(c,r)}}I.gesture=u,I.target=c,I.listener=f,I.fromOverwrite=g,n[X]=m.proxy[u](I)}return n[X]}for(var Y,G=r(u),H=0;H<G.length;H++)if(u=G[H],Y=u+"."+X,"remove"===d){if(!n[Y])continue;c[l](u,f,A),delete n[Y]}else if("add"===d){if(n[Y])return n[Y];c[a](u,f,A),n[Y]={id:Y,type:u,target:c,listener:f,remove:function(){for(var t=0;t<G.length;t++)m.remove(c,G[t],f,I)}}}return n[Y]}},e=function(r){return{remove:function(){for(var t in r)r[t].remove()},add:function(){for(var t in r)r[t].add()}}},t=function(r,t){"undefined"!=typeof console&&"undefined"!=typeof console.error&&console.error(r,t)},_={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]},s={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2},r=(function(){m.supports={},window.navigator.msPointerEnabled&&(m.supports.msPointer=!0),m.getEventSupport("touchstart")&&(m.supports.touch=!0),m.getEventSupport("mousedown")&&(m.supports.mouse=!0)}(),function(){return function(t){var e=document.addEventListener?"":"on",o=s[t];if(isFinite(o)){var r=[];for(var n in m.supports)r.push(e+_[n][o]);return r}return[e+t]}}()),n={},o=0,i=function(e){return e===window?"#window":e===document?"#document":(e.uniqueID||(e.uniqueID="e"+o++),e.uniqueID)},a=document.addEventListener?"addEventListener":"attachEvent",l=document.removeEventListener?"removeEventListener":"detachEvent";m.createPointerEvent=function(t,e,i){var r=e.gesture,n=e.target,s=t.changedTouches||m.proxy.getCoords(t);if(s.length){var o=s[0];e.pointers=i?[]:s,e.pageX=o.pageX,e.pageY=o.pageY,e.x=e.pageX,e.y=e.pageY}var a=document.createEvent("Event");for(var c in a.initEvent(r,!0,!0),a.originalEvent=t,e)"target"!==c&&(a[c]=e[c]);var d=a.type;m.Gesture&&m.Gesture._gestureHandlers[d]&&e.oldListener.call(n,a,e,!1)};var c=!1,d=function(){if(window.HTMLElement){var t=function(t){var e=function(i){var e=i+"EventListener",a=t[e];t[e]=function(t,e,n){if(m.Gesture&&m.Gesture._gestureHandlers[t]){var s=n;"object"==typeof n?s.useCall=!0:s={useCall:!0,useCapture:n},x(this,t,e,s,i,!0)}else for(var c=r(t),d=0;d<c.length;d++)a.call(this,c[d],e,n)}};e("add"),e("remove")};navigator.userAgent.match(/Firefox/)?(t(HTMLDivElement.prototype),t(HTMLCanvasElement.prototype)):t(HTMLElement.prototype),t(document),t(window)}},u=!1,g=function(){var e=NodeList.prototype;e.removeEventListener=function(o,t,e){for(var i=0,r=this.length;r>i;i++)this[i].removeEventListener(o,t,e)},e.addEventListener=function(o,t,e){for(var i=0,r=this.length;r>i;i++)this[i].addEventListener(o,t,e)}};return m}(eventjs),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(n){"use strict";n.pointerSetup=function(o,t){o.target=o.target||window,o.doc=o.target.ownerDocument||o.target,o.minFingers=o.minFingers||o.fingers||1,o.maxFingers=o.maxFingers||o.fingers||1/0,o.position=o.position||"relative",delete o.fingers,t=t||{},t.enabled=!0,t.gesture=o.gesture,t.target=o.target,t.env=o.env,eventjs.modifyEventListener&&o.fromOverwrite&&(o.oldListener=o.listener,o.listener=eventjs.createPointerEvent);var n=0,i=0===t.gesture.indexOf("pointer")&&eventjs.modifyEventListener?"pointer":"mouse";return o.oldListener&&(t.oldListener=o.oldListener),t.listener=o.listener,t.proxy=function(e){t.defaultListener=o.listener,o.listener=e,e(o.event,t)},t.add=function(){!0!==t.enabled&&(o.onPointerDown&&eventjs.add(o.target,i+"down",o.onPointerDown),o.onPointerMove&&eventjs.add(o.doc,i+"move",o.onPointerMove),o.onPointerUp&&eventjs.add(o.doc,i+"up",o.onPointerUp),t.enabled=!0)},t.remove=function(){!1!==t.enabled&&(o.onPointerDown&&eventjs.remove(o.target,i+"down",o.onPointerDown),o.onPointerMove&&eventjs.remove(o.doc,i+"move",o.onPointerMove),o.onPointerUp&&eventjs.remove(o.doc,i+"up",o.onPointerUp),t.reset(),t.enabled=!1)},t.pause=function(t){o.onPointerMove&&(!t||t.move)&&eventjs.remove(o.doc,i+"move",o.onPointerMove),o.onPointerUp&&(!t||t.up)&&eventjs.remove(o.doc,i+"up",o.onPointerUp),n=o.fingers,o.fingers=0},t.resume=function(t){o.onPointerMove&&(!t||t.move)&&eventjs.add(o.doc,i+"move",o.onPointerMove),o.onPointerUp&&(!t||t.up)&&eventjs.add(o.doc,i+"up",o.onPointerUp),o.fingers=n},t.reset=function(){o.tracker={},o.fingers=0},t};var t=eventjs.supports;eventjs.isMouse=!!t.mouse,eventjs.isMSPointer=!!t.touch,eventjs.isTouch=!!t.msPointer,n.pointerStart=function(t,e,m){var r=(t.type||"mousedown").toUpperCase();0===r.indexOf("MOUSE")?(eventjs.isMouse=!0,eventjs.isTouch=!1,eventjs.isMSPointer=!1):0===r.indexOf("TOUCH")?(eventjs.isMouse=!1,eventjs.isTouch=!0,eventjs.isMSPointer=!1):0===r.indexOf("MSPOINTER")&&(eventjs.isMouse=!1,eventjs.isTouch=!1,eventjs.isMSPointer=!0);var i=function(r,t){var e=m.bbox,i=_[t]={};switch(m.position){case"absolute":i.offsetX=0,i.offsetY=0;break;case"differenceFromLast":i.offsetX=r.pageX,i.offsetY=r.pageY;break;case"difference":i.offsetX=r.pageX,i.offsetY=r.pageY;break;case"move":i.offsetX=r.pageX-e.x1,i.offsetY=r.pageY-e.y1;break;default:i.offsetX=e.x1-e.scrollLeft,i.offsetY=e.y1-e.scrollTop;}var n=r.pageX-i.offsetX,a=r.pageY-i.offsetY;i.rotation=0,i.scale=1,i.startTime=i.moveTime=new Date().getTime(),i.move={x:n,y:a},i.start={x:n,y:a},m.fingers++};m.event=t,e.defaultListener&&(m.listener=e.defaultListener,delete e.defaultListener);for(var s=!m.fingers,_=m.tracker,o=t.changedTouches||n.getCoords(t),a=o.length,c=0;a>c;c++){var l=o[c],u=l.identifier||1/0;if(m.fingers){if(m.fingers>=m.maxFingers){var h=[];for(var u in m.tracker)h.push(u);return e.identifier=h.join(","),s}var d=0;for(var g in _){if(_[g].up){delete _[g],i(l,u),m.cancel=!0;break}d++}if(_[u])continue;i(l,u)}else _=m.tracker={},e.bbox=m.bbox=n.getBoundingBox(m.target),m.fingers=0,m.cancel=!1,i(l,u)}var h=[];for(var u in m.tracker)h.push(u);return e.identifier=h.join(","),s},n.pointerEnd=function(d,t,e,i){for(var r=d.touches||[],n=r.length,s={},o=0;n>o;o++){var a=r[o],c=a.identifier;s[c||1/0]=!0}for(var c in e.tracker){var g=e.tracker[c];s[c]||g.up||(i&&i({pageX:g.pageX,pageY:g.pageY,changedTouches:[{pageX:g.pageX,pageY:g.pageY,identifier:"Infinity"===c?1/0:c}]},"up"),g.up=!0,e.fingers--)}if(0!==e.fingers)return!1;var l=[];for(var c in e.gestureFingers=0,e.tracker)e.gestureFingers++,l.push(c);return t.identifier=l.join(","),!0},n.getCoords=function(t){return n.getCoords="undefined"==typeof t.pageX?function(r){var t=document.documentElement;return r=r||window.event,[{type:"mouse",x:r.clientX+t.scrollLeft,y:r.clientY+t.scrollTop,pageX:r.clientX+t.scrollLeft,pageY:r.clientY+t.scrollTop,identifier:1/0}]}:function(e){return[{type:"mouse",x:e.pageX,y:e.pageY,pageX:e.pageX,pageY:e.pageY,identifier:e.pointerId||1/0}]},n.getCoords(t)},n.getCoord=function(t){if("ontouchstart"in window){var o=0,a=0;n.getCoord=function(n){var t=n.changedTouches;return t&&t.length?{x:o=t[0].pageX,y:a=t[0].pageY}:{x:o,y:a}}}else n.getCoord="undefined"!=typeof t.pageX&&"undefined"!=typeof t.pageY?function(e){return{x:e.pageX,y:e.pageY}}:function(r){var t=document.documentElement;return r=r||window.event,{x:r.clientX+t.scrollLeft,y:r.clientY+t.scrollTop}};return n.getCoord(t)};var r=function(r,t){var e=parseFloat(r.getPropertyValue(t),10);return isFinite(e)?e:0};return n.getBoundingBox=function(i){(i===window||i===document)&&(i=document.body);var t={},e=i.getBoundingClientRect();t.width=e.width,t.height=e.height,t.x1=e.left,t.y1=e.top,t.scaleX=e.width/i.offsetWidth||1,t.scaleY=e.height/i.offsetHeight||1,t.scrollLeft=0,t.scrollTop=0;var d=window.getComputedStyle(i),n="border-box"===d.getPropertyValue("box-sizing");if(!1===n){var s=r(d,"border-left-width"),o=r(d,"border-right-width"),a=r(d,"border-bottom-width"),c=r(d,"border-top-width");t.border=[s,o,c,a],t.x1+=s,t.y1+=c,t.width-=o+s,t.height-=a+c}t.x2=t.x1+t.width,t.y2=t.y1+t.height;for(var g=d.getPropertyValue("position"),l="fixed"===g?i:i.parentNode;null!==l&&l!==document.body&&void 0!==l.scrollTop;){var d=window.getComputedStyle(l),g=d.getPropertyValue("position");if("absolute"===g);else{if("fixed"===g){t.scrollTop-=l.parentNode.scrollTop,t.scrollLeft-=l.parentNode.scrollLeft;break}t.scrollLeft+=l.scrollLeft,t.scrollTop+=l.scrollTop}l=l.parentNode}return t.scrollBodyLeft=void 0===window.pageXOffset?(document.documentElement||document.body.parentNode||document.body).scrollLeft:window.pageXOffset,t.scrollBodyTop=void 0===window.pageYOffset?(document.documentElement||document.body.parentNode||document.body).scrollTop:window.pageYOffset,t.scrollLeft-=t.scrollBodyLeft,t.scrollTop-=t.scrollBodyTop,t},function(){var t,e=navigator.userAgent.toLowerCase(),o=-1!==e.indexOf("macintosh");t=o&&-1!==e.indexOf("khtml")?{91:!0,93:!0}:o&&-1!==e.indexOf("firefox")?{224:!0}:{17:!0},(n.metaTrackerReset=function(){eventjs.fnKey=n.fnKey=!1,eventjs.metaKey=n.metaKey=!1,eventjs.escKey=n.escKey=!1,eventjs.ctrlKey=n.ctrlKey=!1,eventjs.shiftKey=n.shiftKey=!1,eventjs.altKey=n.altKey=!1})(),n.metaTracker=function(e){var o="keydown"===e.type;27===e.keyCode&&(eventjs.escKey=n.escKey=o),t[e.keyCode]&&(eventjs.metaKey=n.metaKey=o),eventjs.ctrlKey=n.ctrlKey=e.ctrlKey,eventjs.shiftKey=n.shiftKey=e.shiftKey,eventjs.altKey=n.altKey=e.altKey}}(),n}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if(eventjs.MutationObserver=function(){var o=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,n=!o&&function(){var r=document.createElement("p"),t=!1,e=function(){t=!0};if(r.addEventListener)r.addEventListener("DOMAttrModified",e,!1);else{if(!r.attachEvent)return!1;r.attachEvent("onDOMAttrModified",e)}return r.setAttribute("id","target"),t}();return function(e,i){if(o){var t=new o(function(e){e.forEach(function(e){i.call(e.target,e.attributeName)})});t.observe(e,{subtree:!1,attributes:!0})}else n?eventjs.add(e,"DOMAttrModified",function(r){i.call(e,r.attrName)}):"onpropertychange"in document.body&&eventjs.add(e,"propertychange",function(){i.call(e,window.event.propertyName)})}}(),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(d){"use strict";return d.click=function(t){t.gesture=t.gesture||"click",t.maxFingers=t.maxFingers||t.fingers||1,t.onPointerDown=function(o){d.pointerStart(o,e,t)&&eventjs.add(t.target,"mouseup",t.onPointerUp)},t.onPointerUp=function(i){if(d.pointerEnd(i,e,t)){eventjs.remove(t.target,"mouseup",t.onPointerUp);var r=i.changedTouches||d.getCoords(i),n=r[0],s=t.bbox,o=d.getBoundingBox(t.target),a=n.pageY-o.scrollBodyTop,c=n.pageX-o.scrollBodyLeft;if(c>s.x1&&a>s.y1&&c<s.x2&&a<s.y2&&s.scrollTop===o.scrollTop){for(var g in t.tracker)break;var l=t.tracker[g];e.x=l.start.x,e.y=l.start.y,t.listener(i,e)}}};var e=d.pointerSetup(t);return e.state="click",eventjs.add(t.target,"mousedown",t.onPointerDown),e},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.click=d.click,d}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(d){"use strict";var t=Math.abs;return d.dbltap=d.dblclick=function(g){g.gesture=g.gesture||"dbltap",g.maxFingers=g.maxFingers||g.fingers||1;var e,i,p,n,s,u=700;g.onPointerDown=function(t){var o=t.changedTouches||d.getCoords(t);e&&!i?(s=o[0],i=new Date().getTime()-e):(n=o[0],e=new Date().getTime(),i=0,clearTimeout(p),p=setTimeout(function(){e=0},u)),d.pointerStart(t,a,g)&&(eventjs.add(g.target,"mousemove",g.onPointerMove).listener(t),eventjs.add(g.target,"mouseup",g.onPointerUp))},g.onPointerMove=function(o){if(e&&!i){var a=o.changedTouches||d.getCoords(o);s=a[0]}var c=g.bbox,h=s.pageX-c.x1,l=s.pageY-c.y1;0<h&&h<c.width&&0<l&&l<c.height&&25>=t(s.pageX-n.pageX)&&25>=t(s.pageY-n.pageY)||(eventjs.remove(g.target,"mousemove",g.onPointerMove),clearTimeout(p),e=i=0)},g.onPointerUp=function(t){if(d.pointerEnd(t,a,g)&&(eventjs.remove(g.target,"mousemove",g.onPointerMove),eventjs.remove(g.target,"mouseup",g.onPointerUp)),e&&i){if(u>=i){for(var r in a.state=g.gesture,g.tracker)break;var o=g.tracker[r];a.x=o.start.x,a.y=o.start.y,g.listener(t,a)}clearTimeout(p),e=i=0}};var a=d.pointerSetup(g);return a.state="dblclick",eventjs.add(g.target,"mousedown",g.onPointerDown),a},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.dbltap=d.dbltap,eventjs.Gesture._gestureHandlers.dblclick=d.dblclick,d}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(d){"use strict";return d.dragElement=function(r,t){d.drag({event:t,target:r,position:"move",listener:function(e,t){r.style.left=t.x+"px",r.style.top=t.y+"px",eventjs.prevent(e)}})},d.drag=function(t){t.gesture="drag",t.onPointerDown=function(o){d.pointerStart(o,e,t)&&(t.monitor||(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp))),t.onPointerMove(o,"down")},t.onPointerMove=function(i,r){if(!t.tracker)return t.onPointerDown(i);for(var n=(t.bbox,i.changedTouches||d.getCoords(i)),s=n.length,o=0;s>o;o++){var a=n[o],c=a.identifier||1/0,u=t.tracker[c];u&&(u.pageX=a.pageX,u.pageY=a.pageY,e.state=r||"move",e.identifier=c,e.start=u.start,e.fingers=t.fingers,"differenceFromLast"===t.position?(e.x=u.pageX-u.offsetX,e.y=u.pageY-u.offsetY,u.offsetX=u.pageX,u.offsetY=u.pageY):(e.x=u.pageX-u.offsetX,e.y=u.pageY-u.offsetY),t.listener(i,e))}},t.onPointerUp=function(o){d.pointerEnd(o,e,t,t.onPointerMove)&&(t.monitor||(eventjs.remove(t.doc,"mousemove",t.onPointerMove),eventjs.remove(t.doc,"mouseup",t.onPointerUp)))};var e=d.pointerSetup(t);return t.event?t.onPointerDown(t.event):(eventjs.add(t.target,"mousedown",t.onPointerDown),t.monitor&&(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp))),e},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.drag=d.drag,d}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(g){"use strict";var t=Math.atan2,r=Math.sqrt,o=Math.PI/180,s=function(a,t){var e=0,i=0,r=0;for(var n in t){var s=t[n];s.up||(e+=s.move.x,i+=s.move.y,r++)}return a.x=e/=r,a.y=i/=r,a};return g.gesture=function(x){x.gesture=x.gesture||"gesture",x.minFingers=x.minFingers||x.fingers||2,x.onPointerDown=function(t){var e=x.fingers;if(g.pointerStart(t,l,x)&&(eventjs.add(x.doc,"mousemove",x.onPointerMove),eventjs.add(x.doc,"mouseup",x.onPointerUp)),x.fingers===x.minFingers&&e!==x.fingers){l.fingers=x.minFingers,l.scale=1,l.rotation=0,l.state="start";var r="";for(var o in x.tracker)r+=o;l.identifier=parseInt(r),s(l,x.tracker),x.listener(t,l)}},x.onPointerMove=function(e){for(var n=x.bbox,i=x.tracker,a=e.changedTouches||g.getCoords(e),c=a.length,h=0;c>h;h++){var C=a[h],u=C.identifier||1/0,f=i[u];f&&(f.move.x=C.pageX-n.x1,f.move.y=C.pageY-n.y1)}if(!(x.fingers<x.minFingers)){var a=[],d=0,S=0;for(var u in s(l,i),i){var C=i[u];if(!C.up){var p=C.start;if(!p.distance){var v=p.x-l.x,b=p.y-l.y;p.distance=r(v*v+b*b),p.angle=t(v,b)/o}var v=C.move.x-l.x,b=C.move.y-l.y,m=r(v*v+b*b);d+=m/p.distance;var y=t(v,b)/o,_=(p.angle-y+360)%360-180;C.DEG2=C.DEG1,C.DEG1=0<_?_:-_,"undefined"!=typeof C.DEG2&&(0<_?C.rotation+=C.DEG1-C.DEG2:C.rotation-=C.DEG1-C.DEG2,S+=C.rotation),a.push(C.move)}}l.touches=a,l.fingers=x.fingers,l.scale=d/x.fingers,l.rotation=S/x.fingers,l.state="change",x.listener(e,l)}},x.onPointerUp=function(t){var e=x.fingers;g.pointerEnd(t,l,x)&&(eventjs.remove(x.doc,"mousemove",x.onPointerMove),eventjs.remove(x.doc,"mouseup",x.onPointerUp)),e===x.minFingers&&x.fingers<x.minFingers&&(l.fingers=x.fingers,l.state="end",x.listener(t,l))};var l=g.pointerSetup(x);return eventjs.add(x.target,"mousedown",x.onPointerDown),l},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.gesture=g.gesture,g}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(o){"use strict";return o.pointerdown=o.pointermove=o.pointerup=function(n){if(n.gesture=n.gesture||"pointer",!n.target.isPointerEmitter){var e=!0;n.onPointerDown=function(r){e=!1,i.gesture="pointerdown",n.listener(r,i)},n.onPointerMove=function(r){i.gesture="pointermove",n.listener(r,i,e)},n.onPointerUp=function(r){e=!0,i.gesture="pointerup",n.listener(r,i,!0)};var i=o.pointerSetup(n);return eventjs.add(n.target,"mousedown",n.onPointerDown),eventjs.add(n.target,"mousemove",n.onPointerMove),eventjs.add(n.doc,"mouseup",n.onPointerUp),n.target.isPointerEmitter=!0,i}},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.pointerdown=o.pointerdown,eventjs.Gesture._gestureHandlers.pointermove=o.pointermove,eventjs.Gesture._gestureHandlers.pointerup=o.pointerup,o}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";var r=Math.abs;return e.shake=function(n){var t={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:n.target,listener:n.listener,remove:function(){window.removeEventListener("devicemotion",a,!1)}},e=new Date().getTime(),o={x:0,y:0,z:0},i={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},a=function(a){var s=.8,l=a.accelerationIncludingGravity;if(o.x=s*o.x+(1-s)*l.x,o.y=s*o.y+(1-s)*l.y,o.z=s*o.z+(1-s)*l.z,t.accelerationIncludingGravity=o,t.acceleration.x=l.x-o.x,t.acceleration.y=l.y-o.y,t.acceleration.z=l.z-o.z,"devicemotion"===n.gesture)return void n.listener(a,t);for(var c="xyz",u=new Date().getTime(),d=0,g=c.length;g>d;d++){var p=c[d],h=t.acceleration[p],f=i[p],m=r(h);if(!(1e3>u-e)&&m>4){var y=u*h/m,_=r(y+f.value);f.value&&200>_?(f.value=y,f.count++,f.count===3&&(n.listener(a,t),e=u,f.value=0,f.count=0)):(f.value=y,f.count=1)}}};return window.addEventListener?(window.addEventListener("devicemotion",a,!1),t):void 0},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.shake=e.shake,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(_){"use strict";var t=Math.PI/180;return _.swipe=function(x){x.snap=x.snap||90,x.threshold=x.threshold||1,x.gesture=x.gesture||"swipe",x.onPointerDown=function(t){_.pointerStart(t,i,x)&&(eventjs.add(x.doc,"mousemove",x.onPointerMove).listener(t),eventjs.add(x.doc,"mouseup",x.onPointerUp))},x.onPointerMove=function(t){for(var e=t.changedTouches||_.getCoords(t),r=e.length,n=0;r>n;n++){var i=e[n],o=i.identifier||1/0,a=x.tracker[o];a&&(a.move.x=i.pageX,a.move.y=i.pageY,a.moveTime=new Date().getTime())}},x.onPointerUp=function(e){if(_.pointerEnd(e,i,x)){eventjs.remove(x.doc,"mousemove",x.onPointerMove),eventjs.remove(x.doc,"mouseup",x.onPointerUp);var r,n,o,s,c={x:0,y:0},h=0,l=0,u=0;for(var f in x.tracker){var d=x.tracker[f],g=d.move.x-d.start.x,p=d.move.y-d.start.y;h+=d.move.x,l+=d.move.y,c.x+=d.start.x,c.y+=d.start.y,u++;var v=Math.sqrt(g*g+p*p),C=d.moveTime-d.startTime,s=Math.atan2(g,p)/t+180,n=C?v/C:0;if("undefined"==typeof o)o=s,r=n;else{if(!(20>=Math.abs(s-o)))return;o=(o+s)/2,r=(r+n)/2}}var m=x.gestureFingers;x.minFingers<=m&&x.maxFingers>=m&&r>x.threshold&&(c.x/=u,c.y/=u,i.start=c,i.x=h/u,i.y=l/u,i.angle=-(((o/x.snap+.5>>0)*x.snap||360)-360),i.velocity=r,i.fingers=m,i.state="swipe",x.listener(e,i))}};var i=_.pointerSetup(x);return eventjs.add(x.target,"mousedown",x.onPointerDown),i},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.swipe=_.swipe,_}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(p){"use strict";return p.longpress=function(t){return t.gesture="longpress",p.tap(t)},p.tap=function(m){m.delay=m.delay||500,m.timeout=m.timeout||250,m.driftDeviance=m.driftDeviance||10,m.gesture=m.gesture||"tap";var e,t;m.onPointerDown=function(o){if(p.pointerStart(o,a,m)){if(e=new Date().getTime(),eventjs.add(m.doc,"mousemove",m.onPointerMove).listener(o),eventjs.add(m.doc,"mouseup",m.onPointerUp),"longpress"!==m.gesture)return;t=setTimeout(function(){if(!(o.cancelBubble&&1<++o.cancelBubbleCount)){var e=0;for(var t in m.tracker){var n=m.tracker[t];if(!0===n.end)return;if(m.cancel)return;e++}m.minFingers<=e&&m.maxFingers>=e&&(a.state="start",a.fingers=e,a.x=n.start.x,a.y=n.start.y,m.listener(o,a))}},m.delay)}},m.onPointerMove=function(e){for(var t=m.bbox,r=e.changedTouches||p.getCoords(e),n=r.length,i=0;n>i;i++){var o=r[i],a=o.identifier||1/0,s=m.tracker[a];if(s){var c=o.pageX-t.x1,l=o.pageY-t.y1,u=c-s.start.x,h=l-s.start.y,d=Math.sqrt(u*u+h*h);if(!(0<c&&c<t.width&&0<l&&l<t.height&&d<=m.driftDeviance))return eventjs.remove(m.doc,"mousemove",m.onPointerMove),void(m.cancel=!0)}}},m.onPointerUp=function(r){if(p.pointerEnd(r,a,m)){if(clearTimeout(t),eventjs.remove(m.doc,"mousemove",m.onPointerMove),eventjs.remove(m.doc,"mouseup",m.onPointerUp),r.cancelBubble&&1<++r.cancelBubbleCount)return;if("longpress"===m.gesture)return void("start"===a.state&&(a.state="end",m.listener(r,a)));if(m.cancel)return;if(new Date().getTime()-e>m.timeout)return;var n=m.gestureFingers;m.minFingers<=n&&m.maxFingers>=n&&(a.state="tap",a.fingers=m.gestureFingers,m.listener(r,a))}};var a=p.pointerSetup(m);return eventjs.add(m.target,"mousedown",m.onPointerDown),a},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.tap=p.tap,eventjs.Gesture._gestureHandlers.longpress=p.longpress,p}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.wheelPreventElasticBounce=function(e){e&&("string"==typeof e&&(e=document.querySelector(e)),eventjs.add(e,"wheel",function(r,t){t.preventElasticBounce(),eventjs.stop(r)}))},e.wheel=function(l){var t,e=l.timeout||150,i=0,r={gesture:"wheel",state:"start",wheelDelta:0,target:l.target,listener:l.listener,preventElasticBounce:function(o){var t=this.target,e=t.scrollTop,i=e+t.offsetHeight,r=t.scrollHeight;i===r&&0>=this.wheelDelta?eventjs.cancel(o):0===e&&0<=this.wheelDelta&&eventjs.cancel(o),eventjs.stop(o)},add:function(){l.target[s](a,n,!1)},remove:function(){l.target[o](a,n,!1)}},n=function(o){o=o||window.event,r.state=i++?"change":"start",r.wheelDelta=o.detail?-20*o.detail:o.wheelDelta,l.listener(o,r),clearTimeout(t),t=setTimeout(function(){i=0,r.state="end",r.wheelDelta=0,l.listener(o,r)},e)},s=document.addEventListener?"addEventListener":"attachEvent",o=document.removeEventListener?"removeEventListener":"detachEvent",a=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";return l.target[s](a,n,!1),r},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.wheel=e.wheel,e}(eventjs.proxy),"undefined"==typeof Event)var Event={};"undefined"==typeof Event.proxy&&(Event.proxy={}),Event.proxy=function(e){"use strict";return e.orientation=function(r){var t={gesture:"orientationchange",previous:null,current:window.orientation,target:r.target,listener:r.listener,remove:function(){window.removeEventListener("orientationchange",e,!1)}},e=function(e){return t.previous=t.current,t.current=window.orientation,null!==t.previous&&t.previous!=t.current?void r.listener(e,t):void 0};return window.DeviceOrientationEvent&&window.addEventListener("orientationchange",e,!1),t},Event.Gesture=Event.Gesture||{},Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{},Event.Gesture._gestureHandlers.orientation=e.orientation,e}(Event.proxy),!function(){function o(r,o){if(this.__eventListeners[r]){var e=this.__eventListeners[r];o?e[e.indexOf(o)]=!1:fabric.util.array.fill(e,!1)}}function t(r,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var o in r)this.on(o,r[o]);else this.__eventListeners[r]||(this.__eventListeners[r]=[]),this.__eventListeners[r].push(t);return this}function n(t,e){if(this.__eventListeners){if(0===arguments.length)for(t in this.__eventListeners)o.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var n in t)o.call(this,n,t[n]);else o.call(this,t,e);return this}}function a(o,t){if(this.__eventListeners){var e=this.__eventListeners[o];if(e){for(var i=0,a=e.length;a>i;i++)e[i]&&e[i].call(this,t||{});return this.__eventListeners[o]=e.filter(function(e){return!1!==e}),this}}}fabric.Observable={observe:t,stopObserving:n,fire:a,on:t,off:n,trigger:a}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var r=0,t=arguments.length;t>r;r++)this._onObjectAdded(arguments[r]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(o,t,e){var n=this.getObjects();return e?n[t]=o:n.splice(t,0,o),this._onObjectAdded&&this._onObjectAdded(o),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var o,t=this.getObjects(),e=!1,i=0,r=arguments.length;r>i;i++)o=t.indexOf(arguments[i]),-1!==o&&(e=!0,t.splice(o,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[i]));return this.renderOnAddRemove&&e&&this.requestRenderAll(),this},forEachObject:function(o,t){for(var e=this.getObjects(),i=0,r=e.length;r>i;i++)o.call(t,e[i],i,e);return this},getObjects:function(r){return"undefined"==typeof r?this._objects:this._objects.filter(function(t){return t.type===r})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(e){return-1<this.getObjects().indexOf(e)},complexity:function(){return this.getObjects().reduce(function(r,t){return r+=t.complexity?t.complexity():0},0)}},fabric.CommonMethods={_setOptions:function(r){for(var t in r)this.set(t,r[t])},_initGradient:function(r,t){r&&r.colorStops&&!(r instanceof fabric.Gradient)&&this.set(t,new fabric.Gradient(r))},_initPattern:function(r,t,e){r&&r.source&&!(r instanceof fabric.Pattern)?this.set(t,new fabric.Pattern(r,e)):e&&e()},_initClipping:function(r){if(r.clipTo&&"string"==typeof r.clipTo){var t=fabric.util.getFunctionBody(r.clipTo);"undefined"!=typeof t&&(this.clipTo=new Function("ctx",t))}},_setObject:function(r){for(var t in r)this._set(t,r[t])},set:function(r,o){return"object"==typeof r?this._setObject(r):"function"==typeof o&&"clipTo"!==r?this._set(r,o(this.get(r))):this._set(r,o),this},_set:function(r,t){this[r]=t},toggle:function(r){var t=this.get(r);return"boolean"==typeof t&&this.set(r,!t),this},get:function(e){return this[e]}},!function(o){var a=Math.max,l=Math.min,c=Math.floor,d=Math.sqrt,p=d,e=Math.atan2,i=Math.pow,u=Math.abs,g=Math.PI/180;fabric.util={removeFromArray:function(r,t){var e=r.indexOf(t);return-1!==e&&r.splice(e,1),r},getRandomInt:function(r,t){return c(Math.random()*(t-r+1))+r},degreesToRadians:function(e){return e*g},radiansToDegrees:function(e){return e/g},rotatePoint:function(o,t,e){o.subtractEquals(t);var n=fabric.util.rotateVector(o,e);return new fabric.Point(n.x,n.y).addEquals(t)},rotateVector:function(o,t){var e=Math.sin(t),i=Math.cos(t),r=o.x*i-o.y*e,a=o.x*e+o.y*i;return{x:r,y:a}},transformPoint:function(r,t,e){return e?new fabric.Point(t[0]*r.x+t[2]*r.y,t[1]*r.x+t[3]*r.y):new fabric.Point(t[0]*r.x+t[2]*r.y+t[4],t[1]*r.x+t[3]*r.y+t[5])},makeBoundingBoxFromPoints:function(n){var t=[n[0].x,n[1].x,n[2].x,n[3].x],e=fabric.util.array.min(t),l=fabric.util.array.max(t),r=[n[0].y,n[1].y,n[2].y,n[3].y],s=fabric.util.array.min(r),c=fabric.util.array.max(r);return{left:e,top:s,width:l-e,height:c-s}},invertTransform:function(o){var t=1/(o[0]*o[3]-o[1]*o[2]),n=[t*o[3],-t*o[1],-t*o[2],t*o[0]],i=fabric.util.transformPoint({x:o[4],y:o[5]},n,!0);return n[4]=-i.x,n[5]=-i.y,n},toFixed:function(r,o){return parseFloat((+r).toFixed(o))},parseUnit:function(o,t){var e=/\D{0,2}$/.exec(o),n=parseFloat(o);switch(t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE),e[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return 12*(n*fabric.DPI/72);case"em":return n*t;default:return n;}},falseFunction:function(){return!1},getKlass:function(r,t){return r=fabric.util.string.camelize(r.charAt(0).toUpperCase()+r.slice(1)),fabric.util.resolveNamespace(t)[r]},getSvgAttributes:function(r){var t=["instantiated_by_use","style","id","class"];return"linearGradient"===r?t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]):"radialGradient"===r?t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]):"stop"===r?t=t.concat(["offset","stop-color","stop-opacity"]):void 0,t},resolveNamespace:function(t){if(!t)return fabric;var a,i=t.split("."),r=i.length,n=o||fabric.window;for(a=0;r>a;++a)n=n[i[a]];return n},loadImage:function(o,a,e,i){if(!o)return void(a&&a.call(e,o));var r=fabric.util.createImage(),n=function(){a&&a.call(e,r),r=r.onload=r.onerror=null};r.onload=n,r.onerror=function(){fabric.log("Error loading "+r.src),a&&a.call(e,null,!0),r=r.onload=r.onerror=null},0!==o.indexOf("data")&&i&&(r.crossOrigin=i),"data:image/svg"===o.substring(0,14)&&(r.onload=null,fabric.util.loadImageInDom(r,n)),r.src=o},loadImageInDom:function(r,t){var e=fabric.document.createElement("div");e.style.width=e.style.height="1px",e.style.left=e.style.top="-100%",e.style.position="absolute",e.appendChild(r),fabric.document.querySelector("body").appendChild(e),r.onload=function(){t(),e.parentNode.removeChild(e),e=null}},enlivenObjects:function(l,t,c,d){function r(){++e===o&&t&&t(n)}l=l||[];var n=[],e=0,o=l.length;return o?void l.forEach(function(a,s){if(!a||!a.type)return void r();var e=fabric.util.getKlass(a.type,c);e.fromObject(a,function(e,t){t||(n[s]=e),d&&d(a,e,t),r()})}):void(t&&t(n))},enlivenPatterns:function(o,t){function a(){++e===r&&t&&t(i)}o=o||[];var i=[],e=0,r=o.length;return r?void o.forEach(function(r,o){r&&r.source?new fabric.Pattern(r,function(e){i[o]=e,a()}):(i[o]=r,a())}):void(t&&t(i))},groupSVGElements:function(o,t,e){var n;return 1===o.length?o[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),n=new fabric.Group(o,t),"undefined"!=typeof e&&(n.sourcePath=e),n)},populateWithProperties:function(o,t,e){if(e&&"[object Array]"===Object.prototype.toString.call(e))for(var i=0,r=e.length;r>i;i++)e[i]in o&&(t[e[i]]=o[e[i]])},drawDashedLine:function(i,t,r,n,s,o){var a=n-t,c=s-r,h=p(a*a+c*c),l=e(c,a),u=o.length,f=0,d=!0;for(i.save(),i.translate(t,r),i.moveTo(0,0),i.rotate(l),t=0;h>t;)t+=o[f++%u],t>h&&(t=h),i[d?"lineTo":"moveTo"](t,0),d=!d;i.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},createImage:function(){return fabric.document.createElement("img")},clipContext:function(r,t){t.save(),t.beginPath(),r.clipTo(t),t.clip()},multiplyTransformMatrices:function(r,t,e){return[r[0]*t[0]+r[2]*t[1],r[1]*t[0]+r[3]*t[1],r[0]*t[2]+r[2]*t[3],r[1]*t[2]+r[3]*t[3],e?0:r[0]*t[4]+r[2]*t[5]+r[4],e?0:r[1]*t[4]+r[3]*t[5]+r[5]]},qrDecompose:function(r){var t=e(r[1],r[0]),n=i(r[0],2)+i(r[1],2),o=p(n),s=(r[0]*r[3]-r[2]*r[1])/o,l=e(r[0]*r[2]+r[1]*r[3],n);return{angle:t/g,scaleX:o,scaleY:s,skewX:l/g,skewY:0,translateX:r[4],translateY:r[5]}},customTransformMatrix:function(n,t,e){var i=[1,0,u(Math.tan(e*g)),1],r=[u(n),0,0,u(t)];return fabric.util.multiplyTransformMatrices(r,i,!0)},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},getFunctionBody:function(e){return((e+"").match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(l,t,e,i){0<i&&(t>i?t-=i:t=0,e>i?e-=i:e=0);var r,n,s=!0,o=l.getImageData(t,e,2*i||1,2*i||1),a=o.data.length;for(r=3;a>r&&(n=o.data[r],s=0>=n,!1!==s);r+=4);return o=null,s},parsePreserveAspectRatioAttribute:function(o){var t,e="meet",a="Mid",l="Mid",c=o.split(" ");return c&&c.length&&(e=c.pop(),"meet"!==e&&"slice"!==e?(t=e,e="meet"):c.length&&(t=c.pop())),a="none"===t?"none":t.slice(1,4),l="none"===t?"none":t.slice(5,8),{meetOrSlice:e,alignX:a,alignY:l}},clearFabricFontCache:function(e){e?fabric.charWidthsCache[e]&&delete fabric.charWidthsCache[e]:fabric.charWidthsCache={}},limitDimsByArea:function(o,t){var e=d(t*o),n=c(t/e);return{x:c(e),y:n}},capValue:function(r,t,e){return a(r,l(t,e))},findScaleToFit:function(r,t){return l(t.width/r.width,t.height/r.height)},findScaleToCover:function(r,t){return a(t.width/r.width,t.height/r.height)}}}("undefined"==typeof exports?this:exports),!function(){fabric.util.createAccessors=function(a){var t,e,i,r,n,o=a.prototype;for(t=o.stateProperties.length;t--;)e=o.stateProperties[t],i=e.charAt(0).toUpperCase()+e.slice(1),r="set"+i,n="get"+i,o[n]||(o[n]=function(e){return new Function("return this.get(\""+e+"\")")}(e)),o[r]||(o[r]=function(e){return new Function("value","return this.set(\""+e+"\", value)")}(e))}}("undefined"==typeof exports?this:exports),!function(){function m(n,a,r,s,o,c,h){var U=z.call(arguments);if(W[U])return W[U];var u=I,f=h*u/180,d=M(f),g=T(f),H=0,v=0;r=B(r),s=B(s);var b=.5*(-g*n)-.5*(d*a),G=.5*(-g*a)+.5*(d*n),N=r*r,_=s*s,w=G*G,C=b*b,x=N*_-N*w-_*C,j=0;if(0>x){var V=i(1-x/(N*_));r*=V,s*=V}else j=(o===c?-1:1)*i(x/(N*w+_*C));var S=j*r*G/s,k=-j*s*b/r,P=e(1,0,(b-S)/r,(G-k)/s),E=e((b-S)/r,(G-k)/s,(-b-S)/r,(-G-k)/s);0===c&&0<E?E-=2*u:1===c&&0>E&&(E+=2*u);for(var D=Math.ceil(B(2*(E/u))),F=[],A=E/D,X=8/3*M(A/4)*M(A/4)/M(A/2),R=P+A,Y=0;D>Y;Y++)F[Y]=l(P,R,g,d,r,s,g*S-d*k+.5*n,d*S+g*k+.5*a,X,H,v),H=F[Y][4],v=F[Y][5],P=R,R+=A;return W[U]=F,F}function l(a,t,s,x,C,n,o,c,h,l,u){var f=z.call(arguments);if(_[f])return _[f];var d=T(a),g=M(a),p=T(t),v=M(t),b=s*C*p-x*n*v+o,m=x*C*p+s*n*v+c;return _[f]=[l+h*(-s*C*g-x*n*d),u+h*(-x*C*g+s*n*d),b+h*(s*C*v+x*n*p),m+h*(x*C*v-s*n*p),b,m],_[f]}function e(o,t,e,a){var r=c(t,o),n=c(a,e);return n>=r?n-r:2*I-(r-n)}function t(o,t,e,a,D,n,s,c){var h=z.call(arguments);if(y[h])return y[h];var l,u,F,L,g,p,v,b,m=Math.min,_=Math.max,w=B,C=[],x=[[],[]];u=6*o-12*e+6*D,l=-3*o+9*e-9*D+3*s,F=3*e-3*o;for(var j=0;2>j;++j)if(0<j&&(u=6*t-12*a+6*n,l=-3*t+9*a-9*n+3*c,F=3*a-3*t),1e-12>w(l)){if(1e-12>w(u))continue;L=-F/u,0<L&&1>L&&C.push(L)}else v=u*u-4*F*l,0>v||(b=i(v),g=(-u+b)/(2*l),0<g&&1>g&&C.push(g),p=(-u-b)/(2*l),0<p&&1>p&&C.push(p));for(var O,S,k,P=C.length,T=P;P--;)L=C[P],k=1-L,O=k*k*k*o+3*k*k*L*e+3*k*L*L*D+L*L*L*s,x[0][P]=O,S=k*k*k*t+3*k*k*L*a+3*k*L*L*n+L*L*L*c,x[1][P]=S;x[0][T]=o,x[1][T]=t,x[0][T+1]=s,x[1][T+1]=c;var A=[{x:m.apply(null,x[0]),y:m.apply(null,x[1])},{x:_.apply(null,x[0]),y:_.apply(null,x[1])}];return y[h]=A,A}var T=Math.cos,M=Math.sin,c=Math.atan2,i=Math.sqrt,I=Math.PI,B=Math.abs,W={},_={},y={},z=Array.prototype.join;fabric.util.drawArc=function(t,e,i,r){for(var n=r[0],s=r[1],o=r[2],a=r[3],c=r[4],h=r[5],l=r[6],u=[[],[],[],[]],f=m(h-e,l-i,n,s,a,c,o),d=0,g=f.length;g>d;d++)u[d][0]=f[d][0]+e,u[d][1]=f[d][1]+i,u[d][2]=f[d][2]+e,u[d][3]=f[d][3]+i,u[d][4]=f[d][4]+e,u[d][5]=f[d][5]+i,t.bezierCurveTo.apply(t,u[d])},fabric.util.getBoundsOfArc=function(r,e,i,n,s,o,a,c,h){for(var l,u=0,f=0,d=[],g=m(c-r,h-e,i,n,o,a,s),p=0,_=g.length;_>p;p++)l=t(u,f,g[p][0],g[p][1],g[p][2],g[p][3],g[p][4],g[p][5]),d.push({x:l[0].x+r,y:l[0].y+e}),d.push({x:l[1].x+r,y:l[1].y+e}),u=g[p][4],f=g[p][5];return d},fabric.util.getBoundsOfCurve=t}(),!function(){function r(s,l){for(var e=a.call(arguments,2),i=[],r=0,n=s.length;n>r;r++)i[r]=e.length?s[r][l].apply(s[r],e):s[r][l].call(s[r]);return i}function o(r,t){return i(r,t,function(r,t){return r>=t})}function i(o,t,e){if(o&&0!==o.length){var i=o.length-1,r=t?o[i][t]:o[i];if(t)for(;i--;)e(o[i][t],r)&&(r=o[i][t]);else for(;i--;)e(o[i],r)&&(r=o[i]);return r}}var a=Array.prototype.slice;fabric.util.array={fill:function(r,t){for(var e=r.length;e--;)r[e]=t;return r},invoke:r,min:function(r,t){return i(r,t,function(r,t){return t>r})},max:o}}(),!function(){function a(t,e,l){if(!l)for(var c in e)t[c]=e[c];else if(!fabric.isLikelyNode&&e instanceof Element)t=e;else if(e instanceof Array){t=[];for(var o=0,n=e.length;n>o;o++)t[o]=a({},e[o],l)}else if(e&&"object"==typeof e)for(var c in e)e.hasOwnProperty(c)&&(t[c]=a({},e[c],l));else t=e;return t}function r(t,r){return a({},t,r)}fabric.util.object={extend:a,clone:r},fabric.util.object.extend(fabric.util,fabric.Observable)}(),!function(){function o(e){return e.replace(/-+(.)?/g,function(r,t){return t?t.toUpperCase():""})}function i(r,t){return r.charAt(0).toUpperCase()+(t?r.slice(1):r.slice(1).toLowerCase())}function a(o){var t,e=0,n=[];for(e=0,t;e<o.length;e++)!1!==(t=s(o,e))&&n.push(t);return n}function s(o,t){var e=o.charCodeAt(t);if(isNaN(e))return"";if(55296>e||57343<e)return o.charAt(t);if(55296<=e&&56319>=e){if(o.length<=t+1)throw"High surrogate without following low surrogate";var i=o.charCodeAt(t+1);if(56320>i||57343<i)throw"High surrogate without following low surrogate";return o.charAt(t)+o.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";var r=o.charCodeAt(t-1);if(55296>r||56319<r)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:o,capitalize:i,escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:a}}(),!function(){function l(){}function t(r){for(var t,o=null,n=this;n.constructor.superclass;){if(t=n.constructor.superclass.prototype[r],n[r]!==t){o=t;break}n=n.constructor.superclass.prototype}return o?1<arguments.length?o.apply(this,d.call(arguments,1)):o.call(this):console.log("tried to callSuper "+r+", method not found in prototype chain",this)}function e(){function e(){this.initialize.apply(this,arguments)}var o=null,n=d.call(arguments,0);"function"==typeof n[0]&&(o=n.shift()),e.superclass=o,e.subclasses=[],o&&(l.prototype=o.prototype,e.prototype=new l,o.subclasses.push(e));for(var a=0,s=n.length;s>a;a++)u(e,n[a],o);return e.prototype.initialize||(e.prototype.initialize=r),e.prototype.constructor=e,e.prototype.callSuper=t,e}var d=Array.prototype.slice,r=function(){},n=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}(),u=function(o,a,e){for(var t in a)o.prototype[t]=t in o.prototype&&"function"==typeof o.prototype[t]&&-1<(a[t]+"").indexOf("callSuper")?function(o){return function(){var t=this.constructor.superclass;this.constructor.superclass=e;var r=a[o].apply(this,arguments);return this.constructor.superclass=t,"initialize"===o?void 0:r}}(t):a[t],n&&(a.toString!==Object.prototype.toString&&(o.prototype.toString=a.toString),a.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=a.valueOf))};fabric.util.createClass=e}(),!function(){function n(o){var a,e,i=Array.prototype.slice.call(arguments,1),r=i.length;for(e=0;r>e;e++)if(a=typeof o[i[e]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function c(r,t){return{handler:t,wrappedHandler:m(r,t)}}function m(o,t){return function(e){t.call(r(o),e||fabric.window.event)}}function i(o,t){return function(e){if(g[o]&&g[o][t])for(var i=g[o][t],r=0,n=i.length;n>r;r++)i[r].call(this,e||fabric.window.event)}}function e(o,t,e){var n="touchend"===o.type?"changedTouches":"touches";return o[n]&&o[n][0]?o[n][0][t]-(o[n][0][t]-o[n][0][e])||o[e]:o[e]}var r,o,a=function(){var r=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+r++)}}();!function(){var n={};r=function(t){return n[t]},o=function(t,e){n[t]=e}}();var t,s,l=n(fabric.document.documentElement,"addEventListener","removeEventListener")&&n(fabric.window,"addEventListener","removeEventListener"),u=n(fabric.document.documentElement,"attachEvent","detachEvent")&&n(fabric.window,"attachEvent","detachEvent"),h={},g={};l?(t=function(o,t,e,n){o&&o.addEventListener(t,e,!u&&n)},s=function(o,t,e,n){o&&o.removeEventListener(t,e,!u&&n)}):u?(t=function(e,t,i){if(e){var r=a(e);o(r,e),h[r]||(h[r]={}),h[r][t]||(h[r][t]=[]);var n=c(r,i);h[r][t].push(n),e.attachEvent("on"+t,n.wrappedHandler)}},s=function(l,t,e){if(l){var i,r=a(l);if(h[r]&&h[r][t])for(var n=0,s=h[r][t].length;s>n;n++)i=h[r][t][n],i&&i.handler===e&&(l.detachEvent("on"+t,i.wrappedHandler),h[r][t][n]=null)}}):(t=function(r,t,e){if(r){var o=a(r);if(g[o]||(g[o]={}),!g[o][t]){g[o][t]=[];var n=r["on"+t];n&&g[o][t].push(n),r["on"+t]=i(o,t)}g[o][t].push(e)}},s=function(l,t,e){if(l){var i=a(l);if(g[i]&&g[i][t])for(var r=g[i][t],n=0,s=r.length;s>n;n++)r[n]===e&&r.splice(n,1)}}),fabric.util.addListener=t,fabric.util.removeListener=s;var p=function(e){return e.clientX},f=function(e){return e.clientY};fabric.isTouchSupported&&(p=function(r){return e(r,"pageX","clientX")},f=function(r){return e(r,"pageY","clientY")}),fabric.util.getPointer=function(r){r||(r=fabric.window.event);var t=r.target||(typeof r.srcElement==="unknown"?null:r.srcElement),e=fabric.util.getScrollLeftTop(t);return{x:p(r)+e.left,y:f(r)+e.top}}}(),!function(){function o(o,s){var l=o.style;if(!l)return o;if("string"==typeof s)return o.style.cssText+=";"+s,-1<s.indexOf("opacity")?a(o,s.match(/opacity:\s*(\d?\.?\d*)/)[1]):o;for(var c in s)if("opacity"===c)a(o,s[c]);else{var r="float"===c||"cssFloat"===c?"undefined"==typeof l.styleFloat?"cssFloat":"styleFloat":c;l[r]=s[c]}return o}var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,i="string"==typeof t.style.filter,r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(e){return e};e?a=function(r,t){return r.style.opacity=t,r}:i&&(a=function(o,t){var e=o.style;return o.currentStyle&&!o.currentStyle.hasLayout&&(e.zoom=1),r.test(e.filter)?(t=.9999<=t?"":"alpha(opacity="+100*t+")",e.filter=e.filter.replace(r,t)):e.filter+=" alpha(opacity="+100*t+")",o}),fabric.util.setStyle=o}(),!function(){function i(e){return"string"==typeof e?fabric.document.getElementById(e):e}function d(o,t){var n=fabric.document.createElement(o);for(var i in t)"class"===i?n.className=t[i]:"for"===i?n.htmlFor=t[i]:n.setAttribute(i,t[i]);return n}function e(e,t,o){return"string"==typeof t&&(t=d(t,o)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t}function u(o){for(var t=0,a=0,s=fabric.document.documentElement,r=fabric.document.body||{scrollLeft:0,scrollTop:0};o&&(o.parentNode||o.host)&&(o=o.parentNode||o.host,o===fabric.document?(t=r.scrollLeft||s.scrollLeft||0,a=r.scrollTop||s.scrollTop||0):(t+=o.scrollLeft||0,a+=o.scrollTop||0),1!==o.nodeType||"fixed"!==fabric.util.getElementStyle(o,"position")););return{left:t,top:a}}function t(n){var t,e,i=n&&n.ownerDocument,l={left:0,top:0},d={left:0,top:0},s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!i)return d;for(var a in s)d[s[a]]+=parseInt(g(n,a),10)||0;return t=i.documentElement,"undefined"!=typeof n.getBoundingClientRect&&(l=n.getBoundingClientRect()),e=u(n),{left:l.left+e.left-(t.clientLeft||0)+d.left,top:l.top+e.top-(t.clientTop||0)+d.top}}var r,o=Array.prototype.slice,n=function(e){return o.call(e,0)};try{r=n(fabric.document.childNodes)instanceof Array}catch(e){}r||(n=function(r){for(var t=Array(r.length),e=r.length;e--;)t[e]=r[e];return t});var g;g=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(r,t){var e=fabric.document.defaultView.getComputedStyle(r,null);return e?e[t]:void 0}:function(r,t){var e=r.style[t];return!e&&r.currentStyle&&(e=r.currentStyle[t]),e},function(){function e(e){return"undefined"!=typeof e.onselectstart&&(e.onselectstart=fabric.util.falseFunction),o?e.style[o]="none":"string"==typeof e.unselectable&&(e.unselectable="on"),e}var t=fabric.document.documentElement.style,o="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=e,fabric.util.makeElementSelectable=function(e){return"undefined"!=typeof e.onselectstart&&(e.onselectstart=null),o?e.style[o]="":"string"==typeof e.unselectable&&(e.unselectable=""),e}}(),function(){function e(o,a){var e=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.onload=i.onreadystatechange=function(e){if(r){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;r=!1,a(e||fabric.window.event),i=i.onload=i.onreadystatechange=null}},i.src=o,e.appendChild(i)}fabric.util.getScript=e}(),fabric.util.getById=i,fabric.util.toArray=n,fabric.util.makeElement=d,fabric.util.addClass=function(r,t){r&&-1===(" "+r.className+" ").indexOf(" "+t+" ")&&(r.className+=(r.className?" ":"")+t)},fabric.util.wrapElement=e,fabric.util.getScrollLeftTop=u,fabric.util.getElementOffset=t,fabric.util.getElementStyle=g}(),!function(){function l(r,o){return r+(/\?/.test(r)?"&":"?")+o}function t(){}function e(e,r){r||(r={});var n=r.method?r.method.toUpperCase():"GET",o=r.onComplete||function(){},s=d(),a=r.body||r.parameters;return s.onreadystatechange=function(){4===s.readyState&&(o(s),s.onreadystatechange=t)},"GET"===n&&(a=null,"string"==typeof r.parameters&&(e=l(e,r.parameters))),s.open(n,e,!0),("POST"===n||"PUT"===n)&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(a),s}var d=function(){for(var r=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],t=r.length;t--;)try{var e=r[t]();if(e)return r[t]}catch(e){}}();fabric.util.request=e}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(e){"undefined"!=typeof console[e]&&"function"==typeof console[e].apply&&(fabric[e]=function(){return console[e].apply(console,arguments)})}),!function(){function p(){return!1}function t(i){_(function(e){i||(i={});var y,r=e||+new Date,o=i.duration||500,s=r+o,a=i.onChange||p,c=i.abort||p,h=i.onComplete||p,l=i.easing||function(r,t,e,o){return-e*Math.cos(r/o*(Math.PI/2))+e+t},u="startValue"in i?i.startValue:0,f="endValue"in i?i.endValue:100,d=i.byValue||f-u;i.onStart&&i.onStart(),function e(g){if(c())return void h(f,1,1);y=g||+new Date;var t=y>s?o:y-r,n=l(t,u,d,o),p=Math.abs((n-u)/d);return a(n,p,t/o),y>s?void(i.onComplete&&i.onComplete()):void _(e)}(r)})}function _(){return e.apply(fabric.window,arguments)}var e=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(e){return fabric.window.setTimeout(e,1e3/60)},r=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;fabric.util.animate=t,fabric.util.requestAnimFrame=_,fabric.util.cancelAnimFrame=function(){return r.apply(fabric.window,arguments)}}(),!function(){function a(r,o,e){var i="rgba("+parseInt(r[0]+e*(o[0]-r[0]),10)+","+parseInt(r[1]+e*(o[1]-r[1]),10)+","+parseInt(r[2]+e*(o[2]-r[2]),10);return i+=","+(r&&o?parseFloat(r[3]+e*(o[3]-r[3])):1),i+=")"}function t(t,l,i,c){var r=new fabric.Color(t).getSource(),n=new fabric.Color(l).getSource();c=c||{},fabric.util.animate(fabric.util.object.extend(c,{duration:i||500,startValue:r,endValue:n,byValue:n,easing:function(t,e,r,n){var o=c.colorEasing?c.colorEasing(t,n):1-Math.cos(t/n*(Math.PI/2));return a(e,r,o)}}))}fabric.util.animateColor=t}(),!function(){function l(o,n,a,s){return o<Math.abs(n)?(o=n,s=a/4):s=0===n&&0===o?1.5707963267948966*(a/(2*g)):a/(2*g)*Math.asin(n/o),{a:o,c:n,p:a,s:s}}function t(r,t,o){return r.a*u(2,10*(t-=1))*d(2*(t*o-r.s)*g/r.p)}function e(o,t,e,n){return e*((o=o/n-1)*o*o+1)+t}function o(o,t,e,n){return o/=n/2,1>o?e/2*o*o*o+t:e/2*((o-=2)*o*o+2)+t}function n(o,t,e,n){return e-a(n-o,0,e,n)+t}function a(o,t,e,n){return(o/=n)<1/2.75?7.5625*e*o*o+t:2/2.75>o?e*(7.5625*(o-=1.5/2.75)*o+.75)+t:2.5/2.75>o?e*(7.5625*(o-=2.25/2.75)*o+.9375)+t:e*(7.5625*(o-=2.625/2.75)*o+.984375)+t}var s=Math.cos,d=Math.sin,u=Math.pow,c=Math.sqrt,g=Math.PI;fabric.util.ease={easeInQuad:function(o,t,e,n){return e*(o/=n)*o+t},easeOutQuad:function(o,t,e,n){return-e*(o/=n)*(o-2)+t},easeInOutQuad:function(o,t,e,n){return o/=n/2,1>o?e/2*o*o+t:-e/2*(--o*(o-2)-1)+t},easeInCubic:function(o,t,e,n){return e*(o/=n)*o*o+t},easeOutCubic:e,easeInOutCubic:o,easeInQuart:function(o,t,e,n){return e*(o/=n)*o*o*o+t},easeOutQuart:function(o,t,e,n){return-e*((o=o/n-1)*o*o*o-1)+t},easeInOutQuart:function(o,t,e,n){return o/=n/2,1>o?e/2*o*o*o*o+t:-e/2*((o-=2)*o*o*o-2)+t},easeInQuint:function(o,t,e,n){return e*(o/=n)*o*o*o*o+t},easeOutQuint:function(o,t,e,n){return e*((o=o/n-1)*o*o*o*o+1)+t},easeInOutQuint:function(o,t,e,n){return o/=n/2,1>o?e/2*o*o*o*o*o+t:e/2*((o-=2)*o*o*o*o+2)+t},easeInSine:function(o,t,e,n){return-e*s(o/n*(g/2))+e+t},easeOutSine:function(o,t,e,n){return e*d(o/n*(g/2))+t},easeInOutSine:function(o,t,e,n){return-e/2*(s(g*o/n)-1)+t},easeInExpo:function(o,t,e,n){return 0===o?t:e*u(2,10*(o/n-1))+t},easeOutExpo:function(o,t,e,n){return o===n?t+e:e*(-u(2,-10*o/n)+1)+t},easeInOutExpo:function(o,t,e,n){return 0===o?t:o===n?t+e:(o/=n/2,1>o?e/2*u(2,10*(o-1))+t:e/2*(-u(2,-10*--o)+2)+t)},easeInCirc:function(o,t,e,n){return-e*(c(1-(o/=n)*o)-1)+t},easeOutCirc:function(o,t,e,n){return e*c(1-(o=o/n-1)*o)+t},easeInOutCirc:function(o,t,e,n){return o/=n/2,1>o?-e/2*(c(1-o*o)-1)+t:e/2*(c(1-(o-=2)*o)+1)+t},easeInElastic:function(e,o,r,n){var i=0;if(0===e)return o;if(e/=n,1===e)return o+r;i||(i=.3*n);var a=l(r,r,i,1.70158);return-t(a,e,n)+o},easeOutElastic:function(t,e,i,r){var n=0;if(0===t)return e;if(t/=r,1===t)return e+i;n||(n=.3*r);var o=l(i,i,n,1.70158);return o.a*u(2,-10*t)*d(2*(t*r-o.s)*g/o.p)+o.c+e},easeInOutElastic:function(e,o,r,n){var i=0;if(0===e)return o;if(e/=n/2,2===e)return o+r;i||(i=1.5*(.3*n));var a=l(r,r,i,1.70158);return 1>e?-.5*t(a,e,n)+o:.5*(a.a*u(2,-10*(e-=1))*d(2*(e*n-a.s)*g/a.p))+a.c+o},easeInBack:function(o,t,e,i,r){return void 0===r&&(r=1.70158),e*(o/=i)*o*((r+1)*o-r)+t},easeOutBack:function(o,t,e,i,r){return void 0===r&&(r=1.70158),e*((o=o/i-1)*o*((r+1)*o+r)+1)+t},easeInOutBack:function(o,t,e,i,r){return void 0===r&&(r=1.70158),o/=i/2,1>o?e/2*o*o*(((r*=1.525)+1)*o-r)+t:e/2*((o-=2)*o*(((r*=1.525)+1)*o+r)+2)+t},easeInBounce:n,easeOutBounce:a,easeInOutBounce:function(o,t,e,i){return i/2>o?.5*n(2*o,0,e,i)+t:.5*a(2*o-i,0,e,i)+.5*e+t}}}(),!function(x){"use strict";function t(e){return e in h?h[e]:e}function e(l,t,e,c){var r,n="[object Array]"===Object.prototype.toString.call(t);if(!("fill"!==l&&"stroke"!==l||"none"!==t))t="";else if("strokeDashArray"===l)t="none"===t?null:t.replace(/,/g," ").split(/\s+/).map(function(e){return parseFloat(e)});else if("transformMatrix"===l)t=e&&e.transformMatrix?p(e.transformMatrix,E.parseTransformAttribute(t)):E.parseTransformAttribute(t);else if("visible"===l)t="none"!==t&&"hidden"!==t,e&&!1===e.visible&&(t=!1);else if("opacity"===l)t=parseFloat(t),e&&"undefined"!=typeof e.opacity&&(t*=e.opacity);else if("textAnchor"===l)t="start"===t?"left":"end"===t?"right":"center";else if("paintFirst"===l){var d=t.indexOf("fill"),s=t.indexOf("stroke"),t="fill";-1<d&&-1<s&&d>s?t="stroke":-1===d&&-1<s&&(t="stroke")}else r=n?t.map(j):j(t,c);return!n&&isNaN(r)?t:r}function i(e){return new RegExp("^("+e.join("|")+")\\b","i")}function C(r){for(var t in m)if("undefined"!=typeof r[m[t]]&&""!==r[t]){if("undefined"==typeof r[t]){if(!E.Object.prototype[t])continue;r[t]=E.Object.prototype[t]}if(0!==r[t].indexOf("url(")){var e=new E.Color(r[t]);r[t]=e.setAlpha(g(e.getAlpha()*r[m[t]],2)).toRgba()}}return r}function O(a,t){var e,i,r,n,l=[];for(r=0,n=t.length;n>r;r++)e=t[r],i=a.getElementsByTagName(e),l=l.concat(Array.prototype.slice.call(i));return l}function r(o,a){var e,i;o.replace(/;\s*$/,"").split(";").forEach(function(r){var t=r.split(":");e=t[0].trim().toLowerCase(),i=t[1].trim(),a[e]=i})}function o(o,t){var e,i;for(var r in o)"undefined"!=typeof o[r]&&(e=r.toLowerCase(),i=o[r],t[e]=i)}function n(o,t){var e={};for(var i in E.cssRules[t])if(a(o,i.split(" ")))for(var r in E.cssRules[t][i])e[r]=E.cssRules[t][i][r];return e}function a(o,t){var e,n=!0;return e=l(o,t.pop()),e&&t.length&&(n=s(o,t)),e&&n&&0===t.length}function s(o,t){for(var e,n=!0;o.parentNode&&1===o.parentNode.nodeType&&t.length;)n&&(e=t.pop()),o=o.parentNode,n=l(o,e);return 0===t.length}function l(a,t){var e,i,r=a.nodeName,n=a.getAttribute("class"),o=a.getAttribute("id");if(e=new RegExp("^"+r,"i"),t=t.replace(e,""),o&&t.length&&(e=new RegExp("#"+o+"(?![a-zA-Z\\-]+)","i"),t=t.replace(e,"")),n&&t.length)for(n=n.split(" "),i=n.length;i--;)e=new RegExp("\\."+n[i]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(e,"");return 0===t.length}function D(a,t){var e;if(a.getElementById&&(e=a.getElementById(t)),e)return e;var i,r,n,o=a.getElementsByTagName("*");for(r=0,n=o.length;n>r;r++)if(i=o[r],t===i.getAttribute("id"))return i}function u(o){for(var t=O(o,["use","svg:use"]),e=0;t.length&&e<t.length;){var i,r,n,s,a,c=t[e],g=c.getAttribute("xlink:href").substr(1),l=c.getAttribute("x")||0,u=c.getAttribute("y")||0,h=D(o,g).cloneNode(!0),p=(h.getAttribute("transform")||"")+" translate("+l+", "+u+")",_=t.length;if(f(h),/^svg$/i.test(h.nodeName)){var y=h.ownerDocument.createElement("g");for(n=0,s=h.attributes,a=s.length;a>n;n++)r=s.item(n),y.setAttribute(r.nodeName,r.nodeValue);for(;h.firstChild;)y.appendChild(h.firstChild);h=y}for(n=0,s=c.attributes,a=s.length;a>n;n++)r=s.item(n),"x"!==r.nodeName&&"y"!==r.nodeName&&"xlink:href"!==r.nodeName&&("transform"===r.nodeName?p=r.nodeValue+" "+p:h.setAttribute(r.nodeName,r.nodeValue));h.setAttribute("transform",p),h.setAttribute("instantiated_by_use","1"),h.removeAttribute("id"),i=c.parentNode,i.replaceChild(h,c),t.length===_&&e++}}function f(v){var t,e,i,r,n=v.getAttribute("viewBox"),x=1,s=1,a=0,c=0,h=v.getAttribute("width"),C=v.getAttribute("height"),S=v.getAttribute("x")||0,f=v.getAttribute("y")||0,d=v.getAttribute("preserveAspectRatio")||"",T=!n||!E.svgViewBoxElementsRegEx.test(v.nodeName)||!(n=n.match(_)),p=!h||!C||"100%"===h||"100%"===C,b=T&&p,m={},y="";if(m.width=0,m.height=0,m.toBeParsed=b,b)return m;if(T)return m.width=j(h),m.height=j(C),m;if(a=-parseFloat(n[1]),c=-parseFloat(n[2]),t=parseFloat(n[3]),e=parseFloat(n[4]),p?(m.width=t,m.height=e):(m.width=j(h),m.height=j(C),x=m.width/t,s=m.height/e),d=E.util.parsePreserveAspectRatioAttribute(d),"none"!==d.alignX&&(s=x=x>s?s:x),1===x&&1===s&&0===a&&0===c&&0===S&&0===f)return m;if((S||f)&&(y=" translate("+j(S)+" "+j(f)+") "),i=y+" matrix("+x+" 0 0 "+s+" "+a*x+" "+c*s+") ","svg"===v.nodeName){for(r=v.ownerDocument.createElement("g");v.firstChild;)r.appendChild(v.firstChild);v.appendChild(r)}else r=v,i=r.getAttribute("transform")+i;return r.setAttribute("transform",i),m}function c(r,t){for(;r&&(r=r.parentNode);)if(r.nodeName&&t.test(r.nodeName.replace("svg:",""))&&!r.getAttribute("instantiated_by_use"))return!0;return!1}var E=x.fabric||(x.fabric={}),v=E.util.object.extend,d=E.util.object.clone,g=E.util.toFixed,j=E.util.parseUnit,p=E.util.multiplyTransformMatrices,h={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity"},m={stroke:"strokeOpacity",fill:"fillOpacity"};E.svgValidTagNamesRegEx=i(["path","circle","polygon","polyline","ellipse","rect","line","image","text","linearGradient","radialGradient","stop"]),E.svgViewBoxElementsRegEx=i(["symbol","image","marker","pattern","view","svg"]),E.svgInvalidAncestorsRegEx=i(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),E.svgValidParentsRegEx=i(["symbol","g","a","svg"]),E.cssRules={},E.gradientDefs={},E.parseTransformAttribute=function(){function u(a,s){var e=Math.cos(s[0]),i=Math.sin(s[0]),l=0,n=0;3===s.length&&(l=s[1],n=s[2]),a[0]=e,a[1]=i,a[2]=-i,a[3]=e,a[4]=l-(e*l-i*n),a[5]=n-(i*l+e*n)}function t(o,t){var n=t[0],i=2===t.length?t[1]:t[0];o[0]=n,o[3]=i}function e(r,t,e){r[e]=Math.tan(E.util.degreesToRadians(t[0]))}function i(r,t){r[4]=t[0],2===t.length&&(r[5]=t[1])}var r=[1,0,0,1,0,0],n=E.reNum,o="(?:\\s+,?\\s*|,\\s*)",g="(?:"+("(?:(matrix)\\s*\\(\\s*("+n+")"+o+"("+n+")"+o+"("+n+")"+o+"("+n+")"+o+"("+n+")"+o+"("+n+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+n+")(?:"+o+"("+n+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+n+")(?:"+o+"("+n+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+n+")(?:"+o+"("+n+")"+o+"("+n+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))")+")",l=new RegExp("^\\s*(?:"+("(?:"+g+"(?:"+o+"*"+g+")*)")+"?)\\s*$"),d=new RegExp(g,"g");return function(n){var p=r.concat(),s=[];if(!n||n&&!l.test(n))return p;n.replace(d,function(n){var o=new RegExp(g).exec(n).filter(function(e){return!!e}),a=o[1],c=o.slice(2).map(parseFloat);"translate"===a?i(p,c):"rotate"===a?(c[0]=E.util.degreesToRadians(c[0]),u(p,c)):"scale"===a?t(p,c):"skewX"===a?e(p,c,2):"skewY"===a?e(p,c,1):"matrix"===a?p=c:void 0;s.push(p.concat()),p=r.concat()});for(var a=s[0];1<s.length;)s.shift(),a=E.util.multiplyTransformMatrices(a,s[0]);return a}}();var _=new RegExp("^\\s*("+E.reNum+"+)\\s*,?\\s*("+E.reNum+"+)\\s*,?\\s*("+E.reNum+"+)\\s*,?\\s*("+E.reNum+"+)\\s*$");E.parseSVGDocument=function(g,p,e,t){if(g){u(g);var r,n,o=E.Object.__uid++,s=f(g),a=E.util.toArray(g.getElementsByTagName("*"));if(s.crossOrigin=t&&t.crossOrigin,s.svgUid=o,0===a.length&&E.isLikelyNode){a=g.selectNodes("//*[name(.)!=\"svg\"]");var i=[];for(r=0,n=a.length;n>r;r++)i[r]=a[r];a=i}var h=a.filter(function(e){return f(e),E.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))&&!c(e,E.svgInvalidAncestorsRegEx)});if(!h||h&&!h.length)return void(p&&p([],{}));E.gradientDefs[o]=E.getGradientDefs(g),E.cssRules[o]=E.getCSSRules(g),E.parseElements(h,function(e,t){p&&p(e,s,t,a)},d(s),e,t)}};var y=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+E.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+E.reNum+"))?\\s+(.*)");v(E,{parseFontDeclaration:function(l,t){var e=l.match(y);if(e){var i=e[1],r=e[3],n=e[4],o=e[5],s=e[6];i&&(t.fontStyle=i),r&&(t.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),n&&(t.fontSize=j(n)),s&&(t.fontFamily=s),o&&(t.lineHeight="normal"===o?1:o)}},getGradientDefs:function(o){var t,e,n,r=O(o,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),i=0,a={},s={};for(i=r.length;i--;)t=r[i],n=t.getAttribute("xlink:href"),e=t.getAttribute("id"),n&&(s[e]=n.substr(1)),a[e]=t;for(e in s){var c=a[s[e]].cloneNode(!0);for(t=a[e];c.firstChild;)t.appendChild(c.firstChild)}return a},parseAttributes:function(c,i,r){if(c){var m,s,a={};"undefined"==typeof r&&(r=c.getAttribute("svgUid")),c.parentNode&&E.svgValidParentsRegEx.test(c.parentNode.nodeName)&&(a=E.parseAttributes(c.parentNode,i,r)),s=a&&a.fontSize||c.getAttribute("font-size")||E.Text.DEFAULT_SVG_FONT_SIZE;var h=i.reduce(function(t,e){return m=c.getAttribute(e),m&&(t[e]=m),t},{});h=v(h,v(n(c,r),E.parseStyleAttribute(c)));var l,u,f={};for(var d in h)l=t(d),u=e(l,h[d],a,s),f[l]=u;f.font&&E.parseFontDeclaration(f.font,f);var g=v(a,f);return E.svgValidParentsRegEx.test(c.nodeName)?g:C(g)}},parseElements:function(o,t,e,i,r){new E.ElementsParser(o,t,e,i,r).parse()},parseStyleAttribute:function(n){var t={},e=n.getAttribute("style");return e?("string"==typeof e?r(e,t):o(e,t),t):t},parsePointsAttribute:function(o){if(!o)return null;o=o.replace(/,/g," ").trim(),o=o.split(/\s+/);var n,e,i=[];for(n=0,e=o.length;e>n;n+=2)i.push({x:parseFloat(o[n]),y:parseFloat(o[n+1])});return i},getCSSRules:function(a){var t,e,i,r=a.getElementsByTagName("style"),l={};for(t=0,e=r.length;e>t;t++){var o=r[t].textContent||r[t].text;o=o.replace(/\/\*[\s\S]*?\*\//g,""),""!==o.trim()&&(i=o.match(/[^{]*\{[\s\S]*?\}/g),i=i.map(function(e){return e.trim()}),i.forEach(function(o){var i=o.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},n=i[2].trim(),s=n.replace(/;$/,"").split(/\s*;\s*/);for(t=0,e=s.length;e>t;t++){var a=s[t].split(/\s*:\s*/),c=a[0],d=a[1];r[c]=d}o=i[1],o.split(",").forEach(function(e){e=e.replace(/^svg/i,"").trim(),""!==e&&(l[e]?E.util.object.extend(l[e],r):l[e]=E.util.object.clone(r))})}))}return l},loadSVGFromURL:function(o,a,e,i){function t(r){var t=r.responseXML;t&&!t.documentElement&&E.window.ActiveXObject&&r.responseText&&(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(r.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),t&&t.documentElement||a&&a(null),E.parseSVGDocument(t.documentElement,function(e,t,o,r){a&&a(e,t,o,r)},e,i)}o=o.replace(/^\n\s*/,"").trim(),new E.util.request(o,{method:"get",onComplete:t})},loadSVGFromString:function(a,s,e,t){a=a.trim();var r;if("undefined"!=typeof DOMParser){var n=new DOMParser;n&&n.parseFromString&&(r=n.parseFromString(a,"text/xml"))}else E.window.ActiveXObject&&(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));E.parseSVGDocument(r.documentElement,function(e,t,o,r){s(e,t,o,r)},e,t)}})}("undefined"==typeof exports?this:exports),fabric.ElementsParser=function(o,t,e,i,r){this.elements=o,this.callback=t,this.options=e,this.reviver=i,this.svgUid=e&&e.svgUid||0,this.parsingOptions=r},fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var r=0,t=this.elements.length;t>r;r++)this.elements[r].setAttribute("svgUid",this.svgUid),function(r,t){setTimeout(function(){r.createObject(r.elements[t],t)},0)}(this,r)},fabric.ElementsParser.prototype.createObject=function(r,t){var e=fabric[fabric.util.string.capitalize(r.tagName.replace("svg:",""))];if(e&&e.fromElement)try{this._createObject(e,r,t)}catch(e){fabric.log(e)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(r,t,e){r.fromElement(t,this.createCallback(e,t),this.options)},fabric.ElementsParser.prototype.createCallback=function(o,t){var e=this;return function(i){var r;e.resolveGradient(i,"fill"),e.resolveGradient(i,"stroke"),i instanceof fabric.Image&&(r=i.parsePreserveAspectRatioAttribute(t)),i._removeTransformMatrix(r),e.reviver&&e.reviver(t,i),e.instances[o]=i,e.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(o,t){var e=o.get(t);if(/^url\(/.test(e)){var n=e.slice(5,e.length-1);fabric.gradientDefs[this.svgUid][n]&&o.set(t,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][n],o))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),this.callback(this.instances,this.elements))},!function(r){"use strict";function o(r,t){this.x=r,this.y=t}var n=Math.max,a=Math.min,t=r.fabric||(r.fabric={});return t.Point?void t.warn("fabric.Point is already defined"):(t.Point=o,void(o.prototype={type:"point",constructor:o,add:function(e){return new o(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new o(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new o(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new o(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new o(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new o(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return"undefined"==typeof t&&(t=.5),t=n(a(1,t),0),new o(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(r){var t=this.x-r.x,e=this.y-r.y;return Math.sqrt(t*t+e*e)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new o(a(this.x,e.x),a(this.y,e.y))},max:function(e){return new o(n(this.x,e.x),n(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(r,t){return this.x=r,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(r){var t=this.x,e=this.y;this.x=r.x,this.y=r.y,r.x=t,r.y=e},clone:function(){return new o(this.x,this.y)}}))}("undefined"==typeof exports?this:exports),!function(r){"use strict";function g(e){this.status=e,this.points=[]}var p=r.fabric||(r.fabric={});return p.Intersection?void p.warn("fabric.Intersection is already defined"):(p.Intersection=g,p.Intersection.prototype={constructor:g,appendPoint:function(e){return this.points.push(e),this},appendPoints:function(e){return this.points=this.points.concat(e),this}},p.Intersection.intersectLineLine=function(e,t,n,r){var o,i=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),a=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),s=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(0!==s){var c=i/s,l=a/s;0<=c&&1>=c&&0<=l&&1>=l?(o=new g("Intersection"),o.appendPoint(new p.Point(e.x+c*(t.x-e.x),e.y+c*(t.y-e.y)))):o=new g}else o=new g(0===i||0===a?"Coincident":"Parallel");return o},p.Intersection.intersectLinePolygon=function(e,t,i){var n,r,o,s,a=new g,l=i.length;for(s=0;l>s;s++)n=i[s],r=i[(s+1)%l],o=g.intersectLineLine(e,t,n,r),a.appendPoints(o.points);return 0<a.points.length&&(a.status="Intersection"),a},p.Intersection.intersectPolygonPolygon=function(e,t){var i,n=new g,r=e.length;for(i=0;r>i;i++){var o=e[i],s=e[(i+1)%r],a=g.intersectLinePolygon(o,s,t);n.appendPoints(a.points)}return 0<n.points.length&&(n.status="Intersection"),n},void(p.Intersection.intersectPolygonRectangle=function(e,t,n){var r=t.min(n),o=t.max(n),i=new p.Point(o.x,r.y),a=new p.Point(r.x,o.y),s=g.intersectLinePolygon(r,i,e),c=g.intersectLinePolygon(i,o,e),l=g.intersectLinePolygon(o,a,e),u=g.intersectLinePolygon(a,r,e),h=new g;return h.appendPoints(s.points),h.appendPoints(c.points),h.appendPoints(l.points),h.appendPoints(u.points),0<h.points.length&&(h.status="Intersection"),h}))}("undefined"==typeof exports?this:exports),!function(o){"use strict";function d(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function e(r,t,e){return 0>e&&(e+=1),1<e&&(e-=1),1/6>e?r+6*(t-r)*e:.5>e?t:2/3>e?r+6*((t-r)*(2/3-e)):r}var g=Math.round,l=o.fabric||(o.fabric={});return l.Color?void l.warn("fabric.Color is already defined."):(l.Color=d,l.Color.prototype={_tryParsingColor:function(e){var t;e in d.colorNameMap&&(e=d.colorNameMap[e]),"transparent"===e&&(t=[255,255,255,0]),t||(t=d.sourceFromHex(e)),t||(t=d.sourceFromRgb(e)),t||(t=d.sourceFromHsl(e)),t||(t=[0,0,0,1]),t&&this.setSource(t)},_rgbToHsl:function(r,t,e){r/=255,t/=255,e/=255;var i,n,o,s=l.util.array.max([r,t,e]),a=l.util.array.min([r,t,e]);if(o=(s+a)/2,s===a)i=n=0;else{var c=s-a;switch(n=.5<o?c/(2-s-a):c/(s+a),s){case r:i=(t-e)/c+(e>t?6:0);break;case t:i=(e-r)/c+2;break;case e:i=(r-t)/c+4;}i/=6}return[g(360*i),g(100*n),g(100*o)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var r=this.getSource(),t=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var r=this.getSource(),t=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+r[3]+")"},toHex:function(){var o,t,e,n=this.getSource();return o=n[0].toString(16),o=1===o.length?"0"+o:o,t=n[1].toString(16),t=1===t.length?"0"+t:t,e=n[2].toString(16),e=1===e.length?"0"+e:e,o.toUpperCase()+t.toUpperCase()+e.toUpperCase()},toHexa:function(){var r,t=this.getSource();return r=255*t[3],r=r.toString(16),r=1===r.length?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var t=this.getSource();return t[3]=r,this.setSource(t),this},toGrayscale:function(){var r=this.getSource(),t=parseInt((.3*r[0]+.59*r[1]+.11*r[2]).toFixed(0),10),e=r[3];return this.setSource([t,t,t,e]),this},toBlackWhite:function(o){var n=this.getSource(),e=(.3*n[0]+.59*n[1]+.11*n[2]).toFixed(0),a=n[3];return o=o||127,e=+e<+o?0:255,this.setSource([e,e,e,a]),this},overlayWith:function(e){e instanceof d||(e=new d(e));var t,i=[],r=this.getAlpha(),n=.5,o=this.getSource(),s=e.getSource();for(t=0;3>t;t++)i.push(g(o[t]*(1-n)+s[t]*n));return i[3]=r,this.setSource(i),this}},l.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/,l.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,l.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,l.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},l.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))},l.Color.sourceFromRgb=function(e){var t=e.match(d.reRGBa);if(t){var i=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),r=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),n=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1);return[parseInt(i,10),parseInt(r,10),parseInt(n,10),t[4]?parseFloat(t[4]):1]}},l.Color.fromRgba=d.fromRgb,l.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))},l.Color.sourceFromHsl=function(i){var t=i.match(d.reHSLa);if(t){var r,n,o,s=(parseFloat(t[1])%360+360)%360/360,a=parseFloat(t[2])/(/%$/.test(t[2])?100:1),c=parseFloat(t[3])/(/%$/.test(t[3])?100:1);if(0===a)r=n=o=c;else{var p=.5>=c?c*(a+1):c+a-c*a,l=2*c-p;r=e(l,p,s+1/3),n=e(l,p,s),o=e(l,p,s-1/3)}return[g(255*r),g(255*n),g(255*o),t[4]?parseFloat(t[4]):1]}},l.Color.fromHsla=d.fromHsl,l.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))},l.Color.sourceFromHex=function(e){if(e.match(d.reHex)){var t=e.slice(e.indexOf("#")+1),i=3===t.length||4===t.length,r=8===t.length||4===t.length,n=i?t.charAt(0)+t.charAt(0):t.substring(0,2),o=i?t.charAt(1)+t.charAt(1):t.substring(2,4),s=i?t.charAt(2)+t.charAt(2):t.substring(4,6),a=r?i?t.charAt(3)+t.charAt(3):t.substring(6,8):"FF";return[parseInt(n,16),parseInt(o,16),parseInt(s,16),parseFloat((parseInt(a,16)/255).toFixed(2))]}},void(l.Color.fromSource=function(e){var t=new d;return t.setSource(e),t}))}("undefined"==typeof exports?this:exports),!function(){function r(l,d,e){var i,r=0,n=1,s="";for(var o in d)"Infinity"===d[o]?d[o]=1:"-Infinity"===d[o]&&(d[o]=0),i=parseFloat(d[o],10),n="string"==typeof d[o]&&/^\d+%$/.test(d[o])?.01:1,"x1"===o||"x2"===o||"r2"===o?(n*="objectBoundingBox"===e?l.width:1,r="objectBoundingBox"===e?l.left||0:0):("y1"===o||"y2"===o)&&(n*="objectBoundingBox"===e?l.height:1,r="objectBoundingBox"===e?l.top||0:0),d[o]=i*n+r;if("ellipse"===l.type&&null!==d.r2&&"objectBoundingBox"===e&&l.rx!==l.ry){var a=l.ry/l.rx;s=" scale(1, "+a+")",d.y1&&(d.y1/=a),d.y2&&(d.y2/=a)}return s}fabric.util.object.clone,fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(r){r||(r={});var t={};this.id=fabric.Object.__uid++,this.type=r.type||"linear",t={x1:r.coords.x1||0,y1:r.coords.y1||0,x2:r.coords.x2||0,y2:r.coords.y2||0},"radial"===this.type&&(t.r1=r.coords.r1||0,t.r2=r.coords.r2||0),this.coords=t,this.colorStops=r.colorStops.slice(),r.gradientTransform&&(this.gradientTransform=r.gradientTransform),this.offsetX=r.offsetX||this.offsetX,this.offsetY=r.offsetY||this.offsetY},addColorStop:function(r){for(var t in r){var e=new fabric.Color(r[t]);this.colorStops.push({offset:parseFloat(t),color:e.toRgb(),opacity:e.getAlpha()})}return this},toObject:function(r){var t={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,t,r),t},toLive:function(l){var t,e,i,r=fabric.util.object.clone(this.coords);if(this.type){for("linear"===this.type?t=l.createLinearGradient(r.x1,r.y1,r.x2,r.y2):"radial"===this.type&&(t=l.createRadialGradient(r.x1,r.y1,r.r1,r.x2,r.y2,r.r2)),e=0,i=this.colorStops.length;i>e;e++){var n=this.colorStops[e].color,s=this.colorStops[e].opacity,c=this.colorStops[e].offset;"undefined"!=typeof s&&(n=new fabric.Color(n).setAlpha(s).toRgba()),t.addColorStop(c,n)}return t}}}),fabric.util.object.extend(fabric.Gradient,{forObject:function(t,e){return e||(e={}),r(t,e.coords,"userSpaceOnUse"),new fabric.Gradient(e)}})}(),!function(){"use strict";var o=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(r,o){if(r||(r={}),this.id=fabric.Object.__uid++,this.setOptions(r),!r.source||r.source&&"string"!=typeof r.source)return void(o&&o(this));if("undefined"!=typeof fabric.util.getFunctionBody(r.source))this.source=new Function(fabric.util.getFunctionBody(r.source)),o&&o(this);else{var e=this;this.source=fabric.util.createImage(),fabric.util.loadImage(r.source,function(r){e.source=r,o&&o(e)})}},toObject:function(t){var e,a,r=fabric.Object.NUM_FRACTION_DIGITS;return"function"==typeof this.source?e=this.source+"":"string"==typeof this.source.src?e=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(e=this.source.toDataURL()),a={type:"pattern",source:e,repeat:this.repeat,offsetX:o(this.offsetX,r),offsetY:o(this.offsetY,r)},fabric.util.populateWithProperties(this,a,t),a},setOptions:function(r){for(var t in r)this[t]=r[t]},toLive:function(r){var t="function"==typeof this.source?this.source():this.source;if(!t)return"";if("undefined"!=typeof t.src){if(!t.complete)return"";if(0===t.naturalWidth||0===t.naturalHeight)return""}return r.createPattern(t,this.repeat)}})}(),!function(r){"use strict";{var o=r.fabric||(r.fabric={});o.util.toFixed}return o.Shadow?void o.warn("fabric.Shadow is already defined."):(o.Shadow=o.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(e){for(var r in"string"==typeof e&&(e=this._parseShadow(e)),e)this[r]=e[r];this.id=o.Object.__uid++},_parseShadow:function(e){var t=e.trim(),i=o.Shadow.reOffsetsAndBlur.exec(t)||[],r=t.replace(o.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:r.trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var r={},t=o.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(o){this[o]!==t[o]&&(r[o]=this[o])},this),r}}),void(o.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"==typeof exports?this:exports),!function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var o=fabric.util.object.extend,t=fabric.util.getElementOffset,l=fabric.util.removeFromArray,a=(fabric.util.toFixed,fabric.util.transformPoint),r=fabric.util.invertTransform,e=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(r,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,_initStatic:function(r,t){var e=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(r),this._initOptions(t),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,e),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,e),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,e),t.overlayColor&&this.setOverlayColor(t.overlayColor,e),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(r,t,e){return this.__setBgOverlayImage("overlayImage",r,t,e)},setBackgroundImage:function(r,t,e){return this.__setBgOverlayImage("backgroundImage",r,t,e)},setOverlayColor:function(r,t){return this.__setBgOverlayColor("overlayColor",r,t)},setBackgroundColor:function(r,t){return this.__setBgOverlayColor("backgroundColor",r,t)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(o,t,n,i){return"string"==typeof t?fabric.util.loadImage(t,function(t){t&&(this[o]=new fabric.Image(t,i)),n&&n(t)},this,i&&i.crossOrigin):(i&&t.setOptions(i),this[o]=t,n&&n(t)),this},__setBgOverlayColor:function(r,t,e){return this[r]=t,this._initGradient(t,r),this._initPattern(t,r,e),this},_createCanvasElement:function(){var r=fabric.util.createCanvasElement();if(!r)throw e;if(r.style||(r.style={}),"undefined"==typeof r.getContext)throw e;return r},_initOptions:function(e){this._setOptions(e),this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){this.lowerCanvasEl=e&&e.getContext?e:fabric.util.getById(e)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(r,o){return this.setDimensions({width:r},o)},setHeight:function(r,o){return this.setDimensions({height:r},o)},setDimensions:function(o,t){var e;for(var n in t=t||{},o)e=o[n],t.cssOnly||(this._setBackstoreDimension(n,o[n]),e+="px"),t.backstoreOnly||this._setCssDimension(n,e);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(r,t){return this.lowerCanvasEl[r]=t,this.upperCanvasEl&&(this.upperCanvasEl[r]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[r]=t),this[r]=t,this},_setCssDimension:function(r,t){return this.lowerCanvasEl.style[r]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[r]=t),this.wrapperEl&&(this.wrapperEl.style[r]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var t,e,i,r=this._activeObject,n=!1,s=!0;for(this.viewportTransform=a,e=0,i=this._objects.length;i>e;e++)t=this._objects[e],t.group||t.setCoords(n,s);return r&&"activeSelection"===r.type&&r.setCoords(n,s),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(n,t){var e=n,i=this.viewportTransform.slice(0);n=a(n,r(this.viewportTransform)),i[0]=t,i[3]=t;var s=a(n,i);return i[4]+=e.x-s.x,i[5]+=e.y-s.y,this.setViewportTransform(i)},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(r){var t=this.viewportTransform.slice(0);return t[4]=-r.x,t[5]=-r.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var e=this.contextContainer;return this.renderCanvas(e,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var o={},t=this.width,n=this.height,l=r(this.viewportTransform);return o.tl=a({x:0,y:0},l),o.br=a({x:t,y:n},l),o.tr=new fabric.Point(o.br.x,o.tl.y),o.bl=new fabric.Point(o.tl.x,o.br.y),this.vptCoords=o,o},renderCanvas:function(r,t){var e=this.viewportTransform;this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.calcViewportBoundaries(),this.clearContext(r),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,r),this._renderBackground(r),r.save(),r.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this._renderObjects(r,t),r.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(r),this.clipTo&&r.restore(),this._renderOverlay(r),this.controlsAboveOverlay&&this.interactive&&this.drawControls(r),this.fire("after:render")},_renderObjects:function(o,t){var e,n;for(e=0,n=t.length;n>e;++e)t[e]&&t[e].render(o)},_renderBackgroundOrOverlay:function(o,t){var e,n=this[t+"Color"];n&&(o.fillStyle=n.toLive?n.toLive(o,this):n,o.fillRect(n.offsetX||0,n.offsetY||0,this.width,this.height)),n=this[t+"Image"],n&&(this[t+"Vpt"]&&(e=this.viewportTransform,o.save(),o.transform(e[0],e[1],e[2],e[3],e[4],e[5])),n.render(o),this[t+"Vpt"]&&o.restore())},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top))},centerObject:function(r){var t=this.getCenter();return this._centerObject(r,new fabric.Point(t.left,t.top))},viewportCenterObject:function(r){var t=this.getVpCenter();return this._centerObject(r,t)},viewportCenterObjectH:function(r){var t=this.getVpCenter();return this._centerObject(r,new fabric.Point(t.x,r.getCenterPoint().y)),this},viewportCenterObjectV:function(r){var t=this.getVpCenter();return this._centerObject(r,new fabric.Point(r.getCenterPoint().x,t.y))},getVpCenter:function(){var o=this.getCenter(),t=r(this.viewportTransform);return a({x:o.left,y:o.top},t)},_centerObject:function(r,t){return r.setPositionByOrigin(t,"center","center"),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,e){var n={version:fabric.version,objects:this._toObjects(t,e)};return o(n,this.__serializeBgOverlay(t,e)),fabric.util.populateWithProperties(this,n,e),n},_toObjects:function(r,t){return this.getObjects().filter(function(e){return!e.excludeFromExport}).map(function(e){return this._toObject(e,r,t)},this)},_toObject:function(o,t,e){var i;this.includeDefaultValues||(i=o.includeDefaultValues,o.includeDefaultValues=!1);var r=o[t](e);return this.includeDefaultValues||(o.includeDefaultValues=i),r},__serializeBgOverlay:function(o,t){var e={},i=this.backgroundImage,r=this.overlayImage;return this.backgroundColor&&(e.background=this.backgroundColor.toObject?this.backgroundColor.toObject(t):this.backgroundColor),this.overlayColor&&(e.overlay=this.overlayColor.toObject?this.overlayColor.toObject(t):this.overlayColor),i&&!i.excludeFromExport&&(e.backgroundImage=this._toObject(i,o,t)),r&&!r.excludeFromExport&&(e.overlayImage=this._toObject(r,o,t)),e},sendToBack:function(o){if(!o)return this;var i,e,r,n=this._activeObject;if(o===n&&"activeSelection"===o.type)for(r=n._objects,i=r.length;i--;)e=r[i],l(this._objects,e),this._objects.unshift(e);else l(this._objects,o),this._objects.unshift(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(o){if(!o)return this;var i,e,r,n=this._activeObject;if(o===n&&"activeSelection"===o.type)for(r=n._objects,i=0;i<r.length;i++)e=r[i],l(this._objects,e),this._objects.push(e);else l(this._objects,o),this._objects.push(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(i,d){if(!i)return this;var e,r,n,s,o,a=this._activeObject,c=0;if(i===a&&"activeSelection"===i.type)for(o=a._objects,e=0;e<o.length;e++)r=o[e],n=this._objects.indexOf(r),n>0+c&&(s=n-1,l(this._objects,r),this._objects.splice(s,0,r)),c++;else n=this._objects.indexOf(i),0!==n&&(s=this._findNewLowerIndex(i,n,d),l(this._objects,i),this._objects.splice(s,0,i));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(o,t,e){var i,r;if(e)for(i=t,r=t-1;0<=r;--r){var n=o.intersectsWithObject(this._objects[r])||o.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(o);if(n){i=r;break}}else i=t-1;return i},bringForward:function(i,d){if(!i)return this;var e,r,n,s,o,a=this._activeObject,c=0;if(i===a&&"activeSelection"===i.type)for(o=a._objects,e=o.length;e--;)r=o[e],n=this._objects.indexOf(r),n<this._objects.length-1-c&&(s=n+1,l(this._objects,r),this._objects.splice(s,0,r)),c++;else n=this._objects.indexOf(i),n!==this._objects.length-1&&(s=this._findNewUpperIndex(i,n,d),l(this._objects,i),this._objects.splice(s,0,i));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(a,t,e){var i,r,n;if(e)for(i=t,r=t+1,n=this._objects.length;n>r;++r){var s=a.intersectsWithObject(this._objects[r])||a.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(a);if(s){i=r;break}}else i=t+1;return i},moveTo:function(r,t){return l(this._objects,r),this._objects.splice(t,0,r),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this._iTextInstances=null,this.lowerCanvasEl=null,this.cacheCanvasEl=null,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),o(fabric.StaticCanvas.prototype,fabric.Observable),o(fabric.StaticCanvas.prototype,fabric.Collection),o(fabric.StaticCanvas.prototype,fabric.DataURLExporter),o(fabric.StaticCanvas,{EMPTY_JSON:"{\"objects\": [], \"background\": \"white\"}",supports:function(r){var t=fabric.util.createCanvasElement();if(!t||!t.getContext)return null;var o=t.getContext("2d");if(!o)return null;switch(r){case"getImageData":return"undefined"!=typeof o.getImageData;case"setLineDash":return"undefined"!=typeof o.setLineDash;case"toDataURL":return"undefined"!=typeof t.toDataURL;case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(e){}return!1;default:return null;}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var e=fabric.jsdomImplForWrapper(this.lowerCanvasEl);return e&&e.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(r){var t=fabric.jsdomImplForWrapper(this.lowerCanvasEl);return t&&t.createJPEGStream(r)})}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(e){return this.shadow=new fabric.Shadow(e),this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var r=this.canvas.contextTop,t=this.canvas.getZoom();r.shadowColor=this.shadow.color,r.shadowBlur=this.shadow.blur*t,r.shadowOffsetX=this.shadow.offsetX*t,r.shadowOffsetY=this.shadow.offsetY*t}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}}),!function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(e){this.canvas=e,this._points=[]},onMouseDown:function(e){this._prepareForDrawing(e),this._captureDrawingPath(e),this._render()},onMouseMove:function(e){this._captureDrawingPath(e),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(r){var t=new fabric.Point(r.x,r.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){1<this._points.length&&e.eq(this._points[this._points.length-1])||this._points.push(e)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(r){var t=new fabric.Point(r.x,r.y);this._addPoint(t)},_render:function(){var l,t,e=this.canvas.contextTop,i=this.canvas.viewportTransform,r=this._points[0],n=this._points[1];if(e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e.beginPath(),2===this._points.length&&r.x===n.x&&r.y===n.y){var o=this.width/1e3;r=new fabric.Point(r.x,r.y),n=new fabric.Point(n.x,n.y),r.x-=o,n.x+=o}for(e.moveTo(r.x,r.y),l=1,t=this._points.length;t>l;l++){var s=r.midPointFrom(n);e.quadraticCurveTo(r.x,r.y,s.x,s.y),r=this._points[l],n=this._points[l+1]}e.lineTo(r.x,r.y),e.stroke(),e.restore()},convertPointsToSVGPath:function(d){var t,e=[],i=this.width/1e3,r=new fabric.Point(d[0].x,d[0].y),n=new fabric.Point(d[1].x,d[1].y),o=d.length,s=1,a=1,c=2<o;for(c&&(s=d[2].x<n.x?-1:d[2].x===n.x?0:1,a=d[2].y<n.y?-1:d[2].y===n.y?0:1),e.push("M ",r.x-s*i," ",r.y-a*i," "),t=1;o>t;t++){if(!r.eq(n)){var u=r.midPointFrom(n);e.push("Q ",r.x," ",r.y," ",u.x," ",u.y," ")}r=d[t],t+1<d.length&&(n=d[t+1])}return c&&(s=r.x>d[t-2].x?1:r.x===d[t-2].x?0:-1,a=r.y>d[t-2].y?1:r.y===d[t-2].y?0:-1),e.push("L ",r.x+s*i," ",r.y+a*i),e},createPath:function(r){var t=new fabric.Path(r,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray}),e=new fabric.Point(t.left+t.width/2,t.top+t.height/2);return e=t.translateToGivenOrigin(e,"center","center",t.originX,t.originY),t.top=e.y,t.left=e.x,this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var r=this.canvas.contextTop;r.closePath();var t=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===t)return void this.canvas.requestRenderAll();var e=this.createPath(t);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(e),this.canvas.renderAll(),e.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:e})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(o){var t=this.addPoint(o),e=this.canvas.contextTop,n=this.canvas.viewportTransform;e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),e.closePath(),e.fill(),e.restore()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var a,t,e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var i=[];for(a=0,t=this.points.length;t>a;a++){var r=this.points[a],n=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&n.setShadow(this.shadow),i.push(n)}var o=new fabric.Group(i,{originX:"center",originY:"center"});o.canvas=this.canvas,this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},addPoint:function(o){var t=new fabric.Point(o.x,o.y),e=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=e,t.fill=n,this.points.push(t),t}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render()},onMouseMove:function(e){this.addSprayChunk(e),this.render()},onMouseUp:function(){var l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],e=0,i=this.sprayChunks.length;i>e;e++)for(var r,a=this.sprayChunks[e],n=0,s=a.length;s>n;n++)r=new fabric.Rect({width:a[n].width,height:a[n].width,left:a[n].x+1,top:a[n].y+1,originX:"center",originY:"center",fill:this.color}),this.shadow&&r.setShadow(this.shadow),t.push(r);this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var o=new fabric.Group(t,{originX:"center",originY:"center"});o.canvas=this.canvas,this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},_getOptimizedRects:function(o){var t,e,i,r={};for(e=0,i=o.length;i>e;e++)t=o[e].left+""+o[e].top,r[t]||(r[t]=o[e]);var n=[];for(t in r)n.push(r[t]);return n},render:function(){var o=this.canvas.contextTop;o.fillStyle=this.color;var t,e,i=this.canvas.viewportTransform;for(o.save(),o.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t=0,e=this.sprayChunkPoints.length;e>t;t++){var r=this.sprayChunkPoints[t];"undefined"!=typeof r.opacity&&(o.globalAlpha=r.opacity),o.fillRect(r.x,r.y,r.width,r.width)}o.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var t,e,i,r,n=this.width/2;for(r=0;r<this.density;r++){t=fabric.util.getRandomInt(a.x-n,a.x+n),e=fabric.util.getRandomInt(a.y-n,a.y+n),i=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var s=new fabric.Point(t,e);s.width=i,this.randomOpacity&&(s.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(s)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=20,t=fabric.document.createElement("canvas"),o=t.getContext("2d");return t.width=t.height=e+5,o.fillStyle=this.color,o.beginPath(),o.arc(e/2,e/2,e/2,0,2*Math.PI,!1),o.closePath(),o.fill(),t},getPatternSrcFunction:function(){return(this.getPatternSrc+"").replace("this.color","\""+this.color+"\"")},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(r){var t=this.callSuper("createPath",r),e=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-e.x,offsetY:-e.y}),t}}),!function(){var m=Math.abs,l=fabric.util.getPointer,c=fabric.util.degreesToRadians,d=fabric.util.radiansToDegrees,i=Math.atan2,u=m,n=fabric.StaticCanvas.supports("setLineDash"),g=.5;for(var e in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(r,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this._initStatic(r,t),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var o,t,e,i=this.getActiveObjects();if(0<i.length&&!this.preserveObjectStacking){t=[],e=[];for(var r=0,n=this._objects.length;n>r;r++)o=this._objects[r],-1===i.indexOf(o)?t.push(o):e.push(o);1<i.length&&(this._activeObject._objects=e),t.push.apply(t,e)}else t=this._objects;return t},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.selection&&this._groupSelector&&this._drawSelection(e),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,skewX:e.original.skewX,skewY:e.original.skewY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(e.target)?"rotate"===e.action?this._setOriginToCenter(e.target):("center"!==e.originX&&(e.mouseXSign="right"===e.originX?-1:1),"center"!==e.originY&&(e.mouseYSign="bottom"===e.originY?-1:1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(o,t,e){var n,r=e||this.getPointer(o,!0);return n=t.group&&t.group===this._activeObject&&"activeSelection"===t.group.type?this._normalizePointer(t.group,r):{x:r.x,y:r.y},t.containsPoint(n)||t._findTargetCorner(r)},_normalizePointer:function(o,t){var e=o.calcTransformMatrix(),i=fabric.util.invertTransform(e),r=this.restorePointerVpt(t);return fabric.util.transformPoint(r,i)},isTargetTransparent:function(a,t,e){var i=this.contextCache,r=a.selectionBackgroundColor,n=this.viewportTransform;a.selectionBackgroundColor="",this.clearContext(i),i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),a.render(i),i.restore(),a===this._activeObject&&a._renderControls(i,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),a.selectionBackgroundColor=r;var s=fabric.util.isTransparent(i,t,e,this.targetFindTolerance);return s},_isSelectionKeyPressed:function(r){var t=!1;return t="[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(t){return!0===r[t]}):r[this.selectionKey]},_shouldClearSelection:function(o,t){var n=this.getActiveObjects(),i=this._activeObject;return!t||t&&i&&1<n.length&&-1===n.indexOf(t)&&i!==t&&!this._isSelectionKeyPressed(o)||t&&!t.evented||t&&!t.selectable&&i&&i!==t},_shouldCenterTransform:function(r){if(r){var t,e=this._currentTransform;return"scale"===e.action||"scaleX"===e.action||"scaleY"===e.action?t=this.centeredScaling||r.centeredScaling:"rotate"===e.action&&(t=this.centeredRotation||r.centeredRotation),t?!e.altKey:e.altKey}},_getOriginFromCorner:function(r,t){var e={x:r.originX,y:r.originY};return"ml"===t||"tl"===t||"bl"===t?e.x="right":("mr"===t||"tr"===t||"br"===t)&&(e.x="left"),"tl"===t||"mt"===t||"tr"===t?e.y="bottom":("bl"===t||"mb"===t||"br"===t)&&(e.y="top"),e},_getActionFromCorner:function(r,t,e){return t?"mtr"===t?"rotate":"ml"===t||"mr"===t?e[this.altActionKey]?"skewY":"scaleX":"mt"===t||"mb"===t?e[this.altActionKey]?"skewX":"scaleY":"scale":"drag"},_setupCurrentTransform:function(e,t){if(t){var a=this.getPointer(e),r=t._findTargetCorner(this.getPointer(e,!0)),l=this._getActionFromCorner(t,r,e),d=this._getOriginFromCorner(t,r);this._currentTransform={target:t,action:l,corner:r,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,offsetX:a.x-t.left,offsetY:a.y-t.top,originX:d.x,originY:d.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,left:t.left,top:t.top,theta:c(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e[this.centeredKey]},this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,originX:d.x,originY:d.y},this._resetCurrentTransform()}},_translateObject:function(l,t){var e=this._currentTransform,i=e.target,r=l-e.offsetX,n=t-e.offsetY,s=!i.get("lockMovementX")&&i.left!==r,o=!i.get("lockMovementY")&&i.top!==n;return s&&i.set("left",r),o&&i.set("top",n),s||o},_changeSkewTransformOrigin:function(l,d,e){var i="originX",r={0:"center"},n=d.target.skewX,s="left",o="right",a="mt"===d.corner||"ml"===d.corner?1:-1,u=1;l=0<l?1:-1,"y"===e&&(n=d.target.skewY,s="top",o="bottom",i="originY"),r[-1]=s,r[1]=o,d.target.flipX&&(u*=-1),d.target.flipY&&(u*=-1),0===n?(d.skewSign=-a*l*u,d[i]=r[-l]):(n=0<n?1:-1,d.skewSign=n,d[i]=r[n*a*u])},_skewObject:function(g,t,e){var i=this._currentTransform,r=i.target,n=!1,s=r.get("lockSkewingX"),o=r.get("lockSkewingY");if(s&&"x"===e||o&&"y"===e)return!1;var a,c,p=r.getCenterPoint(),l=r.toLocalPoint(new fabric.Point(g,t),"center","center")[e],u=r.toLocalPoint(new fabric.Point(i.lastX,i.lastY),"center","center")[e],h=r._getTransformedDimensions();return this._changeSkewTransformOrigin(l-u,i,e),a=r.toLocalPoint(new fabric.Point(g,t),i.originX,i.originY)[e],c=r.translateToOriginPoint(p,i.originX,i.originY),n=this._setObjectSkew(a,i,e,h),i.lastX=g,i.lastY=t,r.setPositionByOrigin(c,i.originX,i.originY),n},_setObjectSkew:function(_,t,e,i){var r,n,s,o,a,c,h,l,u,f=t.target,d=!1,g=t.skewSign;return"x"===e?(o="y",a="Y",c="X",l=0,u=f.skewY):(o="x",a="X",c="Y",l=f.skewX,u=0),s=f._getTransformedDimensions(l,u),h=2*m(_)-s[e],2>=h?r=0:(r=g*Math.atan(h/f["scale"+c]/(s[o]/f["scale"+a])),r=fabric.util.radiansToDegrees(r)),d=f["skew"+c]!==r,f.set("skew"+c,r),0!==f["skew"+a]&&(n=f._getTransformedDimensions(),r=i[o]/n[o]*f["scale"+a],f.set("scale"+a,r)),d},_scaleObject:function(d,t,e){var i=this._currentTransform,r=i.target,n=r.get("lockScalingX"),s=r.get("lockScalingY"),o=r.get("lockScalingFlip");if(n&&s)return!1;var a=r.translateToOriginPoint(r.getCenterPoint(),i.originX,i.originY),c=r.toLocalPoint(new fabric.Point(d,t),i.originX,i.originY),g=r._getTransformedDimensions(),l=!1;return this._setLocalMouse(c,i),l=this._setObjectScale(c,i,n,s,e,o,g),r.setPositionByOrigin(a,i.originX,i.originY),l},_setObjectScale:function(p,t,e,i,r,n,s){var o,a,c,h,l=t.target,u=!1,f=!1,d=!1;return c=p.x*l.scaleX/s.x,h=p.y*l.scaleY/s.y,o=l.scaleX!==c,a=l.scaleY!==h,n&&0>=c&&c<l.scaleX&&(u=!0,p.x=0),n&&0>=h&&h<l.scaleY&&(f=!0,p.y=0),"equally"!==r||e||i?r?"x"!==r||l.get("lockUniScaling")?"y"!==r||l.get("lockUniScaling")||f||i||l.set("scaleY",h)&&(d=d||a):u||e||l.set("scaleX",c)&&(d=d||o):(u||e||l.set("scaleX",c)&&(d=d||o),f||i||l.set("scaleY",h)&&(d=d||a)):d=this._scaleObjectEqually(p,l,t,s),t.newScaleX=c,t.newScaleY=h,u||f||this._flipObject(t,r),d},_scaleObjectEqually:function(l,t,e,i){var r,n=l.y+l.x,s=i.y*e.original.scaleY/t.scaleY+i.x*e.original.scaleX/t.scaleX,o=0>l.x?-1:1,a=0>l.y?-1:1;return e.newScaleX=o*m(e.original.scaleX*n/s),e.newScaleY=a*m(e.original.scaleY*n/s),r=e.newScaleX!==t.scaleX||e.newScaleY!==t.scaleY,t.set("scaleX",e.newScaleX),t.set("scaleY",e.newScaleY),r},_flipObject:function(r,t){0>r.newScaleX&&"y"!==t&&("left"===r.originX?r.originX="right":"right"===r.originX&&(r.originX="left")),0>r.newScaleY&&"x"!==t&&("top"===r.originY?r.originY="bottom":"bottom"===r.originY&&(r.originY="top"))},_setLocalMouse:function(o,t){var e=t.target,n=this.getZoom(),r=e.padding/n;"right"===t.originX?o.x*=-1:"center"===t.originX&&(o.x*=2*t.mouseXSign,0>o.x&&(t.mouseXSign=-t.mouseXSign)),"bottom"===t.originY?o.y*=-1:"center"===t.originY&&(o.y*=2*t.mouseYSign,0>o.y&&(t.mouseYSign=-t.mouseYSign)),u(o.x)>r?0>o.x?o.x+=r:o.x-=r:o.x=0,u(o.y)>r?0>o.y?o.y+=r:o.y-=r:o.y=0},_rotateObject:function(r,t){var e=this._currentTransform;if(e.target.get("lockRotation"))return!1;var n=i(e.ey-e.top,e.ex-e.left),s=i(t-e.top,r-e.left),o=d(s-n+e.theta),a=!0;if(0<e.target.snapAngle){var c=e.target.snapAngle,g=e.target.snapThreshold||c,l=Math.ceil(o/c)*c,u=Math.floor(o/c)*c;m(o-u)<g?o=u:m(o-l)<g&&(o=l)}return 0>o&&(o=360+o),o%=360,e.target.angle===o?a=!1:e.target.angle=o,a},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.rotate(0)},_drawSelection:function(o){var t=this._groupSelector,e=t.left,d=t.top,p=u(e),a=u(d);if(this.selectionColor&&(o.fillStyle=this.selectionColor,o.fillRect(t.ex-(0<e?0:-e),t.ey-(0<d?0:-d),p,a)),this.selectionLineWidth&&this.selectionBorderColor)if(o.lineWidth=this.selectionLineWidth,o.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!n){var c=t.ex+g-(0<e?0:p),h=t.ey+g-(0<d?0:a);o.beginPath(),fabric.util.drawDashedLine(o,c,h,c+p,h,this.selectionDashArray),fabric.util.drawDashedLine(o,c,h+a-1,c+p,h+a-1,this.selectionDashArray),fabric.util.drawDashedLine(o,c,h,c,h+a,this.selectionDashArray),fabric.util.drawDashedLine(o,c+p-1,h,c+p-1,h+a,this.selectionDashArray),o.closePath(),o.stroke()}else fabric.Object.prototype._setLineDash.call(this,o,this.selectionDashArray),o.strokeRect(t.ex+g-(0<e?0:p),t.ey+g-(0<d?0:a),p,a)},findTarget:function(n,t){if(!this.skipTargetFind){var l,i,r=this.getPointer(n,!0),s=this._activeObject,o=this.getActiveObjects();if(this.targets=[],1<o.length&&!t&&s===this._searchPossibleTargets([s],r))return s;if(1===o.length&&s._findTargetCorner(r))return s;if(1===o.length&&s===this._searchPossibleTargets([s],r)){if(!this.preserveObjectStacking)return s;l=s,i=this.targets,this.targets=[]}var a=this._searchPossibleTargets(this._objects,r);return n[this.altSelectionKey]&&a&&l&&a!==l&&(a=l,this.targets=i),a}},_checkTarget:function(r,t){if(t&&t.visible&&t.evented&&this.containsPoint(null,t,r)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;var e=this.isTargetTransparent(t,r.x,r.y);if(!e)return!0}},_searchPossibleTargets:function(o,t){for(var e,i,r,n=o.length;n--;)if(this._checkTarget(t,o[n])){e=o[n],"group"===e.type&&e.subTargetCheck&&(i=this._normalizePointer(e,t),r=this._searchPossibleTargets(e._objects,i),r&&this.targets.push(r));break}return e},restorePointerVpt:function(e){return fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(t,e,i){i||(i=this.upperCanvasEl);var r,n=l(t),s=i.getBoundingClientRect(),o=s.width||0,a=s.height||0;return o&&a||("top"in s&&"bottom"in s&&(a=m(s.top-s.bottom)),"right"in s&&"left"in s&&(o=m(s.right-s.left))),this.calcOffset(),n.x-=this._offset.left,n.y-=this._offset.top,e||(n=this.restorePointerVpt(n)),r=0===o||0===a?{width:1,height:1}:{width:i.width/o,height:i.height/a},{x:n.x*r.width,y:n.y*r.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+e),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var t=this.width||r.width,e=this.height||r.height;fabric.util.setStyle(r,{position:"absolute",width:t+"px",height:e+"px",left:0,top:0,"touch-action":"none"}),r.width=t,r.height=e,fabric.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,t){t.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?"activeSelection"===e.type&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),this._hoveredTarget===e&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(a,t){var l=!1,i=this.getActiveObjects(),r=[],n=[],s={e:t};a.forEach(function(e){-1===i.indexOf(e)&&(l=!0,e.fire("deselected",s),n.push(e))}),i.forEach(function(t){-1===a.indexOf(t)&&(l=!0,t.fire("selected",s),r.push(t))}),0<a.length&&0<i.length?(s.selected=r,s.deselected=n,s.updated=r[0]||n[0],s.target=this._activeObject,l&&this.fire("selection:updated",s)):0<i.length?(1===i.length&&(s.target=r[0],this.fire("object:selected",s)),s.selected=r,s.target=this._activeObject,this.fire("selection:created",s)):0<a.length&&(s.deselected=n,this.fire("selection:cleared",s))},setActiveObject:function(r,t){var e=this.getActiveObjects();return this._setActiveObject(r,t),this._fireSelectionEvents(e,t),this},_setActiveObject:function(r,t){return this._activeObject!==r&&!!this._discardActiveObject(t,r)&&!r.onSelect({e:t})&&(this._activeObject=r,!0)},_discardActiveObject:function(r,o){var n=this._activeObject;if(n){if(n.onDeselect({e:r,object:o}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var o=this.getActiveObjects();return o.length&&this.fire("before:selection:cleared",{target:o[0],e:r}),this._discardActiveObject(r),this._fireSelectionEvents(o,r),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var t=this._activeObject;t&&t._renderControls(r)},_toObject:function(o,t,e){var i=this._realizeGroupTransformOnObject(o),r=this.callSuper("_toObject",o,t,e);return this._unwindGroupTransformOnObject(o,i),r},_realizeGroupTransformOnObject:function(r){if(r.group&&"activeSelection"===r.group.type&&this._activeObject===r.group){var t={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(o){t[o]=r[o]}),this._activeObject.realizeTransform(r),t}return null},_unwindGroupTransformOnObject:function(r,t){t&&r.set(t)},_setSVGObject:function(o,t,e){var n=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",o,t,e),this._unwindGroupTransformOnObject(t,n)}}),fabric.StaticCanvas)"prototype"!==e&&(fabric.Canvas[e]=fabric.StaticCanvas[e]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}(),!function(){function d(r,o){return"which"in r?r.which===o:r.button===o-1}var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},l=fabric.util.addListener,i=fabric.util.removeListener,t=3,r=2,u=1;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),l(fabric.window,"resize",this._onResize),l(this.upperCanvasEl,"mousedown",this._onMouseDown),l(this.upperCanvasEl,"dblclick",this._onDoubleClick),l(this.upperCanvasEl,"mousemove",this._onMouseMove),l(this.upperCanvasEl,"mouseout",this._onMouseOut),l(this.upperCanvasEl,"mouseenter",this._onMouseEnter),l(this.upperCanvasEl,"wheel",this._onMouseWheel),l(this.upperCanvasEl,"contextmenu",this._onContextMenu),l(this.upperCanvasEl,"touchstart",this._onMouseDown,{passive:!1}),l(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this.eventsBinded||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this.eventsBinded=!0)},removeListeners:function(){i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mouseout",this._onMouseOut),i(this.upperCanvasEl,"mouseenter",this._onMouseEnter),i(this.upperCanvasEl,"wheel",this._onMouseWheel),i(this.upperCanvasEl,"contextmenu",this._onContextMenu),i(this.upperCanvasEl,"doubleclick",this._onDoubleClick),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(r,t){this.__onTransformGesture&&this.__onTransformGesture(r,t)},_onDrag:function(r,t){this.__onDrag&&this.__onDrag(r,t)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(r){var o=this._hoveredTarget;this.fire("mouse:out",{target:o,e:r}),this._hoveredTarget=null,o&&o.fire("mouseout",{e:r}),this._iTextInstances&&this._iTextInstances.forEach(function(e){e.isEditing&&e.hiddenTextarea.focus()})},_onMouseEnter:function(e){this.findTarget(e)||(this.fire("mouse:over",{target:null,e:e}),this._hoveredTarget=null)},_onOrientationChange:function(r,t){this.__onOrientationChange&&this.__onOrientationChange(r,t)},_onShake:function(r,t){this.__onShake&&this.__onShake(r,t)},_onLongPress:function(r,t){this.__onLongPress&&this.__onLongPress(r,t)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(r){var t;this._handleEvent(r,"dblclick",t)},_onMouseDown:function(e){this.__onMouseDown(e),l(fabric.document,"touchend",this._onMouseUp,{passive:!1}),l(fabric.document,"touchmove",this._onMouseMove,{passive:!1}),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===e.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(l(fabric.document,"mouseup",this._onMouseUp),l(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(r){if(this.__onMouseUp(r),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove),i(fabric.document,"touchmove",this._onMouseMove),l(this.upperCanvasEl,"mousemove",this._onMouseMove),l(this.upperCanvasEl,"touchmove",this._onMouseMove,{passive:!1}),"touchend"===r.type){var t=this;setTimeout(function(){l(t.upperCanvasEl,"mousedown",t._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(r,o){var e=this._activeObject;return e&&e.isEditing&&r===e?!1:!!(r&&(r.isMoving||r!==e)||!r&&e||!r&&!e&&!this._groupSelector||o&&this._previousPointer&&this.selection&&(o.x!==this._previousPointer.x||o.y!==this._previousPointer.y))},__onMouseUp:function(o){var e,i=!0,n=this._currentTransform,a=this._groupSelector,s=!a||0===a.left&&0===a.top;if(d(o,t))return void(this.fireRightClick&&this._handleEvent(o,"up",e,t,s));if(d(o,r))return void(this.fireMiddleClick&&this._handleEvent(o,"up",e,r,s));if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(o);n&&(this._finalizeCurrentTransform(o),i=!n.actionPerformed),e=i?this.findTarget(o,!0):n.target;var g=this._shouldRender(e,this.getPointer(o));e||!s?this._maybeGroupObjects(o):(this._groupSelector=null,this._currentTransform=null),e&&(e.isMoving=!1),this._setCursorFromEvent(o,e),this._handleEvent(o,"up",e?e:null,u,s),e&&(e.__corner=0),g&&this.requestRenderAll()},_handleEvent:function(o,l,e,d,n){var r="undefined"==typeof e?this.findTarget(o):e,g=this.targets||[],p={e:o,target:r,subTargets:g,button:d||u,isClick:n||!1};this.fire("mouse:"+l,p),r&&r.fire("mouse"+l,p);for(var c=0;c<g.length;c++)g[c].fire("mouse"+l,p)},_finalizeCurrentTransform:function(r){var o=this._currentTransform,e=o.target;e._scaling&&(e._scaling=!1),e.setCoords(),this._restoreOriginXY(e),(o.actionPerformed||this.stateful&&e.hasStateChanged())&&(this.fire("object:modified",{target:e,e:r}),e.fire("modified",{e:r}))},_restoreOriginXY:function(r){if(this._previousOriginX&&this._previousOriginY){var t=r.translateToOriginPoint(r.getCenterPoint(),this._previousOriginX,this._previousOriginY);r.originX=this._previousOriginX,r.originY=this._previousOriginY,r.left=t.x,r.top=t.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(r){this._isCurrentlyDrawing=!0,this.discardActiveObject(r).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=this.getPointer(r);this.freeDrawingBrush.onMouseDown(t),this._handleEvent(r,"down")},_onMouseMoveInDrawingMode:function(r){if(this._isCurrentlyDrawing){var t=this.getPointer(r);this.freeDrawingBrush.onMouseMove(t)}this.setCursor(this.freeDrawingCursor),this._handleEvent(r,"move")},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(e,"up")},__onMouseDown:function(s){var e=this.findTarget(s);if(d(s,t))return void(this.fireRightClick&&this._handleEvent(s,"down",e?e:null,t));if(d(s,r))return void(this.fireMiddleClick&&this._handleEvent(s,"down",e?e:null,r));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(s);if(!this._currentTransform){var i=this.getPointer(s,!0);this._previousPointer=i;var n=this._shouldRender(e,i),o=this._shouldGroup(s,e);this._shouldClearSelection(s,e)?this.discardActiveObject(s):o&&(this._handleGrouping(s,e),e=this._activeObject),!this.selection||e&&(e.selectable||e.isEditing||e===this._activeObject)||(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0}),e&&(e.selectable&&this.setActiveObject(e,s),e!==this._activeObject||!e.__corner&&o||(this._beforeTransform(s,e),this._setupCurrentTransform(s,e))),this._handleEvent(s,"down",e?e:null),n&&this.requestRenderAll()}},_beforeTransform:function(r,t){this.stateful&&t.saveState(),t._findTargetCorner(this.getPointer(r))&&this.onBeforeScaleRotate(t)},_setOriginToCenter:function(r){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var t=r.getCenterPoint();r.originX="center",r.originY="center",r.left=t.x,r.top=t.y,this._currentTransform.left=r.left,this._currentTransform.top=r.top},_setCenterToOrigin:function(r){var t=r.translateToOriginPoint(r.getCenterPoint(),this._previousOriginX,this._previousOriginY);r.originX=this._previousOriginX,r.originY=this._previousOriginY,r.left=t.x,r.top=t.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(r){var t,e;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(r);if(!("undefined"!=typeof r.touches&&1<r.touches.length)){var o=this._groupSelector;o?(e=this.getPointer(r,!0),o.left=e.x-o.ex,o.top=e.y-o.ey,this.renderTop()):this._currentTransform?this._transformObject(r):(t=this.findTarget(r),this._setCursorFromEvent(r,t),this._fireOverOutEvents(t,r)),this._handleEvent(r,"move",this._currentTransform?null:t)}},_fireOverOutEvents:function(o,a){var s,i,n=this._hoveredTarget;n!==o&&(s={e:a,target:o,previousTarget:this._hoveredTarget},i={e:a,target:this._hoveredTarget,nextTarget:o},this._hoveredTarget=o),o?n!==o&&(n&&(this.fire("mouse:out",i),n.fire("mouseout",i)),this.fire("mouse:over",s),o.fire("mouseover",s)):n&&(this.fire("mouse:out",i),n.fire("mouseout",i))},__onMouseWheel:function(e){this._handleEvent(e,"wheel")},_transformObject:function(r){var t=this.getPointer(r),e=this._currentTransform;e.reset=!1,e.target.isMoving=!0,e.shiftKey=r.shiftKey,e.altKey=r[this.centeredKey],this._beforeScaleTransform(r,e),this._performTransformAction(r,e,t),e.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(l,t,e){var i=e.x,n=e.y,r=t.target,s=t.action,o=!1;"rotate"===s?(o=this._rotateObject(i,n))&&this._fire("rotating",r,l):"scale"===s?(o=this._onScale(l,t,i,n))&&this._fire("scaling",r,l):"scaleX"===s?(o=this._scaleObject(i,n,"x"))&&this._fire("scaling",r,l):"scaleY"===s?(o=this._scaleObject(i,n,"y"))&&this._fire("scaling",r,l):"skewX"===s?(o=this._skewObject(i,n,"x"))&&this._fire("skewing",r,l):"skewY"===s?(o=this._skewObject(i,n,"y"))&&this._fire("skewing",r,l):(o=this._translateObject(i,n),o&&(this._fire("moving",r,l),this.setCursor(r.moveCursor||this.moveCursor))),t.actionPerformed=t.actionPerformed||o},_fire:function(r,t,o){this.fire("object:"+r,{target:t,e:o}),t.fire(r,{e:o})},_beforeScaleTransform:function(r,t){if("scale"===t.action||"scaleX"===t.action||"scaleY"===t.action){var e=this._shouldCenterTransform(t.target);(e&&("center"!==t.originX||"center"!==t.originY)||!e&&"center"===t.originX&&"center"===t.originY)&&(this._resetCurrentTransform(),t.reset=!0)}},_onScale:function(r,t,e,o){return this._isUniscalePossible(r,t.target)?(t.currentAction="scale",this._scaleObject(e,o)):(t.reset||"scale"!==t.currentAction||this._resetCurrentTransform(),t.currentAction="scaleEqually",this._scaleObject(e,o,"equally"))},_isUniscalePossible:function(r,t){return(r[this.uniScaleKey]||this.uniScaleTransform)&&!t.get("lockUniScaling")},_setCursorFromEvent:function(o,t){if(!t)return this.setCursor(this.defaultCursor),!1;var a=t.hoverCursor||this.hoverCursor,i=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,s=(!i||!i.contains(t))&&t._findTargetCorner(this.getPointer(o,!0));this.setCursor(s?this.getCornerCursor(s,t,o):a)},getCornerCursor:function(e,t,r){return this.actionIsDisabled(e,t,r)?this.notAllowedCursor:e in a?this._getRotatedCornerCursor(e,t,r):"mtr"===e&&t.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(r,t,e){return"mt"===r||"mb"===r?e[this.altActionKey]?t.lockSkewingX:t.lockScalingY:"ml"===r||"mr"===r?e[this.altActionKey]?t.lockSkewingY:t.lockScalingX:"mtr"===r?t.lockRotation:this._isUniscalePossible(e,t)?t.lockScalingX&&t.lockScalingY:t.lockScalingX||t.lockScalingY},_getRotatedCornerCursor:function(e,t,o){var n=Math.round(t.angle%360/45);return 0>n&&(n+=8),n+=a[e],o[this.altActionKey]&&0===a[e]%2&&(n+=2),n%=8,this.cursorMap[n]}})}(),!function(){var l=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(r,t){var e=this._activeObject;return e&&this._isSelectionKeyPressed(r)&&t&&t.selectable&&this.selection&&(e!==t||"activeSelection"===e.type)},_handleGrouping:function(r,t){var e=this._activeObject;e.__corner||(t!==e||(t=this.findTarget(r,!0)))&&(e&&"activeSelection"===e.type?this._updateActiveSelection(t,r):this._createActiveSelection(t,r))},_updateActiveSelection:function(r,t){var e=this._activeObject,o=e._objects.slice(0);e.contains(r)?(e.removeWithUpdate(r),this._hoveredTarget=r,1===e.size()&&this._setActiveObject(e.item(0),t)):(e.addWithUpdate(r),this._hoveredTarget=e),this._fireSelectionEvents(o,t)},_createActiveSelection:function(r,t){var e=this.getActiveObjects(),o=this._createGroup(r);this._hoveredTarget=o,this._setActiveObject(o,t),this._fireSelectionEvents(e,t)},_createGroup:function(r){var t=this.getObjects(),e=t.indexOf(this._activeObject)<t.indexOf(r),o=e?[this._activeObject,r]:[r,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(o,{canvas:this})},_groupSelectedObjects:function(r){var t,e=this._collectObjects();1===e.length?this.setActiveObject(e[0],r):1<e.length&&(t=new fabric.ActiveSelection(e.reverse(),{canvas:this}),this.setActiveObject(t,r))},_collectObjects:function(){for(var e,i=[],n=this._groupSelector.ex,r=this._groupSelector.ey,s=n+this._groupSelector.left,o=r+this._groupSelector.top,a=new fabric.Point(l(n,s),l(r,o)),c=new fabric.Point(t(n,s),t(r,o)),d=this._objects.length;d--&&(e=this._objects[d],!(e&&e.selectable&&e.visible&&(e.intersectsWithRect(a,c)||e.isContainedWithinRect(a,c)||e.containsPoint(a)||e.containsPoint(c))&&(i.push(e),n===s&&r===o))););return i},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e),this.setCursor(this.defaultCursor),this._groupSelector=null,this._currentTransform=null}})}(),!function(){var o=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(o){o||(o={});var t=o.format||"png",e=o.quality||1,i=o.multiplier||1,n={left:o.left||0,top:o.top||0,width:o.width||0,height:o.height||0};return this.__toDataURLWithMultiplier(t,e,n,i)},__toDataURLWithMultiplier:function(d,t,e,i){var n=this.width,m=this.height,_=(e.width||this.width)*i,y=(e.height||this.height)*i,x=this.getZoom(),c=x*i,h=this.viewportTransform,l=(h[4]-e.left)*i,u=(h[5]-e.top)*i,f=this.interactive,g=this.skipOffscreen,p=n!==_||m!==y;this.viewportTransform=[c,0,0,c,l,u],this.skipOffscreen=!1,this.interactive=!1,p&&this.setDimensions({width:_,height:y},{backstoreOnly:!0}),this.renderAll();var v=this.__toDataURL(d,t,e);return this.interactive=f,this.skipOffscreen=g,this.viewportTransform=h,p&&this.setDimensions({width:n,height:m},{backstoreOnly:!0}),this.renderAll(),v},__toDataURL:function(t,e){var i=this.contextContainer.canvas;"jpg"===t&&(t="jpeg");var n=o?i.toDataURL("image/"+t,e):i.toDataURL("image/"+t);return n}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(r,t,e){return this.loadFromJSON(r,t,e)},loadFromJSON:function(o,a,e){if(o){var i="string"==typeof o?JSON.parse(o):fabric.util.object.clone(o),n=this,r=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(i.objects,function(e){n.clear(),n._setBgOverlay(i,function(){e.forEach(function(r,t){n.insertAt(r,t)}),n.renderOnAddRemove=r,delete i.objects,delete i.backgroundImage,delete i.overlayImage,delete i.background,delete i.overlay,n._setOptions(i),n.renderAll(),a&&a()})},e),this}},_setBgOverlay:function(r,t){var e={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(r.backgroundImage||r.overlayImage||r.background||r.overlay))return void(t&&t());var o=function(){e.backgroundImage&&e.overlayImage&&e.backgroundColor&&e.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",r.backgroundImage,e,o),this.__setBgOverlay("overlayImage",r.overlayImage,e,o),this.__setBgOverlay("backgroundColor",r.background,e,o),this.__setBgOverlay("overlayColor",r.overlay,e,o)},__setBgOverlay:function(o,t,a,i){var n=this;return t?void("backgroundImage"===o||"overlayImage"===o?fabric.util.enlivenObjects([t],function(t){n[o]=t[0],a[o]=!0,i&&i()}):this["set"+fabric.util.string.capitalize(o,!0)](t,function(){a[o]=!0,i&&i()})):(a[o]=!0,void(i&&i()))},_enlivenObjects:function(r,o,e){return r&&0!==r.length?void fabric.util.enlivenObjects(r,function(e){o&&o(e)},null,e):void(o&&o([]))},_toDataURL:function(r,t){this.clone(function(e){t(e.toDataURL(r))})},_toDataURLWithMultiplier:function(r,t,e){this.clone(function(o){e(o.toDataURLWithMultiplier(r,t))})},clone:function(r,t){var o=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(o,function(){r&&r(t)})})},cloneWithoutData:function(r){var t=fabric.document.createElement("canvas");t.width=this.width,t.height=this.height;var e=new fabric.Canvas(t);e.clipTo=this.clipTo,this.backgroundImage?(e.setBackgroundImage(this.backgroundImage.src,function(){e.renderAll(),r&&r(e)}),e.backgroundImageOpacity=this.backgroundImageOpacity,e.backgroundImageStretch=this.backgroundImageStretch):r&&r(e)}}),!function(){var o=fabric.util.degreesToRadians,t=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(r,o){if(!this.isDrawingMode&&r.touches&&2===r.touches.length&&"gesture"===o.gesture){var n=this.findTarget(r);"undefined"!=typeof n&&(this.__gesturesParams={e:r,self:o,target:n},this.__gesturesRenderer()),this.fire("touch:gesture",{target:n,e:r,self:o})}},__gesturesParams:null,__gesturesRenderer:function(){if(null!==this.__gesturesParams&&null!==this._currentTransform){var r=this.__gesturesParams.self,t=this._currentTransform,e=this.__gesturesParams.e;t.action="scale",t.originX=t.originY="center",this._setOriginToCenter(t.target),this._scaleObjectBy(r.scale,e),0!==r.rotation&&(t.action="rotate",this._rotateObjectByAngle(r.rotation,e)),this._setCenterToOrigin(t.target),this.requestRenderAll(),t.action="drag"}},__onDrag:function(r,o){this.fire("touch:drag",{e:r,self:o})},__onOrientationChange:function(r,o){this.fire("touch:orientation",{e:r,self:o})},__onShake:function(r,o){this.fire("touch:shake",{e:r,self:o})},__onLongPress:function(r,o){this.fire("touch:longpress",{e:r,self:o})},_scaleObjectBy:function(l,t){var e=this._currentTransform,i=e.target,n=i.get("lockScalingX"),c=i.get("lockScalingY");if(!n||!c){i._scaling=!0;var d=i.translateToOriginPoint(i.getCenterPoint(),e.originX,e.originY),o=i._getTransformedDimensions();this._setObjectScale(new fabric.Point(e.scaleX*o.x*l/i.scaleX,e.scaleY*o.y*l/i.scaleY),e,n,c,null,i.get("lockScalingFlip"),o),i.setPositionByOrigin(d,e.originX,e.originY),this._fire("scaling",i,t)}},_rotateObjectByAngle:function(e,i){var n=this._currentTransform;n.target.get("lockRotation")||(n.target.angle=t(o(e)+n.theta),this._fire("rotating",n.target,i))}})}(),!function(l){"use strict";var g=Math.round,x=Math.ceil,C=l.fabric||(l.fabric={}),e=C.util.object.extend,d=C.util.object.clone,u=C.util.toFixed,t=C.util.string.capitalize,p=C.util.degreesToRadians,r=C.StaticCanvas.supports("setLineDash"),o=!C.isLikelyNode,f=2;C.Object||(C.Object=C.util.createClass(C.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:o,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:["top","left","width","height","scaleX","scaleY","flipX","flipY","originX","originY","transformMatrix","stroke","strokeWidth","strokeDashArray","strokeLineCap","strokeLineJoin","strokeMiterLimit","angle","opacity","fill","globalCompositeOperation","shadow","clipTo","visible","backgroundColor","skewX","skewY","fillRule","paintFirst"],cacheProperties:["fill","stroke","strokeWidth","strokeDashArray","width","height","paintFirst","strokeLineCap","strokeLineJoin","strokeMiterLimit","backgroundColor"],initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=C.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas()},_limitCacheSize:function(e){var t=C.perfLimitSizeTotal,i=e.width,r=e.height,n=C.maxCacheSideLimit,a=C.minCacheSideLimit;if(n>=i&&n>=r&&t>=i*r)return a>i&&(e.width=a),a>r&&(e.height=a),e;var o=C.util.limitDimsByArea(i/r,t),s=C.util.capValue,c=s(a,o.x,n),l=s(a,o.y,n);return i>c&&(e.zoomX/=i/c,e.width=c,e.capped=!0),r>l&&(e.zoomY/=r/l,e.height=l,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.canvas&&this.canvas.getZoom()||1,t=this.getObjectScaling(),i=this.canvas&&this.canvas._isRetinaScaling()?C.devicePixelRatio:1,r=this._getNonTransformedDimensions(),n=t.scaleX*e*i,l=t.scaleY*e*i,d=r.x*n,a=r.y*l;return{width:d+f,height:a+f,zoomX:n,zoomY:l,x:r.x,y:r.y}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var e=this.canvas._currentTransform.target,t=this.canvas._currentTransform.action;if(this===e&&t.slice&&"scale"===t.slice(0,5))return!1}var i,r,n=this._cacheCanvas,s=this._limitCacheSize(this._getCacheCanvasDimensions()),o=C.minCacheSideLimit,a=s.width,c=s.height,h=s.zoomX,l=s.zoomY,u=a!==this.cacheWidth||c!==this.cacheHeight,f=this.zoomX!==h||this.zoomY!==l,d=0,p=0,v=!1;if(u){var b=this._cacheCanvas.width,m=this._cacheCanvas.height,y=a>b||c>m;v=y||(.9*b>a||.9*m>c)&&b>o&&m>o,y&&!s.capped&&(a>o||c>o)&&(d=.1*a,p=.1*c)}return!!(u||f)&&(v?(n.width=x(a+d),n.height=x(c+p)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,n.width,n.height)),i=s.x*h/2,r=s.y*l/2,this.cacheTranslationX=g(n.width/2-i)+i,this.cacheTranslationY=g(n.height/2-r)+r,this.cacheWidth=a,this.cacheHeight=c,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(h,l),this.zoomX=h,this.zoomY=l,!0)},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initClipping(e),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(r){var t;t=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),r.transform(t[0],t[1],t[2],t[3],t[4],t[5])},toObject:function(e){var t=C.Object.NUM_FRACTION_DIGITS,o={type:this.type,version:C.version,originX:this.originX,originY:this.originY,left:u(this.left,t),top:u(this.top,t),width:u(this.width,t),height:u(this.height,t),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:u(this.strokeWidth,t),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:u(this.strokeMiterLimit,t),scaleX:u(this.scaleX,t),scaleY:u(this.scaleY,t),angle:u(this.angle,t),flipX:this.flipX,flipY:this.flipY,opacity:u(this.opacity,t),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&this.clipTo+"",backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:u(this.skewX,t),skewY:u(this.skewY,t)};return C.util.populateWithProperties(this,o,e),this.includeDefaultValues||(o=this._removeDefaultValues(o)),o},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(o){var t=C.util.getKlass(o.type).prototype,e=t.stateProperties;return e.forEach(function(n){o[n]===t[n]&&delete o[n];var e="[object Array]"===Object.prototype.toString.call(o[n])&&"[object Array]"===Object.prototype.toString.call(t[n]);e&&0===o[n].length&&0===t[n].length&&delete o[n]}),o},toString:function(){return"#<fabric."+t(this.type)+">"},getObjectScaling:function(){var r=this.scaleX,o=this.scaleY;if(this.group){var n=this.group.getObjectScaling();r*=n.scaleX,o*=n.scaleY}return{scaleX:r,scaleY:o}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,t){var r=this[e]!==t,o=!1;return("scaleX"===e||"scaleY"===e)&&(t=this._constrainScale(t)),"scaleX"===e&&0>t?(this.flipX=!this.flipX,t*=-1):"scaleY"===e&&0>t?(this.flipY=!this.flipY,t*=-1):"shadow"!==e||!t||t instanceof C.Shadow?"dirty"===e&&this.group&&this.group.set("dirty",t):t=new C.Shadow(t),this[e]=t,r&&(o=this.group&&this.group.isOnACache(),-1<this.cacheProperties.indexOf(e)?(this.dirty=!0,o&&this.group.set("dirty",!0)):o&&-1<this.stateProperties.indexOf(e)&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:C.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(e){this.isNotVisible()||(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this.clipTo&&C.util.clipContext(this,e),this.shouldCache()?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext),this.dirty=!1),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&e.restore(),e.restore())},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"==typeof this.shadow},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawObject:function(e){this._renderBackground(e),this._setStrokeStyles(e,this),this._setFillStyles(e,this),this._render(e)},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(r){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!r&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!r){var o=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-n/2,o,n)}return!0}return!1},_renderBackground:function(r){if(this.backgroundColor){var t=this._getNonTransformedDimensions();r.fillStyle=this.backgroundColor,r.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(r)}},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(r,t){t.stroke&&(r.lineWidth=t.strokeWidth,r.lineCap=t.strokeLineCap,r.lineJoin=t.strokeLineJoin,r.miterLimit=t.strokeMiterLimit,r.strokeStyle=t.stroke.toLive?t.stroke.toLive(r,this):t.stroke)},_setFillStyles:function(r,t){t.fill&&(r.fillStyle=t.fill.toLive?t.fill.toLive(r,this):t.fill)},_setLineDash:function(o,t,e){t&&(1&t.length&&t.push.apply(t,t),r?o.setLineDash(t):e&&e(o))},_renderControls:function(e,t){var o,r,n,i=this.getViewportTransform(),a=this.calcTransformMatrix();t=t||{},r="undefined"==typeof t.hasBorders?this.hasBorders:t.hasBorders,n="undefined"==typeof t.hasControls?this.hasControls:t.hasControls,a=C.util.multiplyTransformMatrices(i,a),o=C.util.qrDecompose(a),e.save(),e.translate(o.translateX,o.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),t.forActiveSelection?(e.rotate(p(o.angle)),r&&this.drawBordersInGroup(e,o,t)):(e.rotate(p(this.angle)),r&&this.drawBorders(e,t)),n&&this.drawControls(e,t),e.restore()},_setShadow:function(e){if(this.shadow){var t=this.canvas&&this.canvas.viewportTransform[0]||1,o=this.canvas&&this.canvas.viewportTransform[3]||1,r=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(t*=C.devicePixelRatio,o*=C.devicePixelRatio),e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur*C.browserShadowBlurConstant*(t+o)*(r.scaleX+r.scaleY)/4,e.shadowOffsetX=this.shadow.offsetX*t*r.scaleX,e.shadowOffsetY=this.shadow.offsetY*o*r.scaleY}},_removeShadow:function(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)},_applyPatternGradientTransform:function(o,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var a=t.gradientTransform||t.patternTransform,i=-this.width/2+t.offsetX||0,s=-this.height/2+t.offsetY||0;return o.translate(i,s),a&&o.transform(a[0],a[1],a[2],a[3],a[4],a[5]),{offsetX:i,offsetY:s}},_renderPaintInOrder:function(e){"stroke"===this.paintFirst?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_renderFill:function(e){this.fill&&(e.save(),this._applyPatternGradientTransform(e,this.fill),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())},_renderStroke:function(e){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(e,this.stroke),e.stroke(),e.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=C.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var t=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),t=C.util.transformPoint(t,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,t.x+=e.offsetLeft,t.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(t,"center","center")},clone:function(e,t){var o=this.toObject(t);this.constructor.fromObject?this.constructor.fromObject(o,e):C.Object._fromObject("Object",o,e)},cloneAsImage:function(e,t){var o=this.toDataURL(t);return C.util.loadImage(o,function(t){e&&e(new C.Image(t))}),this},toDataURL:function(e){e||(e={});var t=C.util.createCanvasElement(),i=this.getBoundingRect();t.width=i.width,t.height=i.height,C.util.wrapElement(t,"div");var r=new C.StaticCanvas(t,{enableRetinaScaling:e.enableRetinaScaling});"jpg"===e.format&&(e.format="jpeg"),"jpeg"===e.format&&(r.backgroundColor="#fff");var n={left:this.left,top:this.top};this.setPositionByOrigin(new C.Point(r.width/2,r.height/2),"center","center");var s=this.canvas;r.add(this);var o=r.toDataURL(e);return this.set(n).setCoords(),this.canvas=s,r.dispose(),r=null,o},isType:function(e){return this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},setGradient:function(e,t){t||(t={});var o={colorStops:[]};return o.type=t.type||(t.r1||t.r2?"radial":"linear"),o.coords={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},(t.r1||t.r2)&&(o.coords.r1=t.r1,o.coords.r2=t.r2),o.gradientTransform=t.gradientTransform,C.Gradient.prototype.addColorStop.call(o,t.colorStops),this.set(e,C.Gradient.forObject(this,o))},setPatternFill:function(e){return this.set("fill",new C.Pattern(e))},setShadow:function(e){return this.set("shadow",e?new C.Shadow(e):null)},setColor:function(e){return this.set("fill",e),this},rotate:function(r){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",r),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(e,t){t=t||this.canvas.getPointer(e);var o=new C.Point(t.x,t.y),r=this._getLeftTopCoords();return this.angle&&(o=C.util.rotatePoint(o,r,p(-this.angle))),{x:o.x-r.x,y:o.y-r.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}}),C.util.createAccessors&&C.util.createAccessors(C.Object),e(C.Object.prototype,C.Observable),C.Object.NUM_FRACTION_DIGITS=2,C.Object._fromObject=function(e,r,i,n){var a=C[e];r=d(r,!0),C.util.enlivenPatterns([r.fill,r.stroke],function(o){"undefined"!=typeof o[0]&&(r.fill=o[0]),"undefined"!=typeof o[1]&&(r.stroke=o[1]);var t=n?new a(r[n],r):new a(r);i&&i(t)})},C.Object.__uid=0)}("undefined"==typeof exports?this:exports),!function(){var l=fabric.util.degreesToRadians,d={left:-.5,center:0,right:.5},e={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(i,t,g,p,f){var m,a,c,h=i.x,l=i.y;return"string"==typeof t?t=d[t]:t-=.5,"string"==typeof p?p=d[p]:p-=.5,m=p-t,"string"==typeof g?g=e[g]:g-=.5,"string"==typeof f?f=e[f]:f-=.5,a=f-g,(m||a)&&(c=this._getTransformedDimensions(),h=i.x+m*c.x,l=i.y+a*c.y),new fabric.Point(h,l)},translateToCenterPoint:function(t,e,o){var n=this.translateToGivenOrigin(t,e,o,"center","center");return this.angle?fabric.util.rotatePoint(n,t,l(this.angle)):n},translateToOriginPoint:function(t,e,o){var n=this.translateToGivenOrigin(t,"center","center",e,o);return this.angle?fabric.util.rotatePoint(n,t,l(this.angle)):n},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(r,t){var e=this.getCenterPoint();return this.translateToOriginPoint(e,r,t)},toLocalPoint:function(t,e,a){var c,r,s=this.getCenterPoint();return c="undefined"!=typeof e&&"undefined"!=typeof a?this.translateToGivenOrigin(s,"center","center",e,a):new fabric.Point(this.left,this.top),r=new fabric.Point(t.x,t.y),this.angle&&(r=fabric.util.rotatePoint(r,s,-l(this.angle))),r.subtractEquals(c)},setPositionByOrigin:function(o,t,e){var i=this.translateToCenterPoint(o,t,e),n=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",n.x),this.set("top",n.y)},adjustPosition:function(e){var t,n,r=l(this.angle),s=this.getScaledWidth(),o=Math.cos(r)*s,a=Math.sin(r)*s;t="string"==typeof this.originX?d[this.originX]:this.originX-.5,n="string"==typeof e?d[e]:e-.5,this.left+=o*(n-t),this.top+=a*(n-t),this.setCoords(),this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")},onDeselect:function(){}})}(),!function(){function r(e){return[new fabric.Point(e.tl.x,e.tl.y),new fabric.Point(e.tr.x,e.tr.y),new fabric.Point(e.br.x,e.br.y),new fabric.Point(e.bl.x,e.bl.y)]}var l=Math.tan,S=Math.cos,T=Math.sin,O=fabric.util.degreesToRadians,d=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,e){this.oCoords||this.setCoords();var o=t?this.aCoords:this.oCoords;return r(e?this.calcCoords(t):o)},intersectsWithRect:function(o,t,e,i){var n=this.getCoords(e,i),r=fabric.Intersection.intersectPolygonRectangle(n,o,t);return"Intersection"===r.status},intersectsWithObject:function(r,t,e){var o=fabric.Intersection.intersectPolygonPolygon(this.getCoords(t,e),r.getCoords(t,e));return"Intersection"===o.status||r.isContainedWithinObject(this,t,e)||this.isContainedWithinObject(r,t,e)},isContainedWithinObject:function(o,t,e){for(var i=this.getCoords(t,e),n=0,r=o._getImageLines(e?o.calcCoords(t):t?o.aCoords:o.oCoords);4>n;n++)if(!o.containsPoint(i[n],r))return!1;return!0},isContainedWithinRect:function(o,t,e,i){var n=this.getBoundingRect(e,i);return n.left>=o.x&&n.left+n.width<=t.x&&n.top>=o.y&&n.top+n.height<=t.y},containsPoint:function(o,t,e,i){var t=t||this._getImageLines(i?this.calcCoords(e):e?this.aCoords:this.oCoords),n=this._findCrossPoints(o,t);return 0!==n&&1===n%2},isOnScreen:function(a){if(!this.canvas)return!1;for(var t,e=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br,n=this.getCoords(!0,a),r=0;4>r;r++)if(t=n[r],t.x<=i.x&&t.x>=e.x&&t.y<=i.y&&t.y>=e.y)return!0;if(this.intersectsWithRect(e,i,!0))return!0;var s={x:(e.x+i.x)/2,y:(e.y+i.y)/2};return!!this.containsPoint(s,null,!0)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(l,t){var e,i,n,r,s,o,a=0;for(var c in t)if(o=t[c],!(o.o.y<l.y&&o.d.y<l.y||o.o.y>=l.y&&o.d.y>=l.y||(o.o.x===o.d.x&&o.o.x>=l.x?s=o.o.x:(e=0,i=(o.d.y-o.o.y)/(o.d.x-o.o.x),n=l.y-e*l.x,r=o.o.y-i*o.o.x,s=-(n-r)/(e-i)),s>=l.x&&(a+=1),2!==a)))break;return a},getBoundingRect:function(r,t){var e=this.getCoords(r,t);return fabric.util.makeBoundingBoxFromPoints(e)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?0>e?-this.minScaleLimit:this.minScaleLimit:0===e?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(r,t){var e=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(r/this.width/e)},scaleToHeight:function(r,t){var e=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(r/this.height/e)},calcCoords:function(e){var P=O(this.angle),i=this.getViewportTransform(),n=e?this._getTransformedDimensions():this._calculateCurrentDimensions(),r=n.x,s=n.y,o=P?T(P):0,a=P?S(P):1,c=0<r?Math.atan(s/r):0,h=r/S(c)/2,l=S(c+P)*h,u=T(c+P)*h,f=this.getCenterPoint(),d=e?f:fabric.util.transformPoint(f,i),g=new fabric.Point(d.x-l,d.y-u),D=new fabric.Point(g.x+r*a,g.y+r*o),E=new fabric.Point(g.x-s*o,g.y+s*a),k=new fabric.Point(d.x+l,d.y+u);if(!e)var j=new fabric.Point((g.x+E.x)/2,(g.y+E.y)/2),y=new fabric.Point((D.x+g.x)/2,(D.y+g.y)/2),_=new fabric.Point((k.x+D.x)/2,(k.y+D.y)/2),w=new fabric.Point((k.x+E.x)/2,(k.y+E.y)/2),C=new fabric.Point(y.x+o*this.rotatingPointOffset,y.y-a*this.rotatingPointOffset);var d={tl:g,tr:D,br:k,bl:E};return e||(d.ml=j,d.mt=y,d.mr=_,d.mb=w,d.mtr=C),d},setCoords:function(r,t){return this.oCoords=this.calcCoords(r),t||(this.aCoords=this.calcCoords(!0)),r||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var e=O(this.angle),t=S(e),r=T(e);return(6.123233995736766e-17===t||-1.8369701987210297e-16===t)&&(t=0),[t,r,-r,t,0,0]}return fabric.iMatrix.concat()},transformMatrixKey:function(r){var o="_",e="";return!r&&this.group&&(e=this.group.transformMatrixKey(r)+o),e+this.top+o+this.left+o+this.scaleX+o+this.scaleY+o+this.skewX+o+this.skewY+o+this.angle+o+this.flipX+o+this.flipY+o+this.width+o+this.height},calcTransformMatrix:function(o){if(o)return this.calcOwnMatrix();var t=this.transformMatrixKey(),e=this.matrixCache||(this.matrixCache={});if(e.key===t)return e.value;var n=this.calcOwnMatrix();return this.group&&(n=d(this.group.calcTransformMatrix(),n)),e.key=t,e.value=n,n},calcOwnMatrix:function(){var i=this.transformMatrixKey(!0),t=this.ownMatrixCache||(this.ownMatrixCache={});if(t.key===i)return t.value;var e,n=this.getCenterPoint(),r=[1,0,0,1,n.x,n.y],a=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return this.angle&&(e=this._calcRotateMatrix(),r=d(r,e)),r=d(r,a),t.key=i,t.value=r,r},_calcDimensionsTransformMatrix:function(e,t,n){var r,i=this.scaleX*(n&&this.flipX?-1:1),o=this.scaleY*(n&&this.flipY?-1:1),a=[i,0,0,o,0,0];return e&&(r=[1,0,l(O(e)),1],a=d(a,r,!0)),t&&(r=[1,l(O(t)),0,1],a=d(a,r,!0)),a},_getNonTransformedDimensions:function(){var r=this.strokeWidth,t=this.width+r,o=this.height+r;return{x:t,y:o}},_getTransformedDimensions:function(l,d){"undefined"==typeof l&&(l=this.skewX),"undefined"==typeof d&&(d=this.skewY);var u,i,n=this._getNonTransformedDimensions(),r=n.x/2,g=n.y/2,p=[{x:-r,y:-g},{x:r,y:-g},{x:-r,y:g},{x:r,y:g}],a=this._calcDimensionsTransformMatrix(l,d,!1);for(u=0;u<p.length;u++)p[u]=fabric.util.transformPoint(p[u],a);return i=fabric.util.makeBoundingBoxFromPoints(p),{x:i.width,y:i.height}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),t=this._getTransformedDimensions(),e=fabric.util.transformPoint(t,r,!0);return e.scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e),this}}),!function(){function o(o,i,e){var n={};e.forEach(function(t){n[t]=o[t]}),a(o[i],n,!0)}function l(e,c,i){if(e===c)return!0;if(Array.isArray(e)){if(e.length!==c.length)return!1;for(var d=0,r=e.length;r>d;d++)if(!l(e[d],c[d]))return!1;return!0}if(e&&"object"==typeof e){var s,o=Object.keys(e);if(!i&&o.length!==Object.keys(c).length)return!1;for(var d=0,r=o.length;r>d;d++)if(s=o[d],!l(e[s],c[s]))return!1;return!0}}var a=fabric.util.object.extend,s="stateProperties";fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(e){e=e||s;var t="_"+e;return!!(Object.keys(this[t]).length<this[e].length)||!l(this[t],this,!0)},saveState:function(t){var e=t&&t.propertySet||s,n="_"+e;return this[n]?(o(this,n,this[e]),t&&t.stateProperties&&o(this,n,t.stateProperties),this):this.setupState(t)},setupState:function(r){r=r||{};var t=r.propertySet||s;return r.propertySet=t,this["_"+t]={},this.saveState(r),this}})}(),!function(){var l=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(o){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var t,e,i=o.x,a=o.y;for(var l in this.__corner=0,this.oCoords)if(this.isControlVisible(l)&&("mtr"!==l||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==l&&"mr"!==l&&"mb"!==l&&"ml"!==l)&&(e=this._getImageLines(this.oCoords[l].corner),t=this._findCrossPoints({x:i,y:a},e),0!==t&&1===t%2))return this.__corner=l,l;return!1},_setCornerCoords:function(){var t,e,i=this.oCoords,r=l(45-this.angle),n=.707106*this.cornerSize,s=n*Math.cos(r),o=n*Math.sin(r);for(var a in i)t=i[a].x,e=i[a].y,i[a].corner={tl:{x:t-o,y:e-s},tr:{x:t+s,y:e-o},bl:{x:t-s,y:e+o},br:{x:t+o,y:e+s}}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var e=this.getCenterPoint(),o=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return t.translate(e.x,e.y),t.scale(1/r[0],1/r[3]),t.rotate(l(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-o.x/2,-o.y/2,o.x,o.y),t.restore(),this},drawBorders:function(l,t){t=t||{};var e=this._calculateCurrentDimensions(),i=1/this.borderScaleFactor,r=e.x+i,d=e.y+i,u="undefined"==typeof t.hasRotatingPoint?this.hasRotatingPoint:t.hasRotatingPoint,o="undefined"==typeof t.hasControls?this.hasControls:t.hasControls,a="undefined"==typeof t.rotatingPointOffset?this.rotatingPointOffset:t.rotatingPointOffset;if(l.save(),l.strokeStyle=t.borderColor||this.borderColor,this._setLineDash(l,t.borderDashArray||this.borderDashArray,null),l.strokeRect(-r/2,-d/2,r,d),u&&this.isControlVisible("mtr")&&o){var c=-d/2;l.beginPath(),l.moveTo(0,c),l.lineTo(0,c-a),l.closePath(),l.stroke()}return l.restore(),this},drawBordersInGroup:function(l,t,e){e=e||{};var i=this._getNonTransformedDimensions(),r=fabric.util.customTransformMatrix(t.scaleX,t.scaleY,t.skewX),n=fabric.util.transformPoint(i,r),s=1/this.borderScaleFactor,o=n.x+s,d=n.y+s;return l.save(),this._setLineDash(l,e.borderDashArray||this.borderDashArray,null),l.strokeStyle=e.borderColor||this.borderColor,l.strokeRect(-o/2,-d/2,o,d),l.restore(),this},drawControls:function(d,t){t=t||{};var e=this._calculateCurrentDimensions(),i=e.x,r=e.y,n=t.cornerSize||this.cornerSize,s=-(i+n)/2,o=-(r+n)/2,a="undefined"==typeof t.transparentCorners?this.transparentCorners:t.transparentCorners,c="undefined"==typeof t.hasRotatingPoint?this.hasRotatingPoint:t.hasRotatingPoint,u=a?"stroke":"fill";return d.save(),d.strokeStyle=d.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(d.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(d,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",d,u,s,o,t),this._drawControl("tr",d,u,s+i,o,t),this._drawControl("bl",d,u,s,o+r,t),this._drawControl("br",d,u,s+i,o+r,t),this.get("lockUniScaling")||(this._drawControl("mt",d,u,s+i/2,o,t),this._drawControl("mb",d,u,s+i/2,o+r,t),this._drawControl("mr",d,u,s+i,o+r/2,t),this._drawControl("ml",d,u,s,o+r/2,t)),c&&this._drawControl("mtr",d,u,s+i/2,o-this.rotatingPointOffset,t),d.restore(),this},_drawControl:function(l,t,e,i,r,n){if(n=n||{},this.isControlVisible(l)){var s=this.cornerSize,o=!this.transparentCorners&&this.cornerStrokeColor;switch(n.cornerStyle||this.cornerStyle){case"circle":t.beginPath(),t.arc(i+s/2,r+s/2,s/2,0,2*Math.PI,!1),t[e](),o&&t.stroke();break;default:this.transparentCorners||t.clearRect(i,r,s,s),t[e+"Rect"](i,r,s,s),o&&t.strokeRect(i,r,s,s);}}},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(r,t){return this._getControlsVisibility()[r]=t,this},setControlsVisibility:function(r){for(var t in r||(r={}),r)this.setControlVisible(t,r[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(o,t){t=t||{};var e=function(){},i=t.onComplete||e,r=t.onChange||e,n=this;return fabric.util.animate({startValue:o.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){o.set("left",t),n.requestRenderAll(),r()},onComplete:function(){o.setCoords(),i()}}),this},fxCenterObjectV:function(o,t){t=t||{};var e=function(){},i=t.onComplete||e,r=t.onChange||e,n=this;return fabric.util.animate({startValue:o.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){o.set("top",t),n.requestRenderAll(),r()},onComplete:function(){o.setCoords(),i()}}),this},fxRemove:function(o,t){t=t||{};var e=function(){},i=t.onComplete||e,r=t.onChange||e,n=this;return fabric.util.animate({startValue:o.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){o.set("opacity",t),n.requestRenderAll(),r()},onComplete:function(){n.remove(o),i()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var o,t,e=[];for(o in arguments[0])e.push(o);for(var i=0,r=e.length;r>i;i++)o=e[i],t=i!==r-1,this._animate(o,arguments[0][o],arguments[1],t)}else this._animate.apply(this,arguments);return this},_animate:function(l,t,c,i){var r,d=this;t=t.toString(),c=c?fabric.util.object.clone(c):{},~l.indexOf(".")&&(r=l.split("."));var n=r?this.get(r[0])[r[1]]:this.get(l);"from"in c||(c.from=n),t=~t.indexOf("=")?n+parseFloat(t.replace("=","")):parseFloat(t),fabric.util.animate({startValue:c.from,endValue:t,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(d)},onChange:function(t,e,o){r?d[r[0]][r[1]]=t:d.set(l,t),i||c.onChange&&c.onChange(t,e,o)},onComplete:function(r,t,e){i||(d.setCoords(),c.onComplete&&c.onComplete(r,t,e))}})}}),!function(a){"use strict";function t(l,t){var d=l.origin,i=l.axis1,r=l.axis2,n=l.dimension,s=t.nearest,o=t.center,a=t.farthest;return function(){switch(this.get(d)){case s:return e(this.get(i),this.get(r));case o:return e(this.get(i),this.get(r))+.5*this.get(n);case a:return Math.max(this.get(i),this.get(r));}}}var e=Math.min,l=Math.abs,c=a.fabric||(a.fabric={}),i=c.util.object.extend,r=c.util.object.clone,n={x1:1,x2:1,y1:1,y2:1},s=c.StaticCanvas.supports("setLineDash");return c.Line?void c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:c.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(r,t){r||(r=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",r[0]),this.set("y1",r[1]),this.set("x2",r[2]),this.set("y2",r[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=l(this.x2-this.x1),this.height=l(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(r,t){return this.callSuper("_set",r,t),"undefined"!=typeof n[r]&&this._setWidthHeight(),this},_getLeftToOriginX:t({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:t({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(r){if(r.beginPath(),!this.strokeDashArray||this.strokeDashArray&&s){var t=this.calcLinePoints();r.moveTo(t.x1,t.y1),r.lineTo(t.x2,t.y2)}r.lineWidth=this.strokeWidth;var e=r.strokeStyle;r.strokeStyle=this.stroke||r.fillStyle,this.stroke&&this._renderStroke(r),r.strokeStyle=e},_renderDashedStroke:function(r){var t=this.calcLinePoints();r.beginPath(),c.util.drawDashedLine(r,t.x1,t.y1,t.x2,t.y2,this.strokeDashArray),r.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return i(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(e.y-=this.strokeWidth),0===this.height&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var o=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,e=.5*(o*this.width),a=.5*(t*this.height),l=-.5*(o*this.width),c=-.5*(t*this.height);return{x1:e,x2:l,y1:a,y2:c}}}),void(c.Line.fromObject=function(o,n){var e=r(o,!0);e.points=[o.x1,o.y1,o.x2,o.y2],c.Object._fromObject("Line",e,function(e){delete e.points,n&&n(e)},"points")}))}("undefined"==typeof exports?this:exports),!function(r){"use strict";{var o=r.fabric||(r.fabric={}),e=Math.PI;o.util.object.extend}return o.Circle?void o.warn("fabric.Circle is already defined."):(o.Circle=o.util.createClass(o.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*e,cacheProperties:o.Object.prototype.cacheProperties.concat("radius"),initialize:function(e){this.callSuper("initialize",e),this.set("radius",e&&e.radius||0)},_set:function(r,t){return this.callSuper("_set",r,t),"radius"===r&&this.setRadius(t),this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_render:function(e){e.beginPath(),e.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){return this.radius=e,this.set("width",2*e).set("height",2*e)}}),void(o.Circle.fromObject=function(e,t){return o.Object._fromObject("Circle",e,t)}))}("undefined"==typeof exports?this:exports),!function(r){"use strict";var o=r.fabric||(r.fabric={});return o.Triangle?void o.warn("fabric.Triangle is already defined"):(o.Triangle=o.util.createClass(o.Object,{type:"triangle",initialize:function(e){this.callSuper("initialize",e),this.set("width",e&&e.width||100).set("height",e&&e.height||100)},_render:function(r){var t=this.width/2,o=this.height/2;r.beginPath(),r.moveTo(-t,o),r.lineTo(0,-o),r.lineTo(t,o),r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(e){var t=this.width/2,n=this.height/2;e.beginPath(),o.util.drawDashedLine(e,-t,n,0,-n,this.strokeDashArray),o.util.drawDashedLine(e,0,-n,t,n,this.strokeDashArray),o.util.drawDashedLine(e,t,n,-t,n,this.strokeDashArray),e.closePath()}}),void(o.Triangle.fromObject=function(e,t){return o.Object._fromObject("Triangle",e,t)}))}("undefined"==typeof exports?this:exports),!function(r){"use strict";{var o=r.fabric||(r.fabric={}),e=2*Math.PI;o.util.object.extend}return o.Ellipse?void o.warn("fabric.Ellipse is already defined."):(o.Ellipse=o.util.createClass(o.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:o.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this.set("rx",e&&e.rx||0),this.set("ry",e&&e.ry||0)},_set:function(r,t){switch(this.callSuper("_set",r,t),r){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t);}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_render:function(r){r.beginPath(),r.save(),r.transform(1,0,0,this.ry/this.rx,0,0),r.arc(0,0,this.rx,0,e,!1),r.restore(),this._renderPaintInOrder(r)}}),void(o.Ellipse.fromObject=function(e,t){return o.Object._fromObject("Ellipse",e,t)}))}("undefined"==typeof exports?this:exports),!function(r){"use strict";var l=Math.min;{var o=r.fabric||(r.fabric={});o.util.object.extend}return o.Rect?void o.warn("fabric.Rect is already defined"):(o.Rect=o.util.createClass(o.Object,{stateProperties:o.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:o.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(d){if(1===this.width&&1===this.height)return void d.fillRect(-.5,-.5,1,1);var t=this.rx?l(this.rx,this.width/2):0,e=this.ry?l(this.ry,this.height/2):0,i=this.width,r=this.height,n=-this.width/2,s=-this.height/2,o=0!==t||0!==e,a=.4477152502;d.beginPath(),d.moveTo(n+t,s),d.lineTo(n+i-t,s),o&&d.bezierCurveTo(n+i-a*t,s,n+i,s+a*e,n+i,s+e),d.lineTo(n+i,s+r-e),o&&d.bezierCurveTo(n+i,s+r-a*e,n+i-a*t,s+r,n+i-t,s+r),d.lineTo(n+t,s+r),o&&d.bezierCurveTo(n+a*t,s+r,n,s+r-a*e,n,s+r-e),d.lineTo(n,s+e),o&&d.bezierCurveTo(n,s+a*e,n+a*t,s,n+t,s),d.closePath(),this._renderPaintInOrder(d)},_renderDashedStroke:function(e){var t=-this.width/2,i=-this.height/2,r=this.width,n=this.height;e.beginPath(),o.util.drawDashedLine(e,t,i,t+r,i,this.strokeDashArray),o.util.drawDashedLine(e,t+r,i,t+r,i+n,this.strokeDashArray),o.util.drawDashedLine(e,t+r,i+n,t,i+n,this.strokeDashArray),o.util.drawDashedLine(e,t,i+n,t,i,this.strokeDashArray),e.closePath()},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))}}),void(o.Rect.fromObject=function(e,t){return o.Object._fromObject("Rect",e,t)}))}("undefined"==typeof exports?this:exports),!function(o){"use strict";{var a=o.fabric||(o.fabric={}),e=a.util.object.extend,l=a.util.array.min,r=a.util.array.max;a.util.toFixed,a.Object.NUM_FRACTION_DIGITS}return a.Polyline?void a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,cacheProperties:a.Object.prototype.cacheProperties.concat("points"),initialize:function(r,t){t=t||{},this.points=r||[],this.callSuper("initialize",t);var e=this._calcDimensions();"undefined"==typeof t.left&&(this.left=e.left),"undefined"==typeof t.top&&(this.top=e.top),this.width=e.width,this.height=e.height,this.pathOffset={x:e.left+this.width/2,y:e.top+this.height/2}},_calcDimensions:function(){var n=this.points,t=l(n,"x")||0,a=l(n,"y")||0,c=r(n,"x")||0,s=r(n,"y")||0;return{left:t,top:a,width:c-t,height:s-a}},toObject:function(r){return e(this.callSuper("toObject",r),{points:this.points.concat()})},commonRender:function(o){var t,e=this.points.length,a=this.pathOffset.x,r=this.pathOffset.y;if(!e||isNaN(this.points[e-1].y))return!1;o.beginPath(),o.moveTo(this.points[0].x-a,this.points[0].y-r);for(var n=0;e>n;n++)t=this.points[n],o.lineTo(t.x-a,t.y-r);return!0},_render:function(e){this.commonRender(e)&&this._renderPaintInOrder(e)},_renderDashedStroke:function(e){var t,o;e.beginPath();for(var r=0,n=this.points.length;n>r;r++)t=this.points[r],o=this.points[r+1]||t,a.util.drawDashedLine(e,t.x,t.y,o.x,o.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),void(a.Polyline.fromObject=function(e,t){return a.Object._fromObject("Polyline",e,t,"points")}))}("undefined"==typeof exports?this:exports),!function(r){"use strict";{var o=r.fabric||(r.fabric={});o.util.object.extend}return o.Polygon?void o.warn("fabric.Polygon is already defined"):(o.Polygon=o.util.createClass(o.Polyline,{type:"polygon",_render:function(e){this.commonRender(e)&&(e.closePath(),this._renderPaintInOrder(e))},_renderDashedStroke:function(e){this.callSuper("_renderDashedStroke",e),e.closePath()}}),void(o.Polygon.fromObject=function(e,t){return o.Object._fromObject("Polygon",e,t,"points")}))}("undefined"==typeof exports?this:exports),!function(l){"use strict";var m=l.fabric||(l.fabric={}),e=m.util.array.min,i=m.util.array.max,r=m.util.object.extend,n=Object.prototype.toString,p=m.util.drawArc,u={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},a={m:"l",M:"L"};return m.Path?void m.warn("fabric.Path is already defined"):(m.Path=m.util.createClass(m.Object,{type:"path",path:null,cacheProperties:m.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:m.Object.prototype.stateProperties.concat("path"),initialize:function(r,t){t=t||{},this.callSuper("initialize",t),r||(r=[]);var e="[object Array]"===n.call(r);this.path=e?r:r.match&&r.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(e||(this.path=this._parsePath()),this._setPositionDimensions(t))},_setPositionDimensions:function(r){var t=this._parseDimensions();this.width=t.width,this.height=t.height,"undefined"==typeof r.left&&(this.left=t.left),"undefined"==typeof r.top&&(this.top=t.top),this.pathOffset=this.pathOffset||{x:t.left+this.width/2,y:t.top+this.height/2}},_renderPathCommands:function(o){var t,e,i,r=null,n=0,s=0,a=0,c=0,h=0,l=0,u=-this.pathOffset.x,f=-this.pathOffset.y;o.beginPath();for(var d=0,g=this.path.length;g>d;++d){switch(t=this.path[d],t[0]){case"l":a+=t[1],c+=t[2],o.lineTo(a+u,c+f);break;case"L":a=t[1],c=t[2],o.lineTo(a+u,c+f);break;case"h":a+=t[1],o.lineTo(a+u,c+f);break;case"H":a=t[1],o.lineTo(a+u,c+f);break;case"v":c+=t[1],o.lineTo(a+u,c+f);break;case"V":c=t[1],o.lineTo(a+u,c+f);break;case"m":a+=t[1],c+=t[2],n=a,s=c,o.moveTo(a+u,c+f);break;case"M":a=t[1],c=t[2],n=a,s=c,o.moveTo(a+u,c+f);break;case"c":e=a+t[5],i=c+t[6],h=a+t[3],l=c+t[4],o.bezierCurveTo(a+t[1]+u,c+t[2]+f,h+u,l+f,e+u,i+f),a=e,c=i;break;case"C":a=t[5],c=t[6],h=t[3],l=t[4],o.bezierCurveTo(t[1]+u,t[2]+f,h+u,l+f,a+u,c+f);break;case"s":e=a+t[3],i=c+t[4],null===r[0].match(/[CcSs]/)?(h=a,l=c):(h=2*a-h,l=2*c-l),o.bezierCurveTo(h+u,l+f,a+t[1]+u,c+t[2]+f,e+u,i+f),h=a+t[1],l=c+t[2],a=e,c=i;break;case"S":e=t[3],i=t[4],null===r[0].match(/[CcSs]/)?(h=a,l=c):(h=2*a-h,l=2*c-l),o.bezierCurveTo(h+u,l+f,t[1]+u,t[2]+f,e+u,i+f),a=e,c=i,h=t[1],l=t[2];break;case"q":e=a+t[3],i=c+t[4],h=a+t[1],l=c+t[2],o.quadraticCurveTo(h+u,l+f,e+u,i+f),a=e,c=i;break;case"Q":e=t[3],i=t[4],o.quadraticCurveTo(t[1]+u,t[2]+f,e+u,i+f),a=e,c=i,h=t[1],l=t[2];break;case"t":e=a+t[1],i=c+t[2],null===r[0].match(/[QqTt]/)?(h=a,l=c):(h=2*a-h,l=2*c-l),o.quadraticCurveTo(h+u,l+f,e+u,i+f),a=e,c=i;break;case"T":e=t[1],i=t[2],null===r[0].match(/[QqTt]/)?(h=a,l=c):(h=2*a-h,l=2*c-l),o.quadraticCurveTo(h+u,l+f,e+u,i+f),a=e,c=i;break;case"a":p(o,a+u,c+f,[t[1],t[2],t[3],t[4],t[5],t[6]+a+u,t[7]+c+f]),a+=t[6],c+=t[7];break;case"A":p(o,a+u,c+f,[t[1],t[2],t[3],t[4],t[5],t[6]+u,t[7]+f]),a=t[6],c=t[7];break;case"z":case"Z":a=n,c=s,o.closePath();}r=t}},_render:function(e){this._renderPathCommands(e),this._renderPaintInOrder(e)},toString:function(){return"#<fabric.Path ("+this.complexity()+"): { \"top\": "+this.top+", \"left\": "+this.left+" }>"},toObject:function(o){var t=r(this.callSuper("toObject",o),{path:this.path.map(function(e){return e.slice()}),top:this.top,left:this.left});return t},toDatalessObject:function(r){var t=this.toObject(["sourcePath"].concat(r));return t.sourcePath&&delete t.path,t},complexity:function(){return this.path.length},_parsePath:function(){for(var c,t,e,i,r,n=[],s=[],o=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,h=0,l=this.path.length;l>h;h++){for(c=this.path[h],i=c.slice(1).trim(),s.length=0;e=o.exec(i);)s.push(e[0]);r=[c.charAt(0)];for(var _=0,f=s.length;f>_;_++)t=parseFloat(s[_]),isNaN(t)||r.push(t);var d=r[0],g=u[d.toLowerCase()],p=a[d]||d;if(r.length-1>g)for(var y=1,v=r.length;v>y;y+=g)n.push([d].concat(r.slice(y,y+g))),d=p;else n.push(r)}return n},_parseDimensions:function(){for(var r,t,n,s,o=[],a=[],c=null,h=0,l=0,u=0,f=0,d=0,g=0,p=0,v=this.path.length;v>p;++p){switch(r=this.path[p],r[0]){case"l":u+=r[1],f+=r[2],s=[];break;case"L":u=r[1],f=r[2],s=[];break;case"h":u+=r[1],s=[];break;case"H":u=r[1],s=[];break;case"v":f+=r[1],s=[];break;case"V":f=r[1],s=[];break;case"m":u+=r[1],f+=r[2],h=u,l=f,s=[];break;case"M":u=r[1],f=r[2],h=u,l=f,s=[];break;case"c":t=u+r[5],n=f+r[6],d=u+r[3],g=f+r[4],s=m.util.getBoundsOfCurve(u,f,u+r[1],f+r[2],d,g,t,n),u=t,f=n;break;case"C":d=r[3],g=r[4],s=m.util.getBoundsOfCurve(u,f,r[1],r[2],d,g,r[5],r[6]),u=r[5],f=r[6];break;case"s":t=u+r[3],n=f+r[4],null===c[0].match(/[CcSs]/)?(d=u,g=f):(d=2*u-d,g=2*f-g),s=m.util.getBoundsOfCurve(u,f,d,g,u+r[1],f+r[2],t,n),d=u+r[1],g=f+r[2],u=t,f=n;break;case"S":t=r[3],n=r[4],null===c[0].match(/[CcSs]/)?(d=u,g=f):(d=2*u-d,g=2*f-g),s=m.util.getBoundsOfCurve(u,f,d,g,r[1],r[2],t,n),u=t,f=n,d=r[1],g=r[2];break;case"q":t=u+r[3],n=f+r[4],d=u+r[1],g=f+r[2],s=m.util.getBoundsOfCurve(u,f,d,g,d,g,t,n),u=t,f=n;break;case"Q":d=r[1],g=r[2],s=m.util.getBoundsOfCurve(u,f,d,g,d,g,r[3],r[4]),u=r[3],f=r[4];break;case"t":t=u+r[1],n=f+r[2],null===c[0].match(/[QqTt]/)?(d=u,g=f):(d=2*u-d,g=2*f-g),s=m.util.getBoundsOfCurve(u,f,d,g,d,g,t,n),u=t,f=n;break;case"T":t=r[1],n=r[2],null===c[0].match(/[QqTt]/)?(d=u,g=f):(d=2*u-d,g=2*f-g),s=m.util.getBoundsOfCurve(u,f,d,g,d,g,t,n),u=t,f=n;break;case"a":s=m.util.getBoundsOfArc(u,f,r[1],r[2],r[3],r[4],r[5],r[6]+u,r[7]+f),u+=r[6],f+=r[7];break;case"A":s=m.util.getBoundsOfArc(u,f,r[1],r[2],r[3],r[4],r[5],r[6],r[7]),u=r[6],f=r[7];break;case"z":case"Z":u=h,f=l;}c=r,s.forEach(function(e){o.push(e.x),a.push(e.y)}),o.push(u),a.push(f)}var x=e(o)||0,b=e(a)||0,S=i(o)||0,_=i(a)||0;return{left:x,top:b,width:S-x,height:_-b}}}),void(m.Path.fromObject=function(o,t){if("string"==typeof o.sourcePath){var e=o.sourcePath;m.loadSVGFromURL(e,function(n){var e=n[0];e.setOptions(o),t&&t(e)})}else m.Object._fromObject("Path",o,t,"path")}))}("undefined"==typeof exports?this:exports),!function(o){"use strict";var l=o.fabric||(o.fabric={}),a=l.util.object.extend,e=l.util.array.min,r=l.util.array.max;l.Group||(l.Group=l.util.createClass(l.Object,l.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(o,t,e){t=t||{},this._objects=[],e&&this.callSuper("initialize",t),this._objects=o||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;if(t.originX&&(this.originX=t.originX),t.originY&&(this.originY=t.originY),e)this._updateObjectsACoords();else{var r=t&&t.centerPoint;r||this._calcBounds(),this._updateObjectsCoords(r),delete t.centerPoint,this.callSuper("initialize",t)}this.setCoords()},_updateObjectsACoords:function(){for(var e=this._objects.length;e--;)this._objects[e].setCoords(!0,!0)},_updateObjectsCoords:function(r){for(var r=r||this.getCenterPoint(),t=this._objects.length;t--;)this._updateObjectCoords(this._objects[t],r)},_updateObjectCoords:function(o,t){var e=o.left,n=o.top;o.set({left:e-t.x,top:n-t.y}),o.group=this,o.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){return this._restoreObjectsState(),l.util.resetObjectTransform(this),e&&(this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(e){return this._restoreObjectsState(),l.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(r,t){var e=this._objects.length;if(this.useSetOnGroup)for(;e--;)this._objects[e].setOnGroup(r,t);if("canvas"===r)for(e=this._objects.length;e--;)this._objects[e]._set(r,t);this.callSuper("_set",r,t)},toObject:function(o){var t=this.getObjects().map(function(t){var e=t.includeDefaultValues;t.includeDefaultValues=t.group.includeDefaultValues;var n=t.toObject(o);return t.includeDefaultValues=e,n});return a(this.callSuper("toObject",o),{objects:t})},toDatalessObject:function(o){var t,n=this.sourcePath;return t=n?n:this.getObjects().map(function(t){var e=t.includeDefaultValues;t.includeDefaultValues=t.group.includeDefaultValues;var n=t.toDatalessObject(o);return t.includeDefaultValues=e,n}),a(this.callSuper("toDatalessObject",o),{objects:t})},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var r=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=r,r)for(var t=0,e=this._objects.length;e>t;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1,!1;return r},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var r=0,t=this._objects.length;t>r;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var t=0,e=this._objects.length;e>t;t++)this._objects[t].render(r)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var o=0,t=this._objects.length;t>o;o++)if(this._objects[o].isCacheDirty(!0)){if(this._cacheCanvas){var e=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-n/2,e,n)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(e){var t=e.calcTransformMatrix(),o=l.util.qrDecompose(t),r=new l.Point(o.translateX,o.translateY);return e.flipX=!1,e.flipY=!1,e.set("scaleX",o.scaleX),e.set("scaleY",o.scaleY),e.skewX=o.skewX,e.skewY=o.skewY,e.angle=o.angle,e.setPositionByOrigin(r,"center","center"),e},_restoreObjectState:function(e){return this.realizeTransform(e),e.setCoords(),delete e.group,this},destroy:function(){return this._objects.forEach(function(e){e.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var e=this._objects,o=this.canvas;this._objects=[];var t=this.toObject();delete t.objects;var r=new l.ActiveSelection([]);return r.set(t),r.type="activeSelection",o.remove(this),e.forEach(function(e){e.group=r,e.dirty=!0,o.add(e)}),r.canvas=o,r._objects=e,o._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(e){e.setCoords(!0,!0)}),this},_calcBounds:function(l){for(var t,e,i,r=[],n=[],s=["tr","br","bl","tl"],o=0,a=this._objects.length,c=s.length;a>o;++o)for(t=this._objects[o],t.setCoords(!0),i=0;c>i;i++)e=s[i],r.push(t.oCoords[e].x),n.push(t.oCoords[e].y);this.set(this._getBounds(r,n,l))},_getBounds:function(n,t,i){var s=new l.Point(e(n),e(t)),o=new l.Point(r(n),r(t)),a={width:o.x-s.x||0,height:o.y-s.y||0};return i||(a.left=s.x||0,a.top=s.y||0,"center"===this.originX&&(a.left+=a.width/2),"right"===this.originX&&(a.left+=a.width),"center"===this.originY&&(a.top+=a.height/2),"bottom"===this.originY&&(a.top+=a.height)),a}}),l.Group.fromObject=function(e,t){l.util.enlivenObjects(e.objects,function(o){var r=l.util.object.clone(e,!0);delete r.objects,t&&t(new l.Group(o,r,!0))})})}("undefined"==typeof exports?this:exports),!function(r){"use strict";var o=r.fabric||(r.fabric={});o.ActiveSelection||(o.ActiveSelection=o.util.createClass(o.Group,{type:"activeSelection",initialize:function(e,t){t=t||{},this._objects=e||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;t.originX&&(this.originX=t.originX),t.originY&&(this.originY=t.originY),this._calcBounds(),this._updateObjectsCoords(),o.Object.prototype.initialize.call(this,t),this.setCoords()},toGroup:function(){var e=this._objects;this._objects=[];var t=this.toObject(),i=new o.Group([]);if(delete t.objects,i.set(t),i.type="group",e.forEach(function(e){e.group=i,e.canvas.remove(e)}),i._objects=e,!this.canvas)return i;var r=this.canvas;return r.add(i),r._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},_set:function(e,t){var n=this._objects.length;if("canvas"===e)for(;n--;)this._objects[n].set(e,t);if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(e,t);o.Object.prototype._set.call(this,e,t)},shouldCache:function(){return!1},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var r=0,t=this._objects.length;t>r;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return!1},_renderControls:function(o,t,e){o.save(),o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",o,t),e=e||{},"undefined"==typeof e.hasControls&&(e.hasControls=!1),"undefined"==typeof e.hasRotatingPoint&&(e.hasRotatingPoint=!1),e.forActiveSelection=!0;for(var i=0,r=this._objects.length;r>i;i++)this._objects[i]._renderControls(o,e);o.restore()}}),o.ActiveSelection.fromObject=function(e,t){o.util.enlivenObjects(e.objects,function(n){delete e.objects,t&&t(new o.ActiveSelection(n,e,!0))})})}("undefined"==typeof exports?this:exports),!function(r){"use strict";var o=fabric.util.object.extend;return r.fabric||(r.fabric={}),r.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),objectCaching:!1,cacheKey:"",cropX:0,cropY:0,initialize:function(r,t){t||(t={}),this.filters=[],this.callSuper("initialize",t),this._initElement(r,t),this.cacheKey="texture"+fabric.Object.__uid++},getElement:function(){return this._element},setElement:function(r,t){var e=fabric.filterBackend;return e&&e.evictCachesForKey&&(e.evictCachesForKey(this.cacheKey),e.evictCachesForKey(this.cacheKey+"_filtered")),this._element=r,this._originalElement=r,this._initConfig(t),this.resizeFilter&&this.applyResizeFilters(),0!==this.filters.length&&this.applyFilters(),this},setCrossOrigin:function(e){return this.crossOrigin=e,this._element.crossOrigin=e,this},getOriginalSize:function(){var e=this.getElement();return{width:e.width,height:e.height}},_stroke:function(r){if(this.stroke&&0!==this.strokeWidth){var t=this.width/2,o=this.height/2;r.beginPath(),r.moveTo(-t,-o),r.lineTo(t,-o),r.lineTo(t,o),r.lineTo(-t,o),r.lineTo(-t,-o),r.closePath()}},_renderDashedStroke:function(o){var t=-this.width/2,e=-this.height/2,i=this.width,r=this.height;o.save(),this._setStrokeStyles(o,this),o.beginPath(),fabric.util.drawDashedLine(o,t,e,t+i,e,this.strokeDashArray),fabric.util.drawDashedLine(o,t+i,e,t+i,e+r,this.strokeDashArray),fabric.util.drawDashedLine(o,t+i,e+r,t,e+r,this.strokeDashArray),fabric.util.drawDashedLine(o,t,e+r,t,e,this.strokeDashArray),o.closePath(),o.restore()},toObject:function(e){var n=[];this.filters.forEach(function(e){e&&n.push(e.toObject())});var t=o(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(e)),{src:this.getSrc(),filters:n});return this.resizeFilter&&(t.resizeFilter=this.resizeFilter.toObject()),t},getSrc:function(r){var t=r?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():t.src:this.src||""},setSrc:function(r,o,e){return fabric.util.loadImage(r,function(r){this.setElement(r,e),o(this)},this,e&&e.crossOrigin),this},toString:function(){return"#<fabric.Image: { src: \""+this.getSrc()+"\" }>"},applyResizeFilters:function(){var l=this.resizeFilter,d=this.canvas?this.canvas.getRetinaScaling():1,e=this.minimumScaleTrigger,i=this.scaleX*d,r=this.scaleY*d,n=this._filteredEl||this._originalElement;if(!l||i>e&&r>e)return this._element=n,this._filterScalingX=1,void(this._filterScalingY=1);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var s=fabric.util.createCanvasElement(),o=this._filteredEl?this.cacheKey:this.cacheKey+"_filtered",a=n.width,c=n.height;s.width=a,s.height=c,this._element=s,l.scaleX=i,l.scaleY=r,fabric.filterBackend.applyFilters([l],n,a,c,this._element,o),this._filterScalingX=s.width/this._originalElement.width,this._filterScalingY=s.height/this._originalElement.height},applyFilters:function(o){if(o=o||this.filters||[],o=o.filter(function(e){return e}),0===o.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var t=this._originalElement,e=t.naturalWidth||t.width,i=t.naturalHeight||t.height;if(this._element===this._originalElement){var r=fabric.util.createCanvasElement();r.width=e,r.height=i,this._element=r,this._filteredEl=r}else this._element.getContext("2d").clearRect(0,0,e,i);return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(o,this._originalElement,e,i,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(e){!1===this.isMoving&&this.resizeFilter&&this._needsResize()&&(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,this.applyResizeFilters()),this._stroke(e),this._renderPaintInOrder(e)},_renderFill:function(o){var t=this.width,s=this.height,l=t*this._filterScalingX,r=s*this._filterScalingY,n=this._element;n&&o.drawImage(n,this.cropX*this._filterScalingX,this.cropY*this._filterScalingY,l,r,-t/2,-s/2,t,s)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_resetWidthHeight:function(){var e=this.getElement();this.set("width",e.width),this.set("height",e.height)},_initElement:function(r,t){this.setElement(fabric.util.getById(r),t),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(r,o){r&&r.length?fabric.util.enlivenObjects(r,function(e){o&&o(e)},"fabric.Image.filters"):o&&o()},_setWidthHeight:function(e){this.width="width"in e?e.width:this.getElement()?this.getElement().width||0:0,this.height="height"in e?e.height:this.getElement()?this.getElement().height||0:0},parsePreserveAspectRatioAttribute:function(){var d,g=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),e=this._element.width,p=this._element.height,m=1,_=1,y=0,v=0,x=0,C=0,b=this.width,S=this.height,T={width:b,height:S};return g&&("none"!==g.alignX||"none"!==g.alignY)?("meet"===g.meetOrSlice&&(m=_=fabric.util.findScaleToFit(this._element,T),d=(b-e*m)/2,"Min"===g.alignX&&(y=-d),"Max"===g.alignX&&(y=d),d=(S-p*_)/2,"Min"===g.alignY&&(v=-d),"Max"===g.alignY&&(v=d)),"slice"===g.meetOrSlice&&(m=_=fabric.util.findScaleToCover(this._element,T),d=e-b/m,"Mid"===g.alignX&&(x=d/2),"Max"===g.alignX&&(x=d),d=p-S/_,"Mid"===g.alignY&&(C=d/2),"Max"===g.alignY&&(C=d),e=b/m,p=S/_)):(m=b/e,_=S/p),{width:e,height:p,scaleX:m,scaleY:_,offsetLeft:y,offsetTop:v,cropX:x,cropY:C}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(o,t){fabric.util.loadImage(o.src,function(e,n){return n?void(t&&t(null,n)):void fabric.Image.prototype._initFilters.call(o,o.filters,function(n){o.filters=n||[],fabric.Image.prototype._initFilters.call(o,[o.resizeFilter],function(i){o.resizeFilter=i[0];var r=new fabric.Image(e,o);t(r)})})},null,o.crossOrigin)},void(fabric.Image.fromURL=function(r,o,e){fabric.util.loadImage(r,function(r){o&&o(new fabric.Image(r,e))},null,e&&e.crossOrigin)}))}("undefined"==typeof exports?this:exports),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=Math.round,r=this.angle%360;return 0<r?90*e((r-1)/90):90*e(r/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(o){o=o||{};var t=function(){},e=o.onComplete||t,i=o.onChange||t,r=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){r.rotate(e),i()},onComplete:function(){r.setCoords(),e()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound}),this}});function resizeCanvasIfNeeded(o){var t=o.targetCanvas,e=t.width,i=t.height,r=o.destinationWidth,n=o.destinationHeight;(e!==r||i!==n)&&(t.width=r,t.height=n)}function copyGLTo2DDrawImage(o,t){var e=o.canvas,i=t.targetCanvas,r=i.getContext("2d");r.translate(0,i.height),r.scale(1,-1);var n=e.height-i.height;r.drawImage(e,0,n,i.width,i.height,0,0,i.width,i.height)}function copyGLTo2DPutImageData(l,t){var e=t.targetCanvas,i=e.getContext("2d"),r=t.destinationWidth,n=t.destinationHeight,s=4*(r*n),o=new Uint8Array(this.imageBuffer,0,s),a=new Uint8ClampedArray(this.imageBuffer,0,s);l.readPixels(0,0,r,n,l.RGBA,l.UNSIGNED_BYTE,o);var c=new ImageData(a,r,n);i.putImageData(c,0,0)}!function(){"use strict";function n(o,n){var e=o.createShader(o.FRAGMENT_SHADER);return o.shaderSource(e,"precision "+n+" float;\nvoid main(){}"),o.compileShader(e),!!o.getShaderParameter(e,o.COMPILE_STATUS)}function t(e){e&&e.tileSize&&(this.tileSize=e.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}fabric.isWebglSupported=function(t){if(fabric.isLikelyNode)return!1;t=t||fabric.WebglFilterBackend.prototype.tileSize;var e=document.createElement("canvas"),i=e.getContext("webgl")||e.getContext("experimental-webgl"),r=!1;if(i){fabric.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),r=fabric.maxTextureSize>=t;for(var a=["highp","mediump","lowp"],s=0;3>s;s++)if(n(i,a[s])){fabric.webGlPrecision=a[s];break}}return this.isSupported=r,r},fabric.WebglFilterBackend=t,t.prototype={tileSize:2048,resources:{},setupGLContext:function(r,t){this.dispose(),this.createWebGLCanvas(r,t),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(r,t)},chooseFastestCopyGLTo2DMethod:function(n,d){var g,i="undefined"!=typeof window.performance;try{new ImageData(1,1),g=!0}catch(e){g=!1}var r="undefined"!=typeof ArrayBuffer,s="undefined"!=typeof Uint8ClampedArray;if(i&&g&&r&&s){var o,a,c,p=fabric.util.createCanvasElement(),h=new ArrayBuffer(4*(n*d)),m={imageBuffer:h,destinationWidth:n,destinationHeight:d,targetCanvas:p};p.width=n,p.height=d,o=window.performance.now(),copyGLTo2DDrawImage.call(m,this.gl,m),a=window.performance.now()-o,o=window.performance.now(),copyGLTo2DPutImageData.call(m,this.gl,m),c=window.performance.now()-o,a>c?(this.imageBuffer=h,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(o,t){var e=fabric.util.createCanvasElement();e.width=o,e.height=t;var i={premultipliedAlpha:!1},r=e.getContext("webgl",i);r||(r=e.getContext("experimental-webgl",i)),r&&(r.clearColor(0,0,0,0),this.canvas=e,this.gl=r)},applyFilters:function(l,t,e,d,u,g){var s,p=this.gl;g&&(s=this.getCachedTexture(g,t));var f={originalWidth:t.width||t.originalWidth,originalHeight:t.height||t.originalHeight,sourceWidth:e,sourceHeight:d,destinationWidth:e,destinationHeight:d,context:p,sourceTexture:this.createTexture(p,e,d,!s&&t),targetTexture:this.createTexture(p,e,d),originalTexture:s||this.createTexture(p,e,d,!s&&t),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:u},c=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,c),l.forEach(function(e){e&&e.applyTo(f)}),resizeCanvasIfNeeded(f),this.copyGLTo2D(p,f),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(f.sourceTexture),p.deleteTexture(f.targetTexture),p.deleteFramebuffer(c),u.getContext("2d").setTransform(1,0,0,1,0,0),f},applyFiltersDebug:function(d,t,e,i,r,n){var s=this.gl,o=this.applyFilters(d,t,e,i,r,n),a=s.getError();if(a!==s.NO_ERROR){var c=this.glErrorToString(s,a),u=new Error("WebGL Error "+c);throw u.glErrorCode=a,u}return o},glErrorToString:function(r,o){if(!r)return"Context undefined for error code: "+o;if("number"!=typeof o)return"Error code is not a number";return o===r.NO_ERROR?"NO_ERROR":o===r.INVALID_ENUM?"INVALID_ENUM":o===r.INVALID_VALUE?"INVALID_VALUE":o===r.INVALID_OPERATION?"INVALID_OPERATION":o===r.INVALID_FRAMEBUFFER_OPERATION?"INVALID_FRAMEBUFFER_OPERATION":o===r.OUT_OF_MEMORY?"OUT_OF_MEMORY":o===r.CONTEXT_LOST_WEBGL?"CONTEXT_LOST_WEBGL":"UNKNOWN_ERROR"},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(o,t,e,i){var r=o.createTexture();return o.bindTexture(o.TEXTURE_2D,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),i?o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,i):o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,e,0,o.RGBA,o.UNSIGNED_BYTE,null),r},getCachedTexture:function(r,t){if(this.textureCache[r])return this.textureCache[r];var e=this.createTexture(this.gl,t.width,t.height,t);return this.textureCache[r]=e,e},evictCachesForKey:function(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var o=this.gl,t=o.getExtension("WEBGL_debug_renderer_info"),e={renderer:"",vendor:""};if(t){var i=o.getParameter(t.UNMASKED_RENDERER_WEBGL),r=o.getParameter(t.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),r&&(e.vendor=r.toLowerCase())}return this.gpuInfo=e,e}}}(),!function(){"use strict";function r(){}var t=function(){};fabric.Canvas2dFilterBackend=r,r.prototype={evictCachesForKey:t,dispose:t,clearWebGLCaches:t,resources:{},applyFilters:function(l,t,d,u,g){var p=g.getContext("2d");p.drawImage(t,0,0,d,u);var h=p.getImageData(0,0,d,u),f=p.getImageData(0,0,d,u),m={sourceWidth:d,sourceHeight:u,imageData:h,originalEl:t,originalImageData:f,canvasEl:g,ctx:p,filterBackend:this};return l.forEach(function(e){e.applyTo(m)}),(m.imageData.width!==d||m.imageData.height!==u)&&(g.width=m.imageData.width,g.height=m.imageData.height),p.putImageData(m.imageData,0,0),m}}}(),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(r){for(var t in r)this[t]=r[t]},createProgram:function(l,t,e){t=t||this.fragmentSource,e=e||this.vertexSource,"highp"!==fabric.webGlPrecision&&(t=t.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var i=l.createShader(l.VERTEX_SHADER);if(l.shaderSource(i,e),l.compileShader(i),!l.getShaderParameter(i,l.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+l.getShaderInfoLog(i));var r=l.createShader(l.FRAGMENT_SHADER);if(l.shaderSource(r,t),l.compileShader(r),!l.getShaderParameter(r,l.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+l.getShaderInfoLog(r));var n=l.createProgram();if(l.attachShader(n,i),l.attachShader(n,r),l.linkProgram(n),!l.getProgramParameter(n,l.LINK_STATUS))throw new Error("Shader link error for \"${this.type}\" "+l.getProgramInfoLog(n));var c=this.getAttributeLocations(l,n),d=this.getUniformLocations(l,n)||{};return d.uStepW=l.getUniformLocation(n,"uStepW"),d.uStepH=l.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:c,uniformLocations:d}},getAttributeLocations:function(r,t){return{aPosition:r.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(o,t,e){var i=t.aPostion,r=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,r),o.enableVertexAttribArray(i),o.vertexAttribPointer(i,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW)},_setupFrameBuffer:function(o){var t,e,n=o.context;1<o.passes?(t=o.destinationWidth,e=o.destinationHeight,(o.sourceWidth!==t||o.sourceHeight!==e)&&(n.deleteTexture(o.targetTexture),o.targetTexture=o.filterBackend.createTexture(n,t,e)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(r){r.passes--,r.pass++;var t=r.targetTexture;r.targetTexture=r.sourceTexture,r.sourceTexture=t},isNeutralState:function(){return!1},applyTo:function(e){if(e.webgl){if(1<e.passes&&this.isNeutralState(e))return;this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)}else this.isNeutralState()||this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(r){var t=r.context,e=this.retrieveShader(r);0===r.pass&&r.originalTexture?t.bindTexture(t.TEXTURE_2D,r.originalTexture):t.bindTexture(t.TEXTURE_2D,r.sourceTexture),t.useProgram(e.program),this.sendAttributeData(t,e.attributeLocations,r.aPosition),t.uniform1f(e.uniformLocations.uStepW,1/r.sourceWidth),t.uniform1f(e.uniformLocations.uStepH,1/r.sourceHeight),this.sendUniformData(t,e.uniformLocations),t.viewport(0,0,r.destinationWidth,r.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(r,t,e){r.activeTexture(e),r.bindTexture(r.TEXTURE_2D,t),r.activeTexture(r.TEXTURE0)},unbindAdditionalTexture:function(r,t){r.activeTexture(t),r.bindTexture(r.TEXTURE_2D,null),r.activeTexture(r.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(r){if(!r.helpLayer){var t=document.createElement("canvas");t.width=r.sourceWidth,t.height=r.sourceHeight,r.helpLayer=t}},toObject:function(){var r={type:this.type},t=this.mainParameter;return t&&(r[t]=this[t]),r},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(r,t){var e=new fabric.Image.filters[r.type](r);return t&&t(e),e},!function(o){"use strict";var t=o.fabric||(o.fabric={}),n=t.Image.filters,e=t.util.createClass;n.ColorMatrix=e(n.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},isNeutralState:function(){for(var r=n.ColorMatrix,t=20;t--;)if(this.matrix[t]!==r.prototype.matrix[t])return!1;return!0},applyTo2d:function(d){var t,e,i,r,n,s=d.imageData,o=s.data,a=o.length,c=this.matrix,u=this.colorsOnly;for(n=0;a>n;n+=4)t=o[n],e=o[n+1],i=o[n+2],u?(o[n]=t*c[0]+e*c[1]+i*c[2]+255*c[4],o[n+1]=t*c[5]+e*c[6]+i*c[7]+255*c[9],o[n+2]=t*c[10]+e*c[11]+i*c[12]+255*c[14]):(r=o[n+3],o[n]=t*c[0]+e*c[1]+i*c[2]+r*c[3]+255*c[4],o[n+1]=t*c[5]+e*c[6]+i*c[7]+r*c[8]+255*c[9],o[n+2]=t*c[10]+e*c[11]+i*c[12]+r*c[13]+255*c[14],o[n+3]=t*c[15]+e*c[16]+i*c[17]+r*c[18]+255*c[19])},getUniformLocations:function(r,t){return{uColorMatrix:r.getUniformLocation(t,"uColorMatrix"),uConstants:r.getUniformLocation(t,"uConstants")}},sendUniformData:function(o,t){var e=this.matrix,i=[e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18]],r=[e[4],e[9],e[14],e[19]];o.uniformMatrix4fv(t.uColorMatrix,!1,i),o.uniform4fv(t.uConstants,r)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=o.fabric||(o.fabric={}),e=t.Image.filters,n=t.util.createClass;e.Brightness=n(e.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(o){if(0!==this.brightness){var t,e=o.imageData,i=e.data,r=i.length,n=Math.round(255*this.brightness);for(t=0;r>t;t+=4)i[t]+=n,i[t+1]=i[t+1]+n,i[t+2]=i[t+2]+n}},getUniformLocations:function(r,t){return{uBrightness:r.getUniformLocation(t,"uBrightness")}},sendUniformData:function(r,t){r.uniform1f(t.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var S=Math.sqrt,t=o.fabric||(o.fabric={}),e=t.util.object.extend,i=t.Image.filters,r=t.util.createClass;i.Convolute=r(i.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(o){var t=S(this.matrix.length),e=this.type+"_"+t+"_"+(this.opaque?1:0),n=this.fragmentSource[e];return o.programCache.hasOwnProperty(e)||(o.programCache[e]=this.createProgram(o.context,n)),o.programCache[e]},applyTo2d:function(T){var t,e,i,r,n,s,o,a,c,h,l,u,f,d=T.imageData,g=d.data,p=this.matrix,v=Math.round(S(p.length)),b=Math.floor(v/2),m=d.width,y=d.height,_=T.ctx.createImageData(m,y),C=_.data,w=this.opaque?1:0;for(l=0;y>l;l++)for(h=0;m>h;h++){for(n=4*(l*m+h),t=0,e=0,i=0,r=0,f=0;v>f;f++)for(u=0;v>u;u++)o=l+f-b,s=h+u-b,0>o||o>y||0>s||s>m||(a=4*(o*m+s),c=p[f*v+u],t+=g[a]*c,e+=g[a+1]*c,i+=g[a+2]*c,w||(r+=g[a+3]*c));C[n]=t,C[n+1]=e,C[n+2]=i,C[n+3]=w?g[n+3]:r}T.imageData=_},getUniformLocations:function(r,t){return{uMatrix:r.getUniformLocation(t,"uMatrix"),uOpaque:r.getUniformLocation(t,"uOpaque"),uHalfSize:r.getUniformLocation(t,"uHalfSize"),uSize:r.getUniformLocation(t,"uSize")}},sendUniformData:function(r,t){r.uniform1fv(t.uMatrix,this.matrix)},toObject:function(){return e(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=o.fabric||(o.fabric={}),e=t.Image.filters,n=t.util.createClass;e.Grayscale=n(e.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(a){var t,e,i=a.imageData,r=i.data,n=r.length,s=this.mode;for(t=0;n>t;t+=4)"average"===s?e=(r[t]+r[t+1]+r[t+2])/3:"lightness"===s?e=(Math.min(r[t],r[t+1],r[t+2])+Math.max(r[t],r[t+1],r[t+2]))/2:"luminosity"===s&&(e=.21*r[t]+.72*r[t+1]+.07*r[t+2]),r[t]=e,r[t+1]=e,r[t+2]=e},retrieveShader:function(r){var t=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(t)){var e=this.fragmentSource[this.mode];r.programCache[t]=this.createProgram(r.context,e)}return r.programCache[t]},getUniformLocations:function(r,t){return{uMode:r.getUniformLocation(t,"uMode")}},sendUniformData:function(r,t){r.uniform1i(t.uMode,1)}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=o.fabric||(o.fabric={}),e=t.Image.filters,n=t.util.createClass;e.Invert=n(e.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(o){if(this.invert){var t,e=o.imageData,i=e.data,r=i.length;for(t=0;r>t;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2]}},getUniformLocations:function(r,t){return{uInvert:r.getUniformLocation(t,"uInvert")}},sendUniformData:function(r,t){r.uniform1i(t.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=o.fabric||(o.fabric={}),e=t.util.object.extend,i=t.Image.filters,r=t.util.createClass;i.Noise=r(i.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(a){if(0!==this.noise){var t,e,i=a.imageData,r=i.data,n=r.length,s=this.noise;for(t=0,n=r.length;n>t;t+=4)e=(.5-Math.random())*s,r[t]+=e,r[t+1]+=e,r[t+2]+=e}},getUniformLocations:function(r,t){return{uNoise:r.getUniformLocation(t,"uNoise"),uSeed:r.getUniformLocation(t,"uSeed")}},sendUniformData:function(r,t){r.uniform1f(t.uNoise,this.noise/255),r.uniform1f(t.uSeed,Math.random())},toObject:function(){return e(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=Math.min,n=o.fabric||(o.fabric={}),e=n.Image.filters,i=n.util.createClass;e.Pixelate=i(e.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(m){if(1!==this.blocksize){var _,e,i,r,n,s,o,a,c,h,l,u=m.imageData,f=u.data,d=u.height,g=u.width;for(e=0;d>e;e+=this.blocksize)for(i=0;g>i;i+=this.blocksize)for(_=4*e*g+4*i,r=f[_],n=f[_+1],s=f[_+2],o=f[_+3],h=t(e+this.blocksize,d),l=t(i+this.blocksize,g),a=e;h>a;a++)for(c=i;l>c;c++)_=4*a*g+4*c,f[_]=r,f[_+1]=n,f[_+2]=s,f[_+3]=o}},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(r,t){return{uBlocksize:r.getUniformLocation(t,"uBlocksize"),uStepW:r.getUniformLocation(t,"uStepW"),uStepH:r.getUniformLocation(t,"uStepH")}},sendUniformData:function(r,t){r.uniform1f(t.uBlocksize,this.blocksize)}}),n.Image.filters.Pixelate.fromObject=n.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var d=o.fabric||(o.fabric={}),e=d.util.object.extend,t=d.Image.filters,r=d.util.createClass;t.RemoveColor=r(t.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(e){var t,i,r,n,s=e.imageData,o=s.data,a=255*this.distance,c=new d.Color(this.color).getSource(),g=[c[0]-a,c[1]-a,c[2]-a],l=[c[0]+a,c[1]+a,c[2]+a];for(t=0;t<o.length;t+=4)i=o[t],r=o[t+1],n=o[t+2],i>g[0]&&r>g[1]&&n>g[2]&&i<l[0]&&r<l[1]&&n<l[2]&&(o[t+3]=0)},getUniformLocations:function(r,t){return{uLow:r.getUniformLocation(t,"uLow"),uHigh:r.getUniformLocation(t,"uHigh")}},sendUniformData:function(e,t){var i=new d.Color(this.color).getSource(),r=parseFloat(this.distance),n=[0+i[0]/255-r,0+i[1]/255-r,0+i[2]/255-r,1],a=[i[0]/255+r,i[1]/255+r,i[2]/255+r,1];e.uniform4fv(t.uLow,n),e.uniform4fv(t.uHigh,a)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),d.Image.filters.RemoveColor.fromObject=d.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=o.fabric||(o.fabric={}),e=t.Image.filters,i=t.util.createClass,r={Brownie:[0.5997,0.34553,-0.27082,0,0.186,-0.0377,0.86095,0.15059,0,-0.1449,0.24113,-0.07441,0.44972,0,-0.02965,0,0,0,1,0],Vintage:[0.62793,0.32021,-0.03965,0,0.03784,0.02578,0.64411,0.03259,0,0.02926,0.0466,-0.08512,0.52416,0,0.02023,0,0,0,1,0],Kodachrome:[1.12855,-0.39673,-0.03992,0,0.24991,-0.16404,1.08352,-0.05498,0,0.09698,-0.16786,-0.56034,1.60148,0,0.13972,0,0,0,1,0],Technicolor:[1.91252,-0.85453,-0.09155,0,0.04624,-0.30878,1.76589,-0.10601,0,-0.27589,-0.2311,-0.75018,1.84759,0,0.12137,0,0,0,1,0],Polaroid:[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0],Sepia:[0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in r)e[n]=i(e.ColorMatrix,{type:n,matrix:r[n],mainParameter:!1,colorsOnly:!0}),t.Image.filters[n].fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=Math.max,c=Math.min,u=Math.abs,g=o.fabric,e=g.Image.filters,n=g.util.createClass;e.BlendColor=n(e.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb *= uColor.rgb;\ngl_FragColor = color;\n}",screen:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb = 1.0 - (1.0 - color.rgb) * (1.0 - uColor.rgb);\ngl_FragColor = color;\n}",add:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb += uColor.rgb;\n}",diff:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n}",subtract:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb -= uColor.rgb;\n}",lighten:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n}",darken:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n}",exclusion:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n}",overlay:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n}",tint:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\ngl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n}"},retrieveShader:function(r){var t=this.type+"_"+this.mode,e=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(t)||(r.programCache[t]=this.createProgram(r.context,e)),r.programCache[t]},applyTo2d:function(e){var p,i,r,n,o,s,a,m=e.imageData,h=m.data,l=h.length,_=1-this.alpha;a=new g.Color(this.color).getSource(),p=a[0]*this.alpha,i=a[1]*this.alpha,r=a[2]*this.alpha;for(var f=0;l>f;f+=4)switch(n=h[f],o=h[f+1],s=h[f+2],this.mode){case"multiply":h[f]=n*p/255,h[f+1]=o*i/255,h[f+2]=s*r/255;break;case"screen":h[f]=255-(255-n)*(255-p)/255,h[f+1]=255-(255-o)*(255-i)/255,h[f+2]=255-(255-s)*(255-r)/255;break;case"add":h[f]=n+p,h[f+1]=o+i,h[f+2]=s+r;break;case"diff":case"difference":h[f]=u(n-p),h[f+1]=u(o-i),h[f+2]=u(s-r);break;case"subtract":h[f]=n-p,h[f+1]=o-i,h[f+2]=s-r;break;case"darken":h[f]=c(n,p),h[f+1]=c(o,i),h[f+2]=c(s,r);break;case"lighten":h[f]=t(n,p),h[f+1]=t(o,i),h[f+2]=t(s,r);break;case"overlay":h[f]=128>p?2*n*p/255:255-2*(255-n)*(255-p)/255,h[f+1]=128>i?2*o*i/255:255-2*(255-o)*(255-i)/255,h[f+2]=128>r?2*s*r/255:255-2*(255-s)*(255-r)/255;break;case"exclusion":h[f]=p+n-2*p*n/255,h[f+1]=i+o-2*i*o/255,h[f+2]=r+s-2*r*s/255;break;case"tint":h[f]=p+n*_,h[f+1]=i+o*_,h[f+2]=r+s*_;}},getUniformLocations:function(r,t){return{uColor:r.getUniformLocation(t,"uColor")}},sendUniformData:function(e,t){var o=new g.Color(this.color).getSource();o[0]=this.alpha*o[0]/255,o[1]=this.alpha*o[1]/255,o[2]=this.alpha*o[2]/255,o[3]=this.alpha,e.uniform4fv(t.uColor,o)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),g.Image.filters.BlendColor.fromObject=g.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(d){"use strict";var u=Math.round,g=Math.ceil,_=d.fabric||(d.fabric={}),t=Math.pow,L=Math.floor,r=Math.sqrt,n=Math.abs,p=u,o=Math.sin,i=g,e=_.Image.filters,a=_.util.createClass;e.Resize=a(e.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,getUniformLocations:function(r,t){return{uDelta:r.getUniformLocation(t,"uDelta"),uTaps:r.getUniformLocation(t,"uTaps")}},sendUniformData:function(r,t){r.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),r.uniform1fv(t.uTaps,this.taps)},retrieveShader:function(o){var t=this.getFilterWindow(),e=this.type+"_"+t;if(!o.programCache.hasOwnProperty(e)){var n=this.generateShader(t);o.programCache[e]=this.createProgram(o.context,n)}return o.programCache[e]},getFilterWindow:function(){var e=this.tempScale;return g(this.lanczosLobes/e)},getTaps:function(){for(var o=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,e=this.getFilterWindow(),i=Array(e),r=1;e>=r;r++)i[r-1]=o(r*t);return i},generateShader:function(o){for(var o,t=Array(o),n=this.fragmentSourceTOP,e=1;o>=e;e++)t[e-1]=e+".0 * uDelta";return n+="uniform float uTaps["+o+"];\n",n+="void main() {\n",n+="  vec4 color = texture2D(uTexture, vTexCoord);\n",n+="  float sum = 1.0;\n",t.forEach(function(r,t){n+="  color += texture2D(uTexture, vTexCoord + "+r+") * uTaps["+t+"];\n",n+="  color += texture2D(uTexture, vTexCoord - "+r+") * uTaps["+t+"];\n",n+="  sum += 2.0 * uTaps["+t+"];\n"}),n+="  gl_FragColor = color / sum;\n",n+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(e){if(e.webgl){if(1<e.passes&&this.isNeutralState(e))return;e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=u(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=u(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceHeight=e.destinationHeight}else this.isNeutralState(e)||this.applyTo2d(e)},isNeutralState:function(r){var t=r.scaleX||this.scaleX,e=r.scaleY||this.scaleY;return 1===t&&1===e},lanczosCreate:function(r){return function(n){if(n>=r||-r>=n)return 0;if(1.1920929e-7>n&&-1.1920929e-7<n)return 1;n*=Math.PI;var e=n/r;return o(n)/n*o(e)/e}},applyTo2d:function(s){var t=s.imageData,e=this.scaleX,i=this.scaleY;this.rcpScaleX=1/e,this.rcpScaleY=1/i;var r,n=t.width,o=t.height,a=p(n*e),l=p(o*i);"sliceHack"===this.resizeType?r=this.sliceByTwo(s,n,o,a,l):"hermite"===this.resizeType?r=this.hermiteFastResize(s,n,o,a,l):"bilinear"===this.resizeType?r=this.bilinearFiltering(s,n,o,a,l):"lanczos"===this.resizeType&&(r=this.lanczosResize(s,n,o,a,l)),s.imageData=r},sliceByTwo:function(e,t,r,n,o){var i,a,s=e.imageData,c=.5,l=!1,h=!1,x=t*c,d=r*c,g=_.filterBackend.resources,p=0,v=0,C=t,m=0;for(g.sliceByTwo||(g.sliceByTwo=document.createElement("canvas")),i=g.sliceByTwo,(i.width<1.5*t||i.height<r)&&(i.width=1.5*t,i.height=r),a=i.getContext("2d"),a.clearRect(0,0,1.5*t,r),a.putImageData(s,0,0),n=L(n),o=L(o);!l||!h;)t=x,r=d,n<L(x*c)?x=L(x*c):(x=n,l=!0),o<L(d*c)?d=L(d*c):(d=o,h=!0),a.drawImage(i,p,v,t,r,C,m,x,d),p=C,v=m,m+=d;return a.getImageData(p,v,n,o)},lanczosResize:function(o,I,e,s,a){function h(o){var i,x,w,O,S,k,T,P,E,D,j;for(C.x=(o+.5)*d,b.x=L(C.x),i=0;a>i;i++){for(C.y=(i+.5)*g,b.y=L(C.y),S=0,k=0,T=0,P=0,E=0,x=b.x-m;x<=b.x+m;x++)if(!(0>x||x>=I)){D=L(1e3*n(x-C.x)),_[D]||(_[D]={});for(var F=b.y-y;F<=b.y+y;F++)0>F||F>=e||(j=L(1e3*n(F-C.y)),_[D][j]||(_[D][j]=c(r(t(D*p,2)+t(j*v,2))/1e3)),w=_[D][j],0<w&&(O=4*(F*I+x),S+=w,k+=w*l[O],T+=w*l[O+1],P+=w*l[O+2],E+=w*l[O+3]))}O=4*(i*s+o),f[O]=k/S,f[O+1]=T/S,f[O+2]=P/S,f[O+3]=E/S}return++o<s?h(o):u}var l=o.imageData.data,u=o.ctx.createImageData(s,a),f=u.data,c=this.lanczosCreate(this.lanczosLobes),d=this.rcpScaleX,g=this.rcpScaleY,p=2/this.rcpScaleX,v=2/this.rcpScaleY,m=i(d*this.lanczosLobes/2),y=i(g*this.lanczosLobes/2),_={},C={},b={};return h(0)},bilinearFiltering:function(r,t,e,i,n){var o,s,a,c,h,l,u,f,d,g,p,v,b,m=0,y=this.rcpScaleX,_=this.rcpScaleY,C=4*(t-1),T=r.imageData,x=T.data,w=r.ctx.createImageData(i,n),O=w.data;for(u=0;n>u;u++)for(f=0;i>f;f++)for(h=L(y*f),l=L(_*u),d=y*f-h,g=_*u-l,b=4*(l*t+h),p=0;4>p;p++)o=x[b+p],s=x[b+4+p],a=x[b+C+p],c=x[b+C+4+p],v=o*(1-d)*(1-g)+s*d*(1-g)+a*g*(1-d)+c*d*g,O[m++]=v;return w},hermiteFastResize:function(o,t,e,c,s){for(var a=this.rcpScaleX,h=this.rcpScaleY,l=i(a/2),u=i(h/2),f=o.imageData,d=f.data,g=o.ctx.createImageData(c,s),p=g.data,v=0;s>v;v++)for(var b=0;c>b;b++){for(var m=4*(b+v*c),y=0,_=0,C=0,w=0,x=0,O=0,D=0,S=(v+.5)*h,k=L(v*h);(v+1)*h>k;k++)for(var T=n(S-(k+.5))/u,P=(b+.5)*a,E=L(b*a);(b+1)*a>E;E++){var j=n(P-(E+.5))/l,F=r(T*T+j*j);1<F&&-1>F||(y=2*F*F*F-3*F*F+1,0<y&&(j=4*(E+k*t),D+=y*d[j+3],C+=y,255>d[j+3]&&(y=y*d[j+3]/250),w+=y*d[j],x+=y*d[j+1],O+=y*d[j+2],_+=y))}p[m]=w/_,p[m+1]=x/_,p[m+2]=O/_,p[m+3]=D/C}return g},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),_.Image.filters.Resize.fromObject=_.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=o.fabric||(o.fabric={}),e=t.Image.filters,n=t.util.createClass;e.Contrast=n(e.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(a){if(0!==this.contrast){var t,e,i=a.imageData,r=i.data,e=r.length,n=Math.floor(255*this.contrast),s=259*(n+255)/(255*(259-n));for(t=0;e>t;t+=4)r[t]=s*(r[t]-128)+128,r[t+1]=s*(r[t+1]-128)+128,r[t+2]=s*(r[t+2]-128)+128}},getUniformLocations:function(r,t){return{uContrast:r.getUniformLocation(t,"uContrast")}},sendUniformData:function(r,t){r.uniform1f(t.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=o.fabric||(o.fabric={}),e=t.Image.filters,n=t.util.createClass;e.Saturation=n(e.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(a){if(0!==this.saturation){var t,e,i=a.imageData,r=i.data,n=r.length,o=-this.saturation;for(t=0;n>t;t+=4)e=Math.max(r[t],r[t+1],r[t+2]),r[t]+=e===r[t]?0:(e-r[t])*o,r[t+1]+=e===r[t+1]?0:(e-r[t+1])*o,r[t+2]+=e===r[t+2]?0:(e-r[t+2])*o}},getUniformLocations:function(r,t){return{uSaturation:r.getUniformLocation(t,"uSaturation")}},sendUniformData:function(r,t){r.uniform1f(t.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var g=Math.abs,t=o.fabric||(o.fabric={}),e=t.Image.filters,n=t.util.createClass;e.Blur=n(e.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(p){var t,e,i=p.filterBackend.resources,r=p.imageData.width,n=p.imageData.height;i.blurLayer1||(i.blurLayer1=document.createElement("canvas"),i.blurLayer2=document.createElement("canvas")),t=i.blurLayer1,e=i.blurLayer2,(t.width!==r||t.height!==n)&&(e.width=t.width=r,e.height=t.height=n);var o,s,a,c,h=t.getContext("2d"),l=e.getContext("2d"),u=15,m=.5*(.06*this.blur);for(h.putImageData(p.imageData,0,0),l.clearRect(0,0,r,n),c=-u;u>=c;c++)o=(Math.random()-.5)/4,s=c/u,a=m*s*r+o,l.globalAlpha=1-g(s),l.drawImage(t,a,o),h.drawImage(e,0,0),l.globalAlpha=1,l.clearRect(0,0,e.width,e.height);for(c=-u;u>=c;c++)o=(Math.random()-.5)/4,s=c/u,a=m*s*n+o,l.globalAlpha=1-g(s),l.drawImage(t,o,a),h.drawImage(e,0,0),l.globalAlpha=1,l.clearRect(0,0,e.width,e.height);p.ctx.drawImage(t,0,0);var d=p.ctx.getImageData(0,0,t.width,t.height);return h.globalAlpha=1,h.clearRect(0,0,t.width,t.height),d},getUniformLocations:function(r,t){return{delta:r.getUniformLocation(t,"uDelta")}},sendUniformData:function(r,t){var e=this.chooseRightDelta();r.uniform2fv(t.delta,e)},chooseRightDelta:function(){var r,t=1,e=[0,0];return this.horizontal?1<this.aspectRatio&&(t=1/this.aspectRatio):1>this.aspectRatio&&(t=this.aspectRatio),r=.12*(t*this.blur),this.horizontal?e[0]=r:e[1]=r,e}}),e.Blur.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var t=Math.pow,n=o.fabric||(o.fabric={}),e=n.Image.filters,i=n.util.createClass;e.Gamma=i(e.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",applyTo2d:function(l){var d,e=l.imageData,i=e.data,r=this.gamma,n=i.length,o=1/r[0],s=1/r[1],a=1/r[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),d=0,n=256;n>d;d++)this.rVals[d]=255*t(d/255,o),this.gVals[d]=255*t(d/255,s),this.bVals[d]=255*t(d/255,a);for(d=0,n=i.length;n>d;d+=4)i[d]=this.rVals[i[d]],i[d+1]=this.gVals[i[d+1]],i[d+2]=this.bVals[i[d+2]]},getUniformLocations:function(r,t){return{uGamma:r.getUniformLocation(t,"uGamma")}},sendUniformData:function(r,t){r.uniform3fv(t.uGamma,this.gamma)}}),n.Image.filters.Gamma.fromObject=n.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(o){"use strict";var a=o.fabric||(o.fabric={}),e=a.Image.filters,t=a.util.createClass;e.Composed=t(e.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(t){t.applyTo(r)})},toObject:function(){return a.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(e){return e.toObject()})})}}),a.Image.filters.Composed.fromObject=function(e,t){var i=e.subFilters||[],r=i.map(function(e){return new a.Image.filters[e.type](e)}),s=new a.Image.filters.Composed({subFilters:r});return t&&t(s),s}}("undefined"==typeof exports?this:exports),!function(o){"use strict";var n=o.fabric||(o.fabric={}),e=n.Image.filters,t=n.util.createClass;e.HueRotation=t(e.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var a=this.rotation*Math.PI,t=Math.cos(a),e=Math.sin(a),i=1/3,r=0.5773502691896257*e,n=1-t;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=t+n/3,this.matrix[1]=i*n-r,this.matrix[2]=i*n+r,this.matrix[5]=i*n+r,this.matrix[6]=t+i*n,this.matrix[7]=i*n-r,this.matrix[10]=i*n-r,this.matrix[11]=i*n+r,this.matrix[12]=t+i*n},applyTo:function(e){this.calculateMatrix(),n.Image.filters.BaseFilter.prototype.applyTo.call(this,e)}}),n.Image.filters.HueRotation.fromObject=n.Image.filters.BaseFilter.fromObject}("undefined"==typeof exports?this:exports),!function(r){"use strict";var a=r.fabric||(r.fabric={}),o=a.util.object.clone,m=200;return a.Text?void a.warn("fabric.Text is already defined"):(a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stateProperties:a.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:a.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","textBackgroundColor"],__charBounds:[],initialize:function(r,t){this.styles=t?t.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",t),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return a._measuringContext||(a._measuringContext=this.canvas&&this.canvas.contextCache||a.util.createCanvasElement().getContext("2d")),a._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||2,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var d,t,e,i,r,n,s,o=0,a=this._textLines.length;a>o;o++)if(("justify"===this.textAlign||o!==a-1&&!this.isEndOfWrapping(o))&&(i=0,r=this._textLines[o],t=this.getLineWidth(o),t<this.width&&(s=this.textLines[o].match(this._reSpacesAndTabs)))){e=s.length,d=(this.width-t)/e;for(var c=0,u=r.length;u>=c;c++)n=this.__charBounds[o][c],this._reSpaceAndTab.test(r[c])?(n.width+=d,n.kernedWidth+=d,n.left+=i,i+=d):n.left+=i}},isEndOfWrapping:function(e){return e===this._textLines.length-1},toString:function(){return"#<fabric.Text ("+this.complexity()+"): { \"text\": \""+this.text+"\", \"fontFamily\": \""+this.fontFamily+"\" }>"},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return r.width+=t*r.zoomX,r.height+=t*r.zoomY,r},_render:function(e){this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){"stroke"===this.paintFirst?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(r,t,e){r.textBaseline="alphabetic",r.font=this._getFontDeclaration(t,e)},calcTextWidth:function(){for(var o,r=this.getLineWidth(0),t=1,e=this._textLines.length;e>t;t++)o=this.getLineWidth(t),o>r&&(r=o);return r},_renderTextLine:function(o,t,e,i,r,n){this._renderChars(o,t,e,i,r,n)},_renderTextLinesBackground:function(m){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var t,e,i,r,n,s,o=0,a=m.fillStyle,c=this._getLeftOffset(),h=this._getTopOffset(),l=0,u=0,f=0,d=this._textLines.length;d>f;f++)if(t=this.getHeightOfLine(f),this.textBackgroundColor||this.styleHas("textBackgroundColor",f)){i=this._textLines[f],e=this._getLineLeftOffset(f),u=0,l=0,r=this.getValueOfPropertyAt(f,0,"textBackgroundColor");for(var g=0,p=i.length;p>g;g++)n=this.__charBounds[f][g],s=this.getValueOfPropertyAt(f,g,"textBackgroundColor"),s===r?u+=n.kernedWidth:(m.fillStyle=r,r&&m.fillRect(c+e+l,h+o,u,t/this.lineHeight),l=n.left,u=n.width,r=s);s&&(m.fillStyle=s,m.fillRect(c+e+l,h+o,u,t/this.lineHeight)),o+=t}else o+=t;m.fillStyle=a,this._removeShadow(m)}},getFontCache:function(e){var t=e.fontFamily.toLowerCase();a.charWidthsCache[t]||(a.charWidthsCache[t]={});var o=a.charWidthsCache[t],r=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return o[r]||(o[r]={}),o[r]},_applyCharStyles:function(o,t,e,i,r){this._setFillStyles(t,r),this._setStrokeStyles(t,r),t.font=this._getFontDeclaration(r)},_measureChar:function(n,t,e,i){var r,_,y,x,c=this.getFontCache(t),h=this._getFontDeclaration(t),l=this._getFontDeclaration(i),u=e+n,f=h===l,d=t.fontSize/m;if(e&&c[e]&&(y=c[e]),c[n]&&(x=r=c[n]),f&&c[u]&&(_=c[u],x=_-y),!r||!y||!_){var g=this.getMeasuringContext();this._setTextStyles(g,t,!0)}if(r||(x=r=g.measureText(n).width,c[n]=r),!y&&f&&e&&(y=g.measureText(e).width,c[e]=y),f&&!_&&(_=g.measureText(u).width,c[u]=_,x=_-y,x>r)){var p=x-r;c[n]=x,c[u]+=p,r=x}return{width:r*d,kernedWidth:x*d}},getHeightOfChar:function(r,t){return this.getValueOfPropertyAt(r,t,"fontSize")},measureLine:function(r){var t=this._measureLine(r);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),0>t.width&&(t.width=0),t},_measureLine:function(a){var t,e,i,r,n=0,l=this._textLines[a],o=Array(l.length);for(this.__charBounds[a]=o,t=0;t<l.length;t++)e=l[t],r=this._getGraphemeBox(e,a,t,i),o[t]=r,n+=r.kernedWidth,i=e;return o[t]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:n,numOfSpaces:0}},_getGraphemeBox:function(d,t,e,i,r){var g=this.getCompleteStyleDeclaration(t,e),s=i?this.getCompleteStyleDeclaration(t,e-1):{},o=this._measureChar(d,g,i,s),a=o.kernedWidth,p=o.width;0!==this.charSpacing&&(p+=this._getWidthOfCharSpacing(),a+=this._getWidthOfCharSpacing());var f={width:p,left:0,height:g.fontSize,kernedWidth:a};if(0<e&&!r){var l=this.__charBounds[t][e-1];f.left=l.left+l.width+o.kernedWidth-o.width}return f},getHeightOfLine:function(o){if(this.__lineHeights[o])return this.__lineHeights[o];for(var t,a=this._textLines[o],e=this.getHeightOfChar(o,0),i=1,r=a.length;r>i;i++)t=this.getHeightOfChar(o,i),t>e&&(e=t);return this.__lineHeights[o]=e*this.lineHeight*this._fontSizeMult,this.__lineHeights[o]},calcTextHeight:function(){for(var o,t=0,e=0,n=this._textLines.length;n>e;e++)o=this.getHeightOfLine(e),t+=e===n-1?o/this.lineHeight:o;return t},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(d,t){d.save();for(var e=0,i=this._getLeftOffset(),r=this._getTopOffset(),n=this._applyPatternGradientTransform(d,"fillText"===t?this.fill:this.stroke),s=0,o=this._textLines.length;o>s;s++){var a=this.getHeightOfLine(s),c=a/this.lineHeight,u=this._getLineLeftOffset(s);this._renderTextLine(t,d,this._textLines[s],i+u-n.offsetX,r+e+c-n.offsetY,s),e+=a}d.restore()},_renderTextFill:function(e){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(m,t,e,i,r,n){var s,o,a,c,_=this.getHeightOfLine(n),l=-1!==this.textAlign.indexOf("justify"),u="",f=0;t.save(),r-=_*this._fontSizeFraction/this.lineHeight;for(var d=0,g=e.length-1;g>=d;d++)c=d===g||this.charSpacing,u+=e[d],a=this.__charBounds[n][d],0===f?(i+=a.kernedWidth-a.width,f+=a.width):f+=a.kernedWidth,l&&!c&&this._reSpaceAndTab.test(e[d])&&(c=!0),c||(s=s||this.getCompleteStyleDeclaration(n,d),o=this.getCompleteStyleDeclaration(n,d+1),c=this._hasStyleChanged(s,o)),c&&(this._renderChar(m,t,n,d,u,i,r,_),u="",s=o,i+=f,f=0);t.restore()},_renderChar:function(d,t,e,i,r,n,s){var o=this._getStyleDeclaration(e,i),a=this.getCompleteStyleDeclaration(e,i),c="fillText"===d&&a.fill,u="strokeText"===d&&a.stroke&&a.strokeWidth;(u||c)&&(o&&t.save(),this._applyCharStyles(d,t,e,i,a),o&&o.textBackgroundColor&&this._removeShadow(t),c&&t.fillText(r,n,s),u&&t.strokeText(r,n,s),o&&t.restore())},_hasStyleChanged:function(r,t){return r.fill!==t.fill||r.stroke!==t.stroke||r.strokeWidth!==t.strokeWidth||r.fontSize!==t.fontSize||r.fontFamily!==t.fontFamily||r.fontWeight!==t.fontWeight||r.fontStyle!==t.fontStyle},_hasStyleChangedForSvg:function(r,t){return this._hasStyleChanged(r,t)||r.overline!==t.overline||r.underline!==t.underline||r.linethrough!==t.linethrough},_getLineLeftOffset:function(r){var t=this.getLineWidth(r);return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:"justify-center"===this.textAlign&&this.isEndOfWrapping(r)?(this.width-t)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(r)?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(o){if(this.__lineWidths[o])return this.__lineWidths[o];var t,e,n=this._textLines[o];return""===n?t=0:(e=this.measureLine(o),t=e.width),this.__lineWidths[o]=t,t},_getWidthOfCharSpacing:function(){return 0===this.charSpacing?0:this.fontSize*this.charSpacing/1e3},getValueOfPropertyAt:function(o,t,e){var i=this._getStyleDeclaration(o,t),r=i&&"undefined"!=typeof i[e];return r?i[e]:this[e]},_renderTextDecoration:function(_,t){if(this[t]||this.styleHas(t)){for(var e,i,r,n,s,o,a,c,h,l,u,f=this._getLeftOffset(),d=this._getTopOffset(),g=0,p=this._textLines.length;p>g;g++)if(e=this.getHeightOfLine(g),this[t]||this.styleHas(t,g)){r=this._textLines[g],h=e/this.lineHeight,i=this._getLineLeftOffset(g),s=0,o=0,n=this.getValueOfPropertyAt(g,0,t),u=this.getValueOfPropertyAt(g,0,"fill");for(var y=0,v=r.length;v>y;y++)a=this.__charBounds[g][y],c=this.getValueOfPropertyAt(g,y,t),l=this.getValueOfPropertyAt(g,y,"fill"),(c!==n||l!==u)&&0<o?(_.fillStyle=u,n&&u&&_.fillRect(f+i+s,d+h*(1-this._fontSizeFraction)+this.offsets[t]*this.fontSize,o,this.fontSize/15),s=a.left,o=a.width,n=c,u=l):o+=a.kernedWidth;_.fillStyle=l,c&&l&&_.fillRect(f+i+s,d+h*(1-this._fontSizeFraction)+this.offsets[t]*this.fontSize,o,this.fontSize/15),d+=e}else d+=e;this._removeShadow(_)}},_getFontDeclaration:function(e,t){var o=e||this;return[a.isLikelyNode?o.fontWeight:o.fontStyle,a.isLikelyNode?o.fontStyle:o.fontWeight,t?m+"px":o.fontSize+"px",a.isLikelyNode?"\""+o.fontFamily+"\"":o.fontFamily].join(" ")},render:function(e){this.visible&&(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e))},_splitTextIntoLines:function(e){for(var t=e.split(this._reNewline),l=Array(t.length),c=["\n"],n=[],d=0;d<t.length;d++)l[d]=a.util.string.graphemeSplit(t[d]),n=n.concat(l[d],c);return n.pop(),{_unwrappedLines:l,lines:t,graphemeText:n,graphemeLines:l}},toObject:function(n){var t=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(n),e=this.callSuper("toObject",t);return e.styles=o(this.styles,!0),e},set:function(o,n){this.callSuper("set",o,n);var e=!1;if("object"==typeof o)for(var i in o)e=e||-1!==this._dimensionAffectingProps.indexOf(i);else e=-1!==this._dimensionAffectingProps.indexOf(o);return e&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),a.Text.fromObject=function(e,t){return a.Object._fromObject("Text",e,t,"text")},void(a.util.createAccessors&&a.util.createAccessors(a.Text)))}("undefined"==typeof exports?this:exports),!function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(o){if(!this.styles)return!0;if("undefined"!=typeof o&&!this.styles[o])return!0;var a="undefined"==typeof o?this.styles:{line:this.styles[o]};for(var e in a)for(var i in a[e])for(var r in a[e][i])return!1;return!0},styleHas:function(o,a){if(!this.styles||!o||""===o)return!1;if("undefined"!=typeof a&&!this.styles[a])return!1;var s="undefined"==typeof a?this.styles:{line:this.styles[a]};for(var i in s)for(var r in s[i])if("undefined"!=typeof s[i][r][o])return!0;return!1},cleanStyle:function(d){if(!this.styles||!d||""===d)return!1;var u,e,i=this.styles,r=0,n=!1,s=!0,o=0;for(var a in i){for(var c in u=0,i[a])r++,n?i[a][c][d]!==e&&(s=!1):(e=i[a][c][d],n=!0),i[a][c][d]===this[d]&&delete i[a][c][d],0===Object.keys(i[a][c]).length?delete i[a][c]:u++;0===u&&delete i[a]}for(var g=0;g<this._textLines.length;g++)o+=this._textLines[g].length;s&&r===o&&(this[d]=e,this.removeStyle(d))},removeStyle:function(o){if(this.styles&&o&&""!==o){var t,e,i,r=this.styles;for(e in r){for(i in t=r[e],t)delete t[i][o],0===Object.keys(t[i]).length&&delete t[i];0===Object.keys(t).length&&delete r[e]}}},_extendStyles:function(r,t){var e=this.get2DCursorLocation(r);this._getLineStyle(e.lineIndex)||this._setLineStyle(e.lineIndex,{}),this._getStyleDeclaration(e.lineIndex,e.charIndex)||this._setStyleDeclaration(e.lineIndex,e.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(e.lineIndex,e.charIndex),t)},get2DCursorLocation:function(o,a){"undefined"==typeof o&&(o=this.selectionStart);for(var e=a?this._unwrappedTextLines:this._textLines,i=e.length,r=0;i>r;r++){if(o<=e[r].length)return{lineIndex:r,charIndex:o};o-=e[r].length+1}return{lineIndex:r-1,charIndex:e[r-1].length<o?e[r-1].length:o}},getSelectionStyles:function(o,a,s){"undefined"==typeof o&&(o=this.selectionStart||0),"undefined"==typeof a&&(a=this.selectionEnd||o);for(var i=[],r=o;a>r;r++)i.push(this.getStyleAtPosition(r,s));return i},getStyleAtPosition:function(o,t){var e=this.get2DCursorLocation(o),n=t?this.getCompleteStyleDeclaration(e.lineIndex,e.charIndex):this._getStyleDeclaration(e.lineIndex,e.charIndex);return n||{}},setSelectionStyles:function(o,t,n){"undefined"==typeof t&&(t=this.selectionStart||0),"undefined"==typeof n&&(n=this.selectionEnd||t);for(var a=t;n>a;a++)this._extendStyles(a,o);return this._forceClearCache=!0,this},_getStyleDeclaration:function(r,t){var e=this.styles&&this.styles[r];return e?e[t]:null},getCompleteStyleDeclaration:function(o,t){for(var e,i=this._getStyleDeclaration(o,t)||{},r={},n=0;n<this._styleProperties.length;n++)e=this._styleProperties[n],r[e]="undefined"==typeof i[e]?this[e]:i[e];return r},_setStyleDeclaration:function(r,t,e){this.styles[r][t]=e},_deleteStyleDeclaration:function(r,t){delete this.styles[r][t]},_getLineStyle:function(e){return this.styles[e]},_setLineStyle:function(r,t){this.styles[r]=t},_deleteLineStyle:function(e){delete this.styles[e]}})}(),!function(){function o(e){e.textDecoration&&(-1<e.textDecoration.indexOf("underline")&&(e.underline=!0),-1<e.textDecoration.indexOf("line-through")&&(e.linethrough=!0),-1<e.textDecoration.indexOf("overline")&&(e.overline=!0),delete e.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(r,t){this.callSuper("initialize",r,t),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(r,t){this[r]!==t&&(this._fireSelectionChanged(),this[r]=t),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(r){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop,e=this.canvas.viewportTransform;t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),r||t.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas){var r,t=this._getCursorBoundaries();this.canvas&&this.canvas.contextTop?(r=this.canvas.contextTop,this.clearContextTop(!0)):(r=this.canvas.contextContainer,r.save()),this.selectionStart===this.selectionEnd?this.renderCursor(t,r):this.renderSelection(t,r),r.restore()}},_clearTextArea:function(r){var t=this.width+4,o=this.height+4;r.clearRect(-t/2,-o/2,t,o)},_getCursorBoundaries:function(o){"undefined"==typeof o&&(o=this.selectionStart);var n=this._getLeftOffset(),a=this._getTopOffset(),s=this._getCursorBoundariesOffsets(o);return{left:n,top:a,leftOffset:s.left,topOffset:s.top}},_getCursorBoundariesOffsets:function(l){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var t,e,i=0,r=0,n=0,d=0,s=this.get2DCursorLocation(l),a=0;a<s.lineIndex;a++)n+=this.getHeightOfLine(a);t=this._getLineLeftOffset(s.lineIndex);var c=this.__charBounds[s.lineIndex][s.charIndex];return c&&(d=c.left),0!==this.charSpacing&&r===this._textLines[i].length&&(d-=this._getWidthOfCharSpacing()),e={top:n,left:t+(0<d?d:0)},this.cursorOffsetCache=e,this.cursorOffsetCache},renderCursor:function(l,t){var e=this.get2DCursorLocation(),i=e.lineIndex,r=0<e.charIndex?e.charIndex-1:0,n=this.getValueOfPropertyAt(i,r,"fontSize"),o=this.scaleX*this.canvas.getZoom(),s=this.cursorWidth/o,a=l.topOffset;a+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-n*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(l,t),t.fillStyle=this.getValueOfPropertyAt(i,r,"fill"),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(l.left+l.leftOffset-s/2,a+l.top,s,n)},renderSelection:function(m,t){for(var e=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,i=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,r=-1!==this.textAlign.indexOf("justify"),n=this.get2DCursorLocation(e),o=this.get2DCursorLocation(i),s=n.lineIndex,a=o.lineIndex,c=0>n.charIndex?0:n.charIndex,h=0>o.charIndex?0:o.charIndex,l=s;a>=l;l++){var u=this._getLineLeftOffset(l)||0,f=this.getHeightOfLine(l),d=0,g=0,p=0;l===s&&(g=this.__charBounds[s][c].left),l>=s&&a>l?p=r&&!this.isEndOfWrapping(l)?this.width:this.getLineWidth(l)||5:l===a&&(p=0===h?this.__charBounds[a][h].left:this.__charBounds[a][h-1].left+this.__charBounds[a][h-1].width),d=f,(1>this.lineHeight||l===a&&1<this.lineHeight)&&(f/=this.lineHeight),this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",t.fillRect(m.left+u+g,m.top+m.topOffset+f,p-g,1)):(t.fillStyle=this.selectionColor,t.fillRect(m.left+u+g,m.top+m.topOffset,p-g,f)),m.topOffset+=d}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var r=this.get2DCursorLocation(this.selectionStart,!0),t=0<r.charIndex?r.charIndex-1:0;return{l:r.lineIndex,c:t}}}),fabric.IText.fromObject=function(t,e){if(o(t),t.styles)for(var i in t.styles)for(var r in t.styles[i])o(t.styles[i][r]);fabric.Object._fromObject("IText",t,e,"text")}}(),!function(){var l=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(e){this.isEditing&&this.exitEditing(),this.selected=!1,fabric.Object.prototype.onDeselect.call(this,e)},initAddedHandler:function(){var r=this;this.on("added",function(){var t=r.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,r._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(r))})},initRemovedHandler:function(){var r=this;this.on("removed",function(){var t=r.canvas;t&&(t._iTextInstances=t._iTextInstances||[],fabric.util.removeFromArray(t._iTextInstances,r),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,r._removeCanvasHandlers(t)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(e){e.__isMousedown=!1})}.bind(this),e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(o,t,e,a){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},o.animate("_currentCursorOpacity",t,{duration:e,onComplete:function(){r.isAborted||o[a]()},onChange:function(){o.canvas&&o.selectionStart===o.selectionEnd&&o.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(r){var t=this,e=r?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){t._tick()},e)},abortCursorAnimation:function(){var r=this._currentTickState||this._currentTickCompleteState,t=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,r&&t&&t.clearContext(t.contextTop||t.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(r){var t=0,e=r-1;if(this._reSpace.test(this._text[e]))for(;this._reSpace.test(this._text[e]);)t++,e--;for(;/\S/.test(this._text[e])&&-1<e;)t++,e--;return r-t},findWordBoundaryRight:function(r){var t=0,e=r;if(this._reSpace.test(this._text[e]))for(;this._reSpace.test(this._text[e]);)t++,e++;for(;/\S/.test(this._text[e])&&e<this.text.length;)t++,e++;return r+t},findLineBoundaryLeft:function(r){for(var t=0,e=r-1;!/\n/.test(this._text[e])&&-1<e;)t++,e--;return r-t},findLineBoundaryRight:function(r){for(var t=0,e=r;!/\n/.test(this._text[e])&&e<this.text.length;)t++,e++;return r+t},searchWordBoundary:function(o,t){for(var e=this._reSpace.test(this.text.charAt(o))?o-1:o,i=this.text.charAt(e),r=/[ \n\.,;!\?\-]/;!r.test(i)&&0<e&&e<this.text.length;)e+=t,i=this.text.charAt(e);return r.test(i)&&"\n"!==i&&(e+=1===t?0:1),e},selectWord:function(r){r=r||this.selectionStart;var t=this.searchWordBoundary(r,-1),e=this.searchWordBoundary(r,1);this.selectionStart=t,this.selectionEnd=e,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(r){r=r||this.selectionStart;var t=this.findLineBoundaryLeft(r),e=this.findLineBoundaryRight(r);return this.selectionStart=t,this.selectionEnd=e,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this):void 0},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(e){e.selected=!1,e.isEditing&&e.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(o){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(o.e),e=this.selectionStart,n=this.selectionEnd;(t===this.__selectionStartOnMouseDown&&e!==n||e!==t&&n!==t)&&(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==e||this.selectionEnd!==n)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(a,t,e){var i=e.slice(0,a),r=fabric.util.string.graphemeSplit(i).length;if(a===t)return{selectionStart:r,selectionEnd:r};var l=e.slice(a,t),s=fabric.util.string.graphemeSplit(l).length;return{selectionStart:r,selectionEnd:r+s}},fromGraphemeToStringSelection:function(a,t,e){var i=e.slice(0,a),r=i.join("").length;if(a===t)return{selectionStart:r,selectionEnd:r};var l=e.slice(a,t),s=l.join("").length;return{selectionStart:r,selectionEnd:r+s}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var d=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(d),e=this.get2DCursorLocation(d),i=e.lineIndex,r=e.charIndex,n=this.getValueOfPropertyAt(i,r,"fontSize")*this.lineHeight,g=t.leftOffset,o=this.calcTransformMatrix(),a={x:t.left+g,y:t.top+t.topOffset+n},c=this.canvas.upperCanvasEl,p=c.width-n,l=c.height-n;return a=fabric.util.transformPoint(a,o),a=fabric.util.transformPoint(a,this.canvas.viewportTransform),0>a.x&&(a.x=0),a.x>p&&(a.x=p),0>a.y&&(a.y=0),a.y>l&&(a.y=l),a.x+=this.canvas._offset.left,a.y+=this.canvas._offset.top,{left:a.x+"px",top:a.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(d,t){var e,i,r=this.get2DCursorLocation(d,!0),n=this.get2DCursorLocation(t,!0),s=r.lineIndex,o=r.charIndex,a=n.lineIndex,c=n.charIndex;if(s!==a){if(this.styles[s])for(e=o;e<this._textLines[s].length;e++)delete this.styles[s][e];if(this.styles[a])for(e=c;e<this._textLines[a].length;e++)i=this.styles[a][e],i&&(this.styles[s]||(this.styles[s]={}),this.styles[s][o+e-c]=i);for(e=s+1;a>=e;e++)delete this.styles[e];this.shiftLineStyles(a,s-a)}else if(this.styles[s]){i=this.styles[s];var g,l;for(e=o;c>e;e++)delete i[e];for(l in this.styles[s])g=parseInt(l,10),g>=c&&(i[g-(c-o)]=i[l],delete i[l])}},shiftLineStyles:function(t,e){var o=l(this.styles);for(var r in this.styles){var n=parseInt(r,10);n>t&&(this.styles[n+e]=o[n],o[n-e]||delete this.styles[n])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(t,e,i,r){var n,s={},o=!1;for(var a in i||(i=1),this.shiftLineStyles(t,i),this.styles[t]&&(n=this.styles[t][0===e?e:e-1]),this.styles[t]){var c=parseInt(a,10);c>=e&&(o=!0,s[c-e]=this.styles[t][a],delete this.styles[t][a])}for(o?this.styles[t+i]=s:delete this.styles[t+i];1<i;)i--,r&&r[i]?this.styles[t+i]={0:l(r[i])}:n?this.styles[t+i]={0:l(n)}:delete this.styles[t+i];this._forceClearCache=!0},insertCharStyleObject:function(t,e,i,r){this.styles||(this.styles={});var n=this.styles[t],s=n?l(n):{};for(var o in i||(i=1),s){var a=parseInt(o,10);a>=e&&(n[a+i]=s[a],s[a-i]||delete n[a])}if(this._forceClearCache=!0,r)for(;i--;)Object.keys(r[i]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+i]=l(r[i]));else if(n)for(var c=n[e?e-1:1];c&&i--;)this.styles[t][e+i]=l(c)},insertNewStyleBlock:function(a,t,e){for(var i=this.get2DCursorLocation(t,!0),r=[0],n=0,s=0;s<a.length;s++)"\n"===a[s]?(n++,r[n]=0):r[n]++;0<r[0]&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,r[0],e),e=e&&e.slice(r[0]+1)),n&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+r[0],n);for(var s=1;n>s;s++)this.insertCharStyleObject(i.lineIndex+s,0,r[s],e),e=e&&e.slice(r[s]+1);0<r[s]&&this.insertCharStyleObject(i.lineIndex+s,0,r[s],e)},setSelectionStartEndWithShift:function(r,t,e){r>=e?(t===r?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=r),this.selectionStart=e):e>r&&t>e?"right"===this._selectionDirection?this.selectionEnd=e:this.selectionStart=e:(t===r?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=t),this.selectionEnd=e)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:0>this.selectionStart&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:0>this.selectionEnd&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(r){this.__newClickTime=+new Date;var t=this.canvas.getPointer(r.e);this.isTripleClick(t,r.e)&&(this.fire("tripleclick",r),this._stopEvent(r.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isTripleClick:function(e){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("mousedblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))}),this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(r){if(this.editable&&(!r.e.button||1===r.e.button)){var t=this.canvas.getPointer(r.e);this.__mousedownX=t.x,this.__mousedownY=t.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(r.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(r){var t=this.canvas.getPointer(r);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1,!this.editable||this._isObjectMoved(e.e)||e.e.button&&1!==e.e.button||(this.__lastSelected&&!this.__corner&&(this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(o){var t=this.getSelectionStartFromPointer(o),e=this.selectionStart,n=this.selectionEnd;o.shiftKey?this.setSelectionStartEndWithShift(e,n,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(d){for(var t,e,i=this.getLocalPointer(d),r=0,n=0,o=0,s=0,a=0,c=0,g=this._textLines.length;g>c&&o<=i.y;c++)o+=this.getHeightOfLine(c)*this.scaleY,a=c,0<c&&(s+=this._textLines[c-1].length+1);t=this._getLineLeftOffset(a),n=t*this.scaleX,e=this._textLines[a];for(var l=0,u=e.length;u>l&&(r=n,n+=this.__charBounds[a][l].kernedWidth*this.scaleX,n<=i.x);l++)s++;return this._getNewSelectionStartFromOffset(i,r,n,s,u)},_getNewSelectionStartFromOffset:function(l,t,e,i,r){var n=l.x-t,o=e-l.x,s=o>n||0>o?0:1,a=i+s;return this.flipX&&(a=r-a),a>this._text.length&&(a=this._text.length),a}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; line-height: 1px; padding\uFF70top: "+e.fontSize+";",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing&&!this.inCompositionMode){if(e.keyCode in this.keysMap)this[this.keysMap[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey)))return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),33<=e.keyCode&&40>=e.keyCode?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(e){return!this.isEditing||this._copyDone||this.inCompositionMode?void(this._copyDone=!1):void(e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll()))},onInput:function(l){var t=this.fromPaste;if(this.fromPaste=!1,l&&l.stopPropagation(),this.isEditing){var e,i,r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,n=this._text.length,s=r.length,o=s-n;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var a=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),c=this.selectionStart>a.selectionStart;this.selectionStart===this.selectionEnd?n>s&&(e=c?this._text.slice(this.selectionEnd+o,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-o)):(e=this._text.slice(this.selectionStart,this.selectionEnd),o+=this.selectionEnd-this.selectionStart),i=r.slice(a.selectionEnd-o,a.selectionEnd),e&&e.length&&(this.selectionStart===this.selectionEnd?c?this.removeStyleFromTo(this.selectionEnd-e.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+e.length):this.removeStyleFromTo(this.selectionStart,this.selectionEnd)),i.length&&(t&&i.join("")===fabric.copiedText?this.insertNewStyleBlock(i,this.selectionStart,fabric.copiedTextStyle):this.insertNewStyleBlock(i,this.selectionStart)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(o,t){var e,n=this._getLineLeftOffset(o);return 0<t&&(e=this.__charBounds[o][t-1],n+=e.left+e.width),n},getDownCursorOffset:function(l,t){var e=this._getSelectionForOffset(l,t),i=this.get2DCursorLocation(e),r=i.lineIndex;if(r===this._textLines.length-1||l.metaKey||34===l.keyCode)return this._text.length-e;var n=i.charIndex,s=this._getWidthBeforeCursor(r,n),o=this._getIndexOnLine(r+1,s),a=this._textLines[r].slice(n);return a.length+o+2},_getSelectionForOffset:function(r,t){return r.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(l,t){var e=this._getSelectionForOffset(l,t),d=this.get2DCursorLocation(e),r=d.lineIndex;if(0===r||l.metaKey||33===l.keyCode)return-e;var n=d.charIndex,s=this._getWidthBeforeCursor(r,n),o=this._getIndexOnLine(r-1,s),a=this._textLines[r].slice(0,n);return-this._textLines[r-1].length+o-a.length},_getIndexOnLine:function(g,t){for(var e,i,r=Math.abs,p=this._textLines[g],n=this._getLineLeftOffset(g),s=n,o=0,a=0,c=p.length;c>a;a++)if(e=this.__charBounds[g][a].width,s+=e,s>t){i=!0;var h=s-e,l=s,u=r(h-t),f=r(l-t);o=u>f?a:a-1;break}return i||(o=p.length-1),o},moveCursorDown:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(o,t){var e=this["get"+o+"CursorOffset"](t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorWithShift(e):this.moveCursorWithoutShift(e),0!==e&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(r){var t="left"===this._selectionDirection?this.selectionStart+r:this.selectionEnd+r;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),0!==r},moveCursorWithoutShift:function(e){return 0>e?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e},moveCursorLeft:function(e){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorLeftOrRight("Left",e)},_move:function(o,t,e){var n;if(o.altKey)n=this["findWordBoundary"+e](this[t]);else{if(!o.metaKey&&35!==o.keyCode&&36!==o.keyCode)return this[t]+="Left"===e?-1:1,!0;n=this["findLineBoundary"+e](this[t])}return void 0!==typeof n&&this[t]!==n?(this[t]=n,!0):void 0},_moveLeft:function(r,t){return this._move(r,t,"Left")},_moveRight:function(r,t){return this._move(r,t,"Right")},moveCursorLeftWithoutShift:function(r){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(r,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):0===this.selectionStart?void 0:(this._selectionDirection="left",this._moveLeft(e,"selectionStart"))},moveCursorRight:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(r,t){var e="moveCursor"+r+"With";this._currentCursorOpacity=1,e+=t.shiftKey?"Shift":"outShift",this[e](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd===this._text.length?void 0:(this._selectionDirection="right",this._moveRight(e,"selectionEnd"))},moveCursorRightWithoutShift:function(r){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(r,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(r,t){"undefined"==typeof t&&(t=r+1),this.removeStyleFromTo(r,t),this._text.splice(r,t-r),this.text=this._text.join(""),this.set("dirty",!0),this._removeExtraneousStyles(),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords())}}),!function(r){"use strict";var m=r.fabric||(r.fabric={});m.Textbox=m.util.createClass(m.IText,m.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:m.Text.prototype._dimensionAffectingProps.concat("width"),initialize:function(r,t){this.callSuper("initialize",r,t)},initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(o){for(var t=0,a=0,l=0,r={},n=0;n<o.graphemeLines.length;n++)"\n"===o.graphemeText[l]&&0<n?(a=0,l++,t++):this._reSpaceAndTab.test(o.graphemeText[l])&&0<n&&(a++,l++),r[n]={line:t,offset:a},l+=o.graphemeLines[n].length,a+=o.graphemeLines[n].length;return r},styleHas:function(e,t){if(this._styleMap&&!this.isWrapping){var o=this._styleMap[t];o&&(t=o.line)}return m.Text.prototype.styleHas.call(this,e,t)},_getStyleDeclaration:function(r,t){if(this._styleMap&&!this.isWrapping){var e=this._styleMap[r];if(!e)return null;r=e.line,t=e.offset+t}return this.callSuper("_getStyleDeclaration",r,t)},_setStyleDeclaration:function(o,t,e){var n=this._styleMap[o];o=n.line,t=n.offset+t,this.styles[o][t]=e},_deleteStyleDeclaration:function(r,t){var e=this._styleMap[r];r=e.line,t=e.offset+t,delete this.styles[r][t]},_getLineStyle:function(r){var t=this._styleMap[r];return this.styles[t.line]},_setLineStyle:function(r,t){var e=this._styleMap[r];this.styles[e.line]=t},_deleteLineStyle:function(r){var t=this._styleMap[r];delete this.styles[t.line]},_wrapText:function(o,t){var e,n=[];for(this.isWrapping=!0,e=0;e<o.length;e++)n=n.concat(this._wrapLine(o[e],e,t));return this.isWrapping=!1,n},_measureWord:function(s,t,e){var i,r=0;e=e||0;for(var n,l=0,o=s.length;o>l;l++)n=this._getGraphemeBox(s[l],t,l+e,i,!0),r+=n.kernedWidth,i=s[l];return r},_wrapLine:function(e,t,i){for(var r=0,n=[],s=[],o=e.split(this._reSpaceAndTab),a="",c=0,h=" ",l=0,u=0,f=0,d=!0,_=this._getWidthOfCharSpacing(),p=0;p<o.length;p++)a=m.util.string.graphemeSplit(o[p]),l=this._measureWord(a,t,c),c+=a.length,r+=u+l-_,r>=i&&!d&&(n.push(s),s=[],r=l,d=!0),d||s.push(h),s=s.concat(a),u=this._measureWord([h],t,c),c++,d=!1,l>f&&(f=l);return p&&n.push(s),f>this.dynamicMinWidth&&(this.dynamicMinWidth=f-_),n},isEndOfWrapping:function(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line},_splitTextIntoLines:function(e){for(var t=m.Text.prototype._splitTextIntoLines.call(this,e),o=this._wrapText(t.lines,this.width),r=Array(o.length),n=0;n<o.length;n++)r[n]=o[n].join("");return t.lines=r,t.graphemeLines=o,t},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(e){return this.callSuper("toObject",["minWidth"].concat(e))}}),m.Textbox.fromObject=function(e,t){return m.Object._fromObject("Textbox",e,t,"text")}}("undefined"==typeof exports?this:exports),!function(){var d=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(t,e,i,r,n,s,o){var a=e.target;if(!("x"===n&&a instanceof fabric.Textbox))return d.call(fabric.Canvas.prototype,t,e,i,r,n,s,o);var c=a._getTransformedDimensions().x,u=a.width*(t.x/c);return u>=a.getMinWidth()?(a.set("width",u),!0):void 0},fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var e in this._styleMap)this._textLines[e]||delete this.styles[this._styleMap[e].line]}})}();